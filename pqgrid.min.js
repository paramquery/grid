/**
 * ParamQuery Pro v2.0.4
 *
 * Copyright (c) 2012-2015 Paramvir Dhindsa (http://paramquery.com)
 * Released under GPL v3 license
 * http://paramquery.com/license
 *
 */
(function(a){a.paramquery=a.paramquery||{};a.paramquery.pqgrid=a.paramquery.pqgrid||{};a.paramquery.xmlToArray=function(d,e){var c=e.itemParent;var g=e.itemNames;var b=[];var f=a(d).find(c);f.each(function(k,l){var j=a(l);var h=[];a(g).each(function(i,m){h.push(j.find(m).text())});b.push(h)});return b};a.paramquery.xmlToJson=function(d,e){var c=e.itemParent;var g=e.itemNames;var b=[];var f=a(d).find(c);f.each(function(n,o){var l=a(o);var k={};for(var m=0,h=g.length;m<h;m++){var p=g[m];k[p]=l.find(p).text()}b.push(k)});return b};a.paramquery.tableToArray=function(h){var i=a(h);var c=[];var f=[];var g=[];var e=[];var b=i.find("tr:first");var d=i.find("tr:eq(1)");b.find("th,td").each(function(p,m){var j=a(m);var r=j.html();var k=j.width();var s="string";var n=d.find("td:eq("+p+")");var l=n.text();var q=n.attr("align");l=l.replace(/,/g,"");if(parseInt(l)==l&&(parseInt(l)+"").length==l.length){s="integer"}else{if(parseFloat(l)==l){s="float"}}var o={title:r,width:k,dataType:s,align:q,dataIndx:p};c.push(o)});i.find("tr").each(function(k,m){if(k==0){return}var l=a(m);var j=[];l.find("td").each(function(n,o){j.push(a.trim(a(o).html()))});f.push(j)});return{data:f,colModel:c}};a.paramquery.formatCurrency=function(h){h=Math.round(h*10)/10;h=h+"";if(h.indexOf(".")==-1){h=h+".0"}var c=h.length;var e=h.substring(0,c-2),g=h.substring(c-2,c),b=e.match(/\d/g).reverse(),d=[];for(var f=0;f<b.length;f++){if(f>0&&f%3==0){d.push(",")}d.push(b[f])}d=d.reverse();e=d.join("");return e+g};a.paramquery.validation={is:function(b,c){if(b=="string"||!b){return true}b=b.substring(0,1).toUpperCase()+b.substring(1,b.length);return this["is"+b](c)},isFloat:function(c){var b=parseFloat(c);if(!isNaN(b)&&b==c){return true}else{return false}},isInteger:function(c){var b=parseInt(c);if(!isNaN(b)&&b==c){return true}else{return false}},isDate:function(c){var b=Date.parse(c);if(!isNaN(b)){return true}else{return false}}}})(jQuery);(function(b){var a={};a.options={curPage:0,totalPages:0,totalRecords:0,msg:"",rPPOptions:[10,20,30,40,50,100],rPP:20};a._regional={strDisplay:"Displaying {0} to {1} of {2} items.",strFirstPage:"First Page",strLastPage:"Last Page",strNextPage:"Next Page",strPage:"Page {0} of {1}",strPrevPage:"Previous Page",strRefresh:"Refresh",strRpp:"Records per page:{0}"};b.extend(a.options,a._regional);a._create=function(){var d=this,c=this.options;this.element.addClass("pq-pager");this.first=b("<button type='button' title='"+c.strFirstPage+"'></button>",{}).appendTo(this.element).button({icons:{primary:"ui-icon-seek-first"},text:false}).bind("click.paramquery",function(e){if(d.options.curPage>1){if(d._trigger("change",e,{curPage:1})!==false){d.option({curPage:1})}}});this.prev=b("<button type='button' title='"+c.strPrevPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-prev"},text:false}).bind("click",function(e){if(d.options.curPage>1){var f=d.options.curPage-1;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}}});b("<span class='pq-separator'></span>").appendTo(this.element);this.pageHolder=b("<span class='pq-page-placeholder'></span>").appendTo(this.element);b("<span class='pq-separator'></span>").appendTo(this.element);this.next=b("<button type='button' title='"+this.options.strNextPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-next"},text:false}).bind("click",function(e){var f=d.options.curPage+1;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}});this.last=b("<button type='button' title='"+this.options.strLastPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-end"},text:false}).bind("click",function(e){var f=d.options.totalPages;if(d._trigger("change",e,{curPage:f})!==false){d.option({curPage:f})}});b("<span class='pq-separator'></span>").appendTo(this.element);this.rPPHolder=b("<span class='pq-page-placeholder'></span>").appendTo(this.element);this.$refresh=b("<button type='button' title='"+this.options.strRefresh+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-refresh"},text:false}).bind("click",function(e){if(d._trigger("refresh",e)!==false){}});b("<span class='pq-separator'></span>").appendTo(this.element);this.$msg=b("<span class='pq-pager-msg'></span>").appendTo(this.element);this._refresh()};a._refreshPage=function(){var g=this;this.pageHolder.empty();var m=this.options,c=m.strPage,f=c.split(" "),j=[];for(var e=0,h=f.length;e<h;e++){var l=f[e];if(l=="{0}"){j.push("<input type='text' tabindex='0' class='ui-corner-all' />")}else{if(l=="{1}"){j.push("<span class='total'></span>")}else{j.push("<span>",l,"</span>")}}}var d=j.join("");var k=b(d).appendTo(this.pageHolder);this.page=k.filter("input").bind("change",function(i){var n=b(this),o=n.val();if(isNaN(o)||o<1){n.val(m.curPage);return false}o=parseInt(o);if(o>m.totalPages){n.val(m.curPage);return false}if(g._trigger("change",i,{curPage:o})!==false){g.option({curPage:o})}else{n.val(m.curPage);return false}});this.$total=k.filter("span.total")};a._refresh=function(){this._refreshPage();var d=this.$rPP,l=this,s=this.options;this.first.attr("title",s.strFirstPage);this.prev.attr("title",s.strPrevPage);this.next.attr("title",s.strNextPage);this.last.attr("title",s.strLastPage);this.$refresh.attr("title",s.strRefresh);this.rPPHolder.empty();if(s.strRpp){var c=s.rPPOptions,j=s.strRpp;if(j.indexOf("{0}")!=-1){var q=["<select class='ui-corner-all'>"];for(var h=0,m=c.length;h<m;h++){var f=c[h];q.push('<option value="',f,'">',f,"</option>")}q.push("</select>");var e=q.join("");j=j.replace("{0}","</span>"+e);j="<span>"+j+"<span class='pq-separator'></span>"}else{j="<span>"+j+"</span><span class='pq-separator'></span>"}this.$rPP=b(j).appendTo(this.rPPHolder).filter("select").val(s.rPP).change(function(i){var t=b(this).val();if(l._trigger("change",i,{rPP:t})!==false){l.options.rPP=t;return false}})}if(s.curPage>=s.totalPages){this.next.button({disabled:true});this.last.button({disabled:true})}else{this.next.button({disabled:false});this.last.button({disabled:false})}if(s.curPage<=1){this.first.button({disabled:true});this.prev.button({disabled:true})}else{this.first.button({disabled:false});this.prev.button({disabled:false})}this.page.val(s.curPage);this.$total.text(s.totalPages);if(this.options.totalRecords>0){var k=s.rPP;var o=s.curPage;var n=s.totalRecords;var r=(o-1)*k;var p=o*k;if(p>n){p=n}var g=s.strDisplay;g=g.replace("{0}",r+1);g=g.replace("{1}",p);g=g.replace("{2}",n);this.$msg.html(g)}else{this.$msg.html("")}};a._destroy=function(){this.element.empty().removeClass("pq-pager").enableSelection()};a._setOption=function(c,d){if(c=="curPage"||c=="totalPages"){d=parseInt(d)}b.Widget.prototype._setOption.call(this,c,d)};a._setOptions=function(){b.Widget.prototype._setOptions.apply(this,arguments);this._refresh()};b.widget("paramquery.pqPager",a);b.paramquery.pqPager.regional={};b.paramquery.pqPager.regional.en=a._regional;b.paramquery.pqPager.setDefaults=function(d){for(var c in d){a.options[c]=d[c]}b.widget("paramquery.pqPager",a);b(".pq-pager").each(function(f,e){b(e).pqPager("option",d)})}})(jQuery);(function(b){var a={};a.options={length:200,num_eles:3,cur_pos:0,timeout:350,pace:"optimum",direction:"vertical",theme:false};a._destroy=function(){this.element.removeClass("pq-sb-vert pq-sb-vert-t pq-sb-vert-wt").enableSelection().removeClass("pq-sb-horiz pq-sb-horiz-t pq-sb-horiz-wt").unbind("click.pq-scrollbar").empty();this.element.removeData()};a._create=function(){this._createLayout()};a._createLayout=function(){var d=this,c=this.options,g=c.direction,f=c.theme;var e=this.element.empty();if(g=="vertical"){e.removeClass("pq-sb-vert-t pq-sb-vert-wt").addClass("pq-sb-vert");if(f){e.addClass("pq-sb-vert-t");e.html(["<div class='top-btn pq-sb-btn ui-state-default ui-corner-top'>","<div class='ui-icon ui-icon-triangle-1-n'></div></div>","<div class='pq-sb-slider ui-corner-all ui-state-default'>","</div>","<div class='bottom-btn pq-sb-btn ui-state-default ui-corner-bottom'>","<div class='ui-icon ui-icon-triangle-1-s'></div></div>"].join(""))}else{e.addClass("pq-sb-vert-wt");e.html(["<div class='top-btn pq-sb-btn'></div>","<div class='pq-sb-slider'>","<div class='vert-slider-top'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-center'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-bottom'></div>","</div>","<div class='bottom-btn pq-sb-btn'></div>"].join(""))}}else{e.removeClass("pq-sb-horiz-t pq-sb-horiz-wt").addClass("pq-sb-horiz");if(f){e.addClass("pq-sb-horiz-t");e.html(["<div class='left-btn pq-sb-btn ui-state-default ui-corner-left'>","<div class='ui-icon ui-icon-triangle-1-w'></div></div>","<div class='pq-sb-slider pq-sb-slider-h ui-state-default ui-corner-all'>","</div>","<div class='right-btn pq-sb-btn ui-state-default ui-corner-right'>","<div class='ui-icon ui-icon-triangle-1-e'></div></div>"].join(""))}else{e.addClass("pq-sb-horiz-wt");e.width(this.width);e.html(["<div class='left-btn pq-sb-btn'></div>","<div class='pq-sb-slider pq-sb-slider-h'>","<span class='horiz-slider-left'></span>","<span class='horiz-slider-bg'></span>","<span class='horiz-slider-center'></span>","<span class='horiz-slider-bg'></span>","<span class='horiz-slider-right'></span>","</div>","<div class='right-btn pq-sb-btn'></div>"].join(""))}}e.disableSelection().on("mouseup.pq-scrollbar",function(i){d.sbmouseup=true}).on("mousedown.pq-scrollbar",function(q){d.sbmouseup=false;if(c.disabled){return}if(d.$slider.is(":hidden")){return}if(g=="vertical"){var i=q.pageY,l=d.element.offset().top,m=l+c.length,o=d.$slider,k=o.offset().top,p=o.height(),n=k+p;if(i<k&&i>l+17){d.mousedownInterval=window.setInterval(function(){if(d.sbmouseup||(i>=o.offset().top)){window.clearInterval(d.mousedownInterval);d.mousedownInterval=null}else{d._pageUp(q)}},0)}else{if(i>n&&i<m-17){d.mousedownInterval=window.setInterval(function(){if(d.sbmouseup||(i<=o.offset().top+p)){window.clearInterval(d.mousedownInterval);d.mousedownInterval=null}else{d._pageDown(q)}},0)}}}else{var j=q.pageX,l=d.element.offset().left,m=l+c.length,k=d.$slider.offset().left,n=k+d.$slider.width();if(j<k&&j>l+17){d.$slider.css("left",j-d.element.offset().left);d._updateCurPosAndTrigger(q)}else{if(j>n&&j<m-17){d.$slider.css("left",j-d.element.offset().left-d.$slider.width());d._updateCurPosAndTrigger(q)}}}});var h=this.$slider=b("div.pq-sb-slider",this.element);if(f){h.attr("tabindex","0")}this._bindSliderEvents(h);this.$top_btn=b("div.top-btn,div.left-btn",this.element).click(function(i){if(d.options.disabled){return}d.decr_cur_pos(i);i.preventDefault();return false}).mousedown(function(i){if(d.options.disabled){return}d.mousedownTimeout=window.setTimeout(function(){d.mousedownInterval=window.setInterval(function(){d.decr_cur_pos(i)},0)},d.options.timeout)}).bind("mouseup mouseout",function(i){if(d.options.disabled){return}d._mouseup(i)});this.$bottom_btn=b("div.bottom-btn,div.right-btn",this.element).click(function(i){if(d.options.disabled){return}d.incr_cur_pos(i);i.preventDefault();return false}).mousedown(function(i){if(d.options.disabled){return}d.mousedownTimeout=window.setTimeout(function(){d.mousedownInterval=window.setInterval(function(){d.incr_cur_pos(i)},0)},d.options.timeout)}).bind("mouseup mouseout",function(i){if(d.options.disabled){return}d._mouseup(i)});this._refresh()};a._bindSliderEvents=function(f){var d=this,e=this.options.direction,c="x";if(e=="vertical"){c="y"}f.draggable({axis:c,helper:function(g,h){d._setDragLimits();return this},start:function(g){d.topWhileDrag=null},drag:function(g){d.dragging=true;var h=d.options.pace;if(h=="optimum"){d._setNormalPace(g)}else{if(h=="fast"){d._updateCurPosAndTrigger(g)}}},stop:function(g){d._updateCurPosAndTrigger(g);d.dragging=false;d._refresh()}}).on("keydown",function(g){var l=g.keyCode,i=d.options,h=i.cur_pos,k=i.num_eles,j=b.ui.keyCode;if(d.keydownTimeout==null){d.keydownTimeout=window.setTimeout(function(){if(l==j.DOWN||l==j.RIGHT){d.incr_cur_pos(g)}else{if(l==j.UP||l==j.LEFT){d.decr_cur_pos(g)}else{if(l==j.HOME){if(h>0){i.cur_pos=0;d.updateSliderPos();d.scroll(g)}}else{if(l==j.END){if(h<k){i.cur_pos=k;d.updateSliderPos();d.scroll(g)}}else{if(i.direction=="vertical"){if(l==j.PAGE_DOWN){d._pageDown(g)}else{if(l==j.PAGE_UP){d._pageUp(g)}}}}}}}d.keydownTimeout=null},0)}if(l==j.DOWN||l==j.RIGHT||l==j.UP||l==j.LEFT||l==j.PAGE_DOWN||l==j.PAGE_UP||l==j.HOME||l==j.END){g.preventDefault();return false}})};a.decr_cur_pos=function(c){var e=this,d=e.options;if(d.cur_pos>0){d.cur_pos--;e.updateSliderPos();e.scroll(c)}};a.incr_cur_pos=function(c){var e=this,d=e.options;if(d.cur_pos<d.num_eles-1){d.cur_pos++}e.updateSliderPos();e.scroll(c)};a._mouseup=function(c){if(this.options.disabled){return}var d=this;window.clearTimeout(d.mousedownTimeout);d.mousedownTimeout=null;window.clearInterval(d.mousedownInterval);d.mousedownInterval=null};a._setDragLimits=function(){var c=this.options;if(c.direction=="vertical"){var d=this.element.offset().top+17;var e=(d+c.length-34-this.slider_length);this.$slider.draggable("option","containment",[0,d,0,e])}else{d=this.element.offset().left+17;e=(d+c.length-34-this.slider_length);this.$slider.draggable("option","containment",[d,0,e,0])}};a._refresh=function(){var c=this.options;if(c.num_eles<=1){this.element.css("display","none")}else{this.element.css("display","")}this._validateCurPos();this.$slider.css("display","");if(c.direction=="vertical"){this.element.height(c.length);this._setSliderBgLength();this.scroll_space=c.length-34-this.slider_length;if(this.scroll_space<4||c.num_eles<=1){this.$slider.css("display","none")}this.updateSliderPos(c.cur_pos)}else{this.element.width(c.length);this._setSliderBgLength();this.scroll_space=c.length-34-this.slider_length;if(this.scroll_space<4||c.num_eles<=1){this.$slider.css("display","none")}this.updateSliderPos(c.cur_pos)}};a._setSliderBgLength=function(){var e=this.options,h=e.theme,f=e.length,g=e.num_eles*40+f,d=f-34,c=d*f/g,i=Math.round((c-(8+3+3))/2);if(i<1){i=1}this.slider_length=8+3+3+2*i;if(e.direction=="vertical"){if(h){this.$slider.height(this.slider_length-2)}else{b("div.vert-slider-bg",this.element).height(i);this.$slider.height(this.slider_length)}}else{if(h){this.$slider.width(this.slider_length-2)}else{b(".horiz-slider-bg",this.element).width(i);this.$slider.width(this.slider_length)}}};a._updateCurPosAndTrigger=function(c,i){var f=this,e=this.options,h=e.direction,j=f.$slider;if(i==null){i=(h=="vertical")?parseInt(j[0].style.top,10):parseInt(j[0].style.left,10)}var g=e.length-34-((h=="vertical")?j[0].offsetHeight:j[0].offsetWidth);var d=(i-17)*(e.num_eles-1)/g;d=Math.round(d);if(e.cur_pos!=d){if(this.dragging){if(this.topWhileDrag!=null){if(this.topWhileDrag<i&&e.cur_pos>d){return}else{if(this.topWhileDrag>i&&e.cur_pos<d){return}}}this.topWhileDrag=i}f.options.cur_pos=d;this.scroll(c)}};a._setNormalPace=function(c){if(this.timer){window.clearInterval(this.timer);this.timer=null}var e=this,d=this.options,f=d.direction;e.timer=window.setInterval(function(){var h=e.$slider;var g=(f=="vertical")?parseInt(h[0].style.top,10):parseInt(h[0].style.left,10);if(e.prev_top==g){e._updateCurPosAndTrigger(c,g);window.clearInterval(e.timer);e.timer=null}e.prev_top=g},20)};a.setNumEles=function(c){this.options.num_eles=c;this.updateSliderPos()};a._validateCurPos=function(){var c=this.options;if(c.cur_pos>=c.num_eles){c.cur_pos=c.num_eles-1}if(c.cur_pos<0){c.cur_pos=0}};a.updateSliderPos=function(){var d=this.options;var c=(this.scroll_space*(d.cur_pos))/(d.num_eles-1);if(d.direction=="vertical"){this.$slider.css("top",17+c)}else{this.$slider.css("left",17+c)}};a.scroll=function(c){var d=this.options;this._trigger("scroll",c,{cur_pos:d.cur_pos,num_eles:d.num_eles})};a._pageDown=function(c){this._trigger("pageDown",c,null)};a._pageUp=function(c){this._trigger("pageUp",c,null)};a._setOption=function(c,d){b.Widget.prototype._setOption.call(this,c,d);if(c=="disabled"){if(d==true){this.$slider.draggable("disable")}else{this.$slider.draggable("enable")}}else{if(c=="theme"){this._createLayout()}}};a._setOptions=function(){b.Widget.prototype._setOptions.apply(this,arguments);this._refresh()};b.widget("paramquery.pqScrollBar",a)})(jQuery);(function(h){h("body").delegate(".pq-editor-focus","focus",function(){h(".pq-grid").find(".pq-cont").enableSelection()});h("body").delegate(".pq-editor-focus","blur",function(){h(".pq-grid").find(".pq-cont").disableSelection()});var f=function(){};f.prototype.belongs=function(i){if(i.target==this.that.element[0]){return true}};h.paramquery.cClass=f;var c=function(i){this.that=i;this.hidearrHS1=[];this.offset=null};h.paramquery.cGenerateView=c;var a=c.prototype;a.generateView=function(m){var u=this.that,y=u.options,q=y.virtualX,w=y.numberCell,n=u.colModel,r=u.initH,C=u.finalH,B=y.groupModel,A=parseInt(y.freezeCols),z=parseInt(y.freezeRows),v,I;if(m){var E=this._generateTables(null,null,m);m.$cont.empty();var D=h(E);m.$cont.append(D);if(!u.tables){u.tables=[]}var H=-1;for(var F=0;F<u.tables.length;F++){var k=u.tables[F].cont;if(k==m.$cont[0]){H=F}}if(H==-1){u.tables.push({$tbl:D,cont:m.$cont[0]})}else{u.tables[H].$tbl=D}}else{u._bufferObj_calcInitFinal();var G=u.init;this.init=u.init;var p=u["final"];this["final"]=u["final"];var j=this._generateTables(G,p,m);if(u.$td_edit!=null){u.quitEditMode({silent:true})}u.$cont.empty();if(u.totalVisibleRows===0){u.$cont.append("<div class='pq-cont-inner pq-grid-norows' >"+y.strNoRows+"</div>")}else{if(!q&&(A||w.show)){u.$cont.append("<div class='pq-cont-inner'>"+j+"</div><div class='pq-cont-inner'>"+j+"</div>")}else{u.$cont.append("<div class='pq-cont-inner'>"+j+"</div>")}}var i=u.$cont.children("div");if(i.length==2){var t=h(i[0]);var o=h(i[1]);D=u.$cont.children().children("table");u.$tbl=D;var x=h(D[1]);v=d.call(u,-1,A);t.css({width:v,zIndex:1});I=d.call(u,A,r);o.css({left:v+"px",width:u.$tbl[0].scrollWidth,position:"absolute"});x.css({left:(-1*(I+v))+"px"})}else{D=u.$tbl=u.$cont.children().children("table");var s=h(i[0]);I=d.call(u,A,r);if(!q){D.css({left:"-"+(I)+"px"})}}u._fixTableViewPort();u._trigger("refresh",null,{dataModel:y.dataModel,colModel:n,pageData:(B?u.dataGM:u.data),initV:u.init,finalV:u["final"],initH:r,finalH:C})}};a._generateTables=function(X,I,P){var J=this.that,Q=J.colModel,u=Q.length,x=J.options,r=x.virtualX,G=J.initH,U=J.finalH,R=x.numberCell,Y=x.columnBorders,C=x.rowBorders,n=x.scrollModel,j=x.groupModel,D=J.hidearrHS,z=x.freezeCols,i=parseInt(x.freezeRows),T=false,k=J.outerWidths,v=0,V=(P)?P.data.length-1:I,L="",M=j?true:false,y=x.treeModel,Z=(P&&P.data)?P.data:(M?J.dataGM:(J.data)),N=J.rowIndxOffset;if(!P&&(X==null||V==null)){J.$cont.empty();J.$tbl=null;return}if(!P){J._trigger("beforeTableView",null,{pageData:Z,initV:X,finalV:I,initH:G,finalH:U,colModel:Q})}var o="pq-grid-table ";if(Y){o+="pq-grid-td-border-right "}if(C){o+="pq-grid-td-border-bottom "}var A=["<table class='"+o+"' cellpadding=0 cellspacing=0 >"];this.hidearrHS1=[];if(1===1){A.push("<tr class='pq-row-hidden'>");if(R.show){var p=R.width+1;A.push("<td style='width:"+p+"px;' ></td>")}for(var q=0;q<=U;q++){if((r||P)&&D[q]){this.hidearrHS1.push(q);continue}var O=Q[q];if(O.hidden){continue}p=k[q];A.push("<td style='width:"+p+"px;' pq-top-col-indx="+q+"></td>")}A.push("</tr>")}this.offsetRow=null;for(var v=0;v<=V;v++){if(v<X&&v>=i){v=X}var m=Z[v],S=m,t=M?(m.rowIndx-N):v,w=(m)?m.pq_hidden:false;if(w){continue}T=false;if(i&&J.lastFrozenRow==v){T=true}if(this.offsetRow==null&&t!=null){J.offsetRow=(v-t)}if(j&&m.groupTitle){this._generateTitleRow(j,m,A,T)}else{if(j&&m.groupSummary){this._generateSummaryRow(m.data,Q,A,T)}else{var K=S.pq_detail,E=false;if(K&&K.show){E=true}this._generateRow(S,t,Q,A,P,T,E);if(E){this._generateDetailRow(S,t,Q,A,P,T)}}}}J.scrollMode=false;A.push("</table>");var F=A.join("");if(P){P.$cont.empty();var s=h(F);P.$cont.append(s);if(!J.tables){J.tables=[]}var B=-1;for(var W=0;W<J.tables.length;W++){var H=J.tables[W].cont;if(H==P.$cont[0]){B=W}}if(B==-1){J.tables.push({$tbl:s,cont:P.$cont[0]})}else{J.tables[B].$tbl=s}}else{}return F};a._renderCell=function(n){var s=this.that,p=s.options,x=p.dataModel,l=n.rowIndxPage,u=n.rowIndx,v=n.rowData,A=n.colIndx,r=n.$td,o=n.column,q=o.type,y=o.dataIndx,z=v[y],w=n.wrap;if(!v){return}var C;if(q=="checkBoxSelection"){C="<input type='checkbox' "+(z?"checked='checked'":"")+" />"}else{if(q=="detail"){var B=p.detailModel;var i=(z&&z.show)?B.expandIcon:B.collapseIcon;C="<div class='ui-icon "+i+"'></div>"}else{if(o.render){C=o.render.call(s.element,{data:s.data,dataModel:x,rowData:v,cellData:z,rowIndxPage:l,rowIndx:u,colIndx:A,column:o,dataIndx:y})}else{C=z}}}if(C===""||C==undefined){C="&nbsp;"}var k="pq-td-div";if(w==false){k+=" pq-wrap-text"}var D="",m;if(n.tree&&(m=p.treeModel)&&m.labelIndx==y){var F=v.pq_leaf,j=v.pq_level,E=!v.pq_collapse,G=(j+1)*m.indent,t="";if(F){t=m.leafIcon}else{if(E){t=m.expandIcon+" pq-tree-expand-icon"}else{t=m.collapseIcon+" pq-tree-expand-icon"}}var H=["<div class='pq-tree-icon-container' style='width:",G,"px;'>","<div class='ui-icon ",t," pq-tree-icon' ></div></div>"].join("");D="<div class='"+k+"'>"+H+C+"</div>"}else{D="<div class='"+k+"'>"+C+"</div>"}if(r!=undefined){r.html(D)}return D};a._generateRow=function(L,u,K,z,J,N,B){var k="pq-grid-row";if(N){k+=" pq-last-freeze-row"}if(B){k+=" pq-detail-master"}var F=this.that,v=F.options,y=v.freezeCols,M=v.numberCell,x=v.treeModel,w=x.labelIndx?true:false,R=v.columnBorders,P=v.wrap,s=K.length,p=v.virtualX,D=F.initH,Q=F.finalH,H=this.offset,A=F.hidearrHS,S=v.customData;var O="pq-grid-cell ";if(!v.wrap||J){O+="pq-wrap-text "}var t={rowIndx:u+H,rowIndxPage:u,rowData:L,wrap:P,customData:S};if(v.stripeRows&&(u/2==parseInt(u/2))){k+=" pq-grid-oddRow"}if(L.pq_rowselect){k+=" pq-row-select ui-state-highlight"}var m;var o=L.pq_rowcls;var j=L.pq_cellcls;if(o!=null){k+=" "+o}z.push("<tr pq-row-indx='"+u+"' class='"+k+"' >");if(M.show){z.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>",((J)?"&nbsp;":(u+1)),"</div></td>"].join(""))}for(var n=0;n<=Q;n++){if(n<D&&n>=y&&(p||J)){n=D;if(n>Q){throw ("initH>finalH");break}}var I=K[n],G=I.dataIndx;if(I.hidden){continue}t.column=I;t.colIndx=n;t.dataIndx=G;var i=false;if(1===1){var T=L.pq_cellselect;if(T){i=T[G]}}var E="";var l=O;if(I.align=="right"){l+=" pq-align-right"}else{if(I.align=="center"){l+=" pq-align-center"}}if(n==y-1&&R){l+=" pq-last-freeze-col"}if(I.cls){l=l+" "+I.cls}if(i){l=l+" pq-cell-select ui-state-highlight"}if(j){var m=j[G];if(m){l+=" "+m}}var q="pq-col-indx='"+n+"'";if(J){q+=" pq-dataIndx='"+G+"'"}var r="";t.tree=w;var C=["<td ",r," class='",l,"' style='",E,"' ",q," >",this._renderCell(t),"</td>"].join("");z.push(C)}z.push("</tr>");return z};var g={widgetEventPrefix:"pqgrid"};g.options={collapsible:true,colModel:null,columnBorders:true,customData:null,dataModel:{cache:false,dataType:"JSON",location:"local",sorting:"local",sortDir:"up",method:"GET"},direction:"",draggable:false,editable:true,editModel:{cellBorderWidth:1,clicksToEdit:1,filterKeys:true,keyUpDown:true,saveKey:"",select:false},editor:{type:"contenteditable"},validation:{icon:"ui-icon-alert",cls:"ui-state-error"},flexHeight:false,flexWidth:false,freezeCols:0,freezeRows:0,getDataIndicesFromColIndices:true,height:400,hoverMode:"row",minWidth:50,numberCell:{width:30,title:"",resizable:false,minWidth:30,show:true},pageModel:{curPage:1,totalPages:0,rPP:10,rPPOptions:[10,20,50,100]},resizable:false,roundCorners:true,rowBorders:true,scrollModel:{pace:"fast",horizontal:true,lastColumn:"auto",autoFit:false,theme:false},selectionModel:{type:"row",mode:"range"},showBottom:true,showHeader:true,showTitle:true,showToolbar:true,showTop:true,sortable:true,sql:false,stripeRows:true,title:"&nbsp;",treeModel:null,width:600,wrap:true};g._regional={strAdd:"Add",strDelete:"Delete",strEdit:"Edit",strLoading:"Loading",strNextResult:"Next Result",strNoRows:"No rows to display.",strNothingFound:"Nothing found",strPrevResult:"Previous Result",strSearch:"Search",strSelectedmatches:"Selected {0} of {1} match(es)"};h.extend(g.options,g._regional);g._destroyResizable=function(){if(this.element.data("resizable")){this.element.resizable("destroy")}};g._destroyDraggable=function(){if(this.element.data("draggable")){this.element.draggable("destroy")}};g._disable=function(){if(this.$disable==null){this.$disable=h("<div class='pq-grid-disable'></div>").css("opacity",0.2).appendTo(this.element)}};g._enable=function(){if(this.$disable){this.element[0].removeChild(this.$disable[0]);this.$disable=null}};g._destroy=function(){this._destroyResizable();this._destroyDraggable();this.element.empty();this.element.css("height","");this.element.css("width","");this.element.removeClass("pq-grid ui-widget ui-widget-content ui-corner-all").removeData()};g._findCellFromEvtCoords=function(w){throw ("not in use");if(this.$tbl==null){return null}var u=h(w.target).closest(".pq-editor-border-edit");if(u.length>0){return null}var v=w.pageY-this.$cont.offset().top;var o=w.pageX-this.$cont.offset().left;var n=this.$tbl.find("tr.pq-grid-row");var t=0,k=0,p=0;for(var r=1;r<n.length;r++){if(n[r].offsetTop>v){break}else{t++}}var s=h(n[t]);k=parseInt(s.attr("pq-row-indx"));var j=s.find("td.pq-grid-cell");var t=0,m=false;for(var r=0;r<j.length;r++){var q=j[r];if(q.offsetLeft<o&&q.offsetLeft+q.offsetWidth>o){m=true;break}else{if(q.offsetLeft>o){break}else{t++}}}if(!m){return null}var l=h(j[t]);if(l[0].nodeName.toUpperCase()!="TD"){l=h(w.target).parent("td")}p=parseInt(l.attr("pq-col-indx"));if(isNaN(p)){return null}return{$td:l,rowIndxPage:k,rowIndx:k+this.rowIndxOffset,colIndx:p,dataIndx:this.colModel[p].dataIndx}};g._createSlidingTop=function(){var m=this,n=this.$top,k=false,l=0,i=h(["<div class='pq-slider-icon' style='z-index:5;' >","<span class='ui-icon ui-icon-circle-triangle-n'></span>","</div>"].join("")).appendTo(n),j=i.children("span");i.mouseover(function(o){i.addClass("ui-state-hover")}).mouseout(function(o){i.removeClass("ui-state-hover")}).click(function(o){var q=m.element,p=m.options;if(k){q.animate({height:l},function(){m.refresh();j.addClass("ui-icon-circle-triangle-n").removeClass("ui-icon-circle-triangle-s");m.$toolbar.pqToolbar("enable")});k=false}else{l=(p.flexHeight)?q[0].offsetHeight:p.height;l=parseInt(l)+"px";q.animate({height:"23px"},function(){j.addClass("ui-icon-circle-triangle-s").removeClass("ui-icon-circle-triangle-n");if(q.hasClass("ui-resizable")){q.resizable("destroy")}m.$toolbar.pqToolbar("disable")});k=true}});this.$collapsible=i};if(h.paramquery.pqg_incr==null){h.paramquery.pqg_incr=0}g._create=function(){var m=this;this.iGenerateView=new c(this);this.iKeyNav=new b(this);this.cols=[];this.widths=[];this.outerWidths=[];this.rowHeight=22;this.hidearr=[];this.hidearrHS=[];this.tables=[];var m=this,l=this.options;this.$tbl=null;this._calcThisColModel();this.iSort=new h.paramquery.cSort(this);this.iSort._refreshSorters();this._initTypeColumns();h.paramquery.pqg_incr++;var n=h.paramquery.pqg_incr;this.element.empty().addClass("pq-grid ui-widget ui-widget-content"+(l.roundCorners?" ui-corner-all":"")).append(["<div class='pq-grid-top ui-widget-header",(l.roundCorners?" ui-corner-top":""),"'>","<div class='pq-grid-title",(l.roundCorners?" ui-corner-top":""),"'>&nbsp;</div></div>","<div class='pq-grid-inner' ><div class='pq-grid-right'>","<div class='pq-header-outer ui-widget-header'>","<span class='pq-grid-header ui-state-default'></span><span class='pq-grid-header ui-state-default'></span>","</div>","<div class='pq-cont-right' >","<div class='pq-cont pq-cont-",n,"'></div>","</div>","</div></div>","<div class='pq-grid-bottom ui-widget-header",(l.roundCorners?" ui-corner-bottom":""),"'>","<div class='pq-grid-footer'>&nbsp;</div>","</div>"].join(""));this._trigger("render",null,{dataModel:this.options.dataModel,colModel:this.colModel});this.$top=h("div.pq-grid-top",this.element);this.$title=h("div.pq-grid-title",this.element);if(!l.showTitle){this.$title.css("display","none")}if(l.collapsible){this._createSlidingTop()}this.$toolbar=h("div.pq-grid-toolbar",this.element);this.$grid_inner=h("div.pq-grid-inner",this.element);this.$grid_right=h(".pq-grid-right",this.element);this.$header_o=h("div.pq-header-outer",this.$grid_right);if(!l.showTop){this.$top.css("display","none")}this.$header=h(".pq-grid-header",this.$grid_right);this.$header_left=h(this.$header[0]);this.$header_right=h(this.$header[1]);this.$bottom=h("div.pq-grid-bottom",this.element);if(!l.showBottom){this.$bottom.css("display","none")}this.$footer=h("div.pq-grid-footer",this.element);this.$cont_o=h("div.pq-cont-right",this.$grid_right);this.$cont_fixed=h("div.pq-cont-fixed",this.$grid_right);this.$cont=h("div.pq-cont",this.$grid_right);this.$cont.on("click",function(o){m._onClickCont(o)});this.$cont.on("click","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onClickCell(o)}});this.$cont.on("click","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onClickRow(o)}});this.$cont.on("contextmenu","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRightClickCell(o)}});this.$cont.on("contextmenu","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRightClickRow(o)}});this.$cont.on("dblclick","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onDblClickCell(o)}});this.$cont.on("dblclick","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onDblClickRow(o)}});this.$cont.on("mousedown","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onCellMouseDown(o)}});this.$cont.on("mousedown","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRowMouseDown(o)}});this.$cont.on("mousemove","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onCellMouseMove(o)}});this.$cont.on("mousemove","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRowMouseMove(o)}});this.$cont.on("mouseup","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onCellMouseUp(o)}});this.element.on("mouseup",function(o){if(m._trigger("mouseUp",o,{dataModel:m.options.dataModel})==false){return false}});this.$cont.on("mouseenter","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onCellMouseEnter(o,h(this))}});this.$cont.on("mouseenter","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRowMouseEnter(o,h(this))}});this.$cont.on("mouseleave","td.pq-grid-cell",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onCellMouseLeave(o,h(this))}});this.$cont.on("mouseleave","tr.pq-grid-row",function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){return m._onRowMouseLeave(o,h(this))}});this.$cont.bind("mousewheel DOMMouseScroll",function(o){return m._onMouseWheel(o)});var i=0;this.$hvscroll=h("<div class='pq-hvscroll-square ui-widget-content'></div>").appendTo(this.$grid_inner);this.$vscroll=h("<div class='pq-vscroll'></div>").appendTo(this.$grid_inner);this.prevVScroll=0;var j=l.scrollModel;this.$vscroll.pqScrollBar({pace:j.pace,theme:j.theme,direction:"vertical",cur_pos:0,pageDown:function(o,p){m.iKeyNav.pageDown()},pageUp:function(o,p){m.iKeyNav.pageUp()},scroll:function(o,q){m.scrollMode=true;m.setFlexWHCallback(function(){m.iGenerateView.generateView()});var p;if(o.originalEvent&&o.originalEvent.type=="drag"){p=m._setScrollVNumEles()}else{p=m._setScrollVNumEles(true)}if(p<=1){m._setScrollHLength();m._setScrollHVLength()}}});var k=0;this.$hscroll=h("<div class='pq-hscroll'></div>").appendTo(this.$grid_inner);this.$hscroll.pqScrollBar({direction:"horizontal",pace:j.pace,theme:j.theme,cur_pos:0,scroll:function(o,p){m.refresh()}});this._refreshGridWidth();this.element.height(l.height);this.disableSelection();if(window.opera){this.$grid_inner.bind("keypress.pq-grid",{that:this},function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){m._onKeyPressDown(o)}})}else{this.$grid_inner.bind("keydown.pq-grid",{that:this},function(o){if(h(o.target).closest(".pq-grid")[0]==m.element[0]){m._onKeyPressDown(o)}})}this._refreshOptions();this._refreshTitle();this._refreshDataIndices();this.iRows=new h.paramquery.cRows(this);this.iCells=new h.paramquery.cCells(this);this.generateLoading();this._initPager()};g._refreshGridWidth=function(){var n=this.options,p,k=this.element;if((n.width+"").indexOf("%")!=-1){var o=k.parent(),j=o.width(),r=null;if(j==0){while(o[0].tagName.toUpperCase()!="BODY"){var q=o.parent();if(q[0]==null){r=o;break}else{o=q}}if(r){var l=r.css("position"),i=r.css("left"),m=r.css("top");r.css({position:"absolute",left:"-2000",top:"-2000"}).appendTo(h(document.body));j=k.parent().width();r.css({position:l,left:i,top:m})}}var p=parseInt(n.width)*j/100}else{p=n.width}k.width(p);k.width(k.width())};g._onMouseWheel=function(j){if(this.options.flexHeight){return true}var m=this;var l=0;var j=j.originalEvent;if(j.wheelDelta){l=j.wheelDelta/120}else{if(j.detail){l=j.detail*-1/3}}var k=parseInt(m.$vscroll.pqScrollBar("option","cur_pos"));var i=k-l;if(i>=0){m.$vscroll.pqScrollBar("option","cur_pos",k-l).pqScrollBar("scroll")}return false};g._onDblClickCell=function(j){var l=this;var p=h(j.currentTarget);var n=l.getCellIndices({$td:p});var i=n.rowIndxPage,o=l.rowIndxOffset,k=i+o,m=n.colIndx;if(m==null){return}if(l._trigger("cellDblClick",j,{$td:p,rowIndxPage:i,rowIndx:k,colIndx:m,column:l.colModel[m],rowData:l.data[i]})==false){return false}if(l.options.editModel.clicksToEdit>1&&this.isEditableRow({rowIndx:k})&&this.isEditableCell({colIndx:m,rowIndx:k})){l._editCell(p)}};g._onClickCont=function(i){var j=this};g._onClickRow=function(k){var o=this;var n=h(k.currentTarget);var j=parseInt(n.attr("pq-row-indx")),p=o.rowIndxOffset,m=j+p;if(isNaN(j)){return}var i={rowIndx:m,evt:k},l=this.options;if(o._trigger("rowClick",k,{$tr:n,rowIndxPage:j,rowIndx:m,rowData:o.data[j]})==false){return false}return};g._onRightClickRow=function(j){var n=this,m=h(j.currentTarget),i=parseInt(m.attr("pq-row-indx")),o=n.rowIndxOffset,l=i+o;if(isNaN(i)){return}var k=this.options;if(n._trigger("rowRightClick",j,{$tr:m,rowIndxPage:i,rowIndx:l,rowData:n.data[i]})==false){return false}};g._onDblClickRow=function(j){var m=this;var l=h(j.currentTarget);var i=parseInt(l.attr("pq-row-indx")),n=m.getRowIndxOffset(),k=i+n;if(m._trigger("rowDblClick",j,{$tr:l,rowIndxPage:i,rowIndx:k,rowData:m.data[i]})==false){return false}};g._isValid=function(y){var r=this,t=y.rowData,A=h.trim(y.value),m=y.column,x=m.dataIndx,w=this.options.validation,l=m.validations;if(l&&l.length>0){for(var B=0;B<l.length;B++){var z=l[B],z=h.extend({},w,z),n=z.type,p=z.msg,p=p?p:"&nbsp;",G=z.icon,k=z.cls,k=k?k:"",D="padding:3px 10px;"+z.style,v=z.css,o=true,F={valid:false,msg:p,dataIndx:x},u=z.value;if(n=="minLen"&&A.length<u){o=false}else{if(n=="maxLen"&&A.length>u){o=false}else{if(n=="gt"&&A<=u){o=false}else{if(n=="gte"&&A<u){o=false}else{if(n=="lt"&&A>=u){o=false}else{if(n=="lte"&&A>u){o=false}else{if(n=="regexp"&&(new RegExp(u)).test(A)==false){o=false}else{if(typeof n=="function"){var C={column:m,value:A,rowData:t,msg:p};if(n.call(r.element,C)==false){o=false;if(C.msg!=p){p=C.msg}}}}}}}}}}if(!o){var s=this.getRowIndx({rowData:t}).rowIndx;if(s!=null){this.goToPage({rowIndx:s});this.scrollRow({rowIndx:s});this.editCell({rowIndx:s,dataIndx:x})}var i=this.getEditCell();if(i&&i.$cell){var q=i.$cell;q.attr("title",p);try{q.tooltip("destroy")}catch(E){}q.tooltip({position:{my:"left top",at:"right top"},content:function(){var H=h(this),j=(G=="")?"":("<span class='ui-icon "+G+" pq-tooltip-icon'></span>");return j+p},open:function(H,I){if(k){I.tooltip.addClass(k)}if(D){var j=I.tooltip.attr("style");I.tooltip.attr("style",j+";"+D)}if(v){I.tooltip.css(v)}}}).tooltip("open");q.find(".pq-editor-focus").focus()}return F}}}return{valid:true}};g.isValid=function(m){var o=m.rowList,j=this.getRowData(m),r=m.dataIndx;if(r==null){var l=this.colModel;for(var n=0,q=l.length;n<q;n++){var k=l[n],p=k.hidden;if(p){continue}var r=k.dataIndx,s=j[r],t=this._isValid({rowData:j,value:s,column:k});if(!t.valid){return t}}}else{var k=this.getColumn({dataIndx:r}),s=(m.value===undefined)?j[r]:m.value,t=this._isValid({rowData:j,value:s,column:k});if(!t.valid){return t}}return{valid:true}};g.isEditableRow=function(i){var k=this.options,j=k.editable;if(j!=null){if(typeof j=="function"){var l=i.rowIndx,m=k.dataModel.data[l];return j.call(this.element,{rowData:m,rowIndx:l})}else{return j}}else{return true}};g.isEditableCell=function(i){var o=i.colIndx,j=i.dataIndx,o=(o==null)?this.getColIndx({dataIndx:j}):o,l=this.colModel[o],j=(j==null)?l.dataIndx:j,k=l.editable;if(i.checkVisible&&l.hidden){return false}if(k!=null){if(typeof k=="function"){var m=i.rowIndx,n=this.getRowData(i);return k.call(this.element,{rowIndx:m,rowData:n,column:l,dataIndx:j})}else{return k}}else{return true}};g._getRowPQData=function(i,j,k){var k=(k==null)?this.data[i]:k;return k?k[j]:null};g._setRowPQData=function(j,i,l){var l=(l==null)?this.data[j]:l;if(!l){return}for(var k in i){l[k]=i[k]}};g._onCellMouseDown=function(j){var k=this;var l=h(j.currentTarget);var i=k.getCellIndices({$td:l});i.$td=l;i.dataModel=k.options.dataModel;if(k._trigger("cellMouseDown",j,i)==false){return false}return true};g._onRowMouseDown=function(j){var l=this;var k=h(j.currentTarget);var i=l.getRowIndx({$tr:k});i.$tr=k;i.dataModel=l.options.dataModel;if(l._trigger("rowMouseDown",j,i)==false){return false}return true};g._onCellMouseEnter=function(i,k){var l=k,j=this;if(j._trigger("cellMouseEnter",i,{$td:l,dataModel:j.options.dataModel})==false){return false}if(j.options.hoverMode=="cell"){j.highlightCell(l)}return true};g._onRowMouseEnter=function(j,n){var m=n,l=this;var k=l.getRowIndx({$tr:m});var i=k.rowIndxPage;if(l._trigger("rowMouseEnter",j,{$tr:m,dataModel:l.options.dataModel})==false){return false}if(l.options.hoverMode=="row"){l.highlightRow(i)}return true};g._onCellMouseLeave=function(i,k){var l=k,j=this;if(j._trigger("cellMouseLeave",i,{$td:l,dataModel:j.options.dataModel})==false){return false}if(j.options.hoverMode=="cell"){j.unHighlightCell(l)}return true};g._onRowMouseLeave=function(j,n){var m=n,l=this;var k=l.getRowIndx({$tr:m});var i=k.rowIndxPage;if(l._trigger("rowMouseLeave",j,{$tr:m,dataModel:l.options.dataModel})==false){return false}if(l.options.hoverMode=="row"){l.unHighlightRow(i)}return true};g._onCellMouseMove=function(j){var k=this;var l=h(j.currentTarget);var i=k.getCellIndices({$td:l});i.$td=l;i.dataModel=k.options.dataModel;if(k._trigger("cellMouseMove",j,i)==false){return false}return true};g._onRowMouseMove=function(j){var l=this;var k=h(j.currentTarget);var i=l.getRowIndx({$tr:k});i.$tr=k;i.dataModel=l.options.dataModel;if(l._trigger("rowMouseMove",j,i)==false){return false}return true};g._onCellMouseUp=function(j){var k=this;var l=h(j.currentTarget);var i=k.getCellIndices({$td:l});i.$td=l;i.dataModel=k.options.dataModel;if(k._trigger("cellMouseUp",j,i)==false){return false}return true};g._onClickCell=function(u){var p=this,s=this.options,m=this.colModel,r=s.editModel,t=s.selectionModel;var j=h(u.currentTarget);var v=p.getCellIndices({$td:j});var i=v.rowIndxPage,o=p.rowIndxOffset,n=i+o,k=v.colIndx;v.rowIndx=n;if(k==null){return}var l=m[k],q=l.dataIndx;v.dataIndx=q;v.evt=u;if(p._trigger("cellClick",u,{$td:j,rowIndxPage:i,rowIndx:n,colIndx:k,dataIndx:q,column:l,rowData:p.data[i]})==false){return false}if(r.clicksToEdit==1&&this.isEditableRow({rowIndx:n})&&this.isEditableCell({colIndx:k,rowIndx:n})){window.setTimeout(function(){p.editCell(v)},0);return}};g._onRightClickCell=function(r){var j=h(r.currentTarget);var u=this.getCellIndices({$td:j});var p=this,i=u.rowIndxPage,n=this.rowIndxOffset,o=i+n,k=u.colIndx,m=this.colModel,t=this.options,s=t.DM;if(k==null){return}var l=m[k],q=l.dataIndx;if(this._trigger("cellRightClick",r,{$td:j,rowIndxPage:i,rowIndx:o,colIndx:k,dataIndx:q,column:l,rowData:p.data[i]})==false){return false}};g.highlightCell=function(i){i.addClass("pq-grid-cell-hover ui-state-hover")};g.unHighlightCell=function(i){i.removeClass("pq-grid-cell-hover ui-state-hover")};g.highlightRow=function(j){if(isNaN(j)){}else{var i=this.getRow({rowIndxPage:j});if(i){i.addClass("pq-grid-row-hover ui-state-hover")}}};g.unHighlightRow=function(j){if(isNaN(j)){}else{var i=this.getRow({rowIndxPage:j});if(i){i.removeClass("pq-grid-row-hover ui-state-hover")}}};g._getCreateEventData=function(){return{dataModel:this.options.dataModel,data:this.data,colModel:this.options.colModel}};g._refreshOptions=function(){this._refreshDataOptions()};g._refreshDataOptions=function(){};g.enableSelection=function(){this.$cont.enableSelection()};g.disableSelection=function(){this.$cont.disableSelection();this.$header.find("tr.pq-grid-title-row").disableSelection()};g._isEditCell=function(k){var i=h(k.target);var j=i.closest("div.pq-editor-border-edit");if(j&&j.length>0){return true}return false};g._findCellFromEvt=function(j){var i=h(j.target);var l=i.closest(".pq-grid-cell");if(l==null||l.length==0){return{rowIndxPage:null,colIndx:null,$td:null}}else{var k=this.getCellIndices({$td:l});k.$td=l;return k}};g._initPager=function(){var i=this.options.pageModel;var j=this;var k={rPP:i.rPP,rPPOptions:i.rPPOptions,change:function(l,n){j.quitEditMode();var m=j.options.pageModel;if(n.curPage!=undefined){m.prevPage=m.curPage;m.curPage=n.curPage}if(n.rPP!=undefined){m.rPP=n.rPP}if(m.type=="remote"){j.remoteRequest({callback:function(){j._onDataAvailable({apply:true})}})}else{j.refreshView()}},refresh:function(l){j.refreshDataAndView()}};if(i.type){this.$footer.pqPager(k)}else{}};g._refreshHideArrHS=function(){var o=this,k=this.colModel,m=o.hidearrHS,n=o.initH,q=o.finalH,p=parseInt(this.options.freezeCols);for(var l=0;l<p;l++){m[l]=false}for(var l=p;l<n;l++){m[l]=true}for(var l=n;l<=q;l++){m[l]=false}for(var l=q+1,j=k.length;l<j;l++){m[l]=true}};g.generateLoading=function(){if(this.$loading){this.$loading.remove()}this.$loading=h("<div class='pq-loading'></div>").appendTo(this.element);h(["<div class='pq-loading-bg'></div><div class='pq-loading-mask ui-state-highlight'><div>",this.options.strLoading,"...</div></div>"].join("")).appendTo(this.$loading);this.$loading.find("div.pq-loading-bg").css("opacity",0.2)};g._refreshLoadingString=function(){this.$loading.find("div.pq-loading-mask").children("div").html(this.options.strLoading)};g.showLoading=function(){if(this.showLoadingCounter==null){this.showLoadingCounter=0}this.showLoadingCounter++;this.$loading.show()};g.hideLoading=function(){if(this.showLoadingCounter>0){this.showLoadingCounter--}if(!this.showLoadingCounter){this.$loading.hide()}};g.refreshDataFromDataModel=function(){this._trigger("beforeRefreshData",null,{});var l=this.options,k=l.dataModel,n=l.pageModel,m=k.data,j=n.type;this.rowIndxOffset=0;if(m==null||m.length==0){if(j){n.curPage=0;n.totalPages=0;n.totalRecords=0}this.data=m;return}if(j&&j=="local"){n.totalRecords=m.length;n.totalPages=Math.ceil(m.length/n.rPP);if(n.curPage>n.totalPages){n.curPage=n.totalPages}if(n.curPage<1&&n.totalPages>0){n.curPage=1}var p=(n.curPage-1)*n.rPP;var i=n.curPage*n.rPP;if(i>m.length){i=m.length}this.data=m.slice(p,i)}else{if(j=="remote"){var o=Math.ceil(n.totalRecords/n.rPP);n.totalPages=o;if(o&&!n.curPage){n.curPage=1}var i=n.rPP;if(i>m.length){i=m.length}this.data=m.slice(0,i)}else{this.data=m.slice(0)}}if(j=="local"||j=="remote"){this.rowIndxOffset=(n.rPP*(n.curPage-1))}};h.paramquery.filter=function(){var i={begin:{text:"Begins With",TR:true,string:true},between:{text:"Between",TR:true,string:true,date:true,number:true},notbegin:{text:"Does not begin with",TR:true,string:true},contain:{text:"Contains",TR:true,string:true},notcontain:{text:"Does not contain",TR:true,string:true},equal:{text:"Equal To",TR:true,string:true,bool:true},notequal:{text:"Not Equal To",TR:true,string:true},empty:{text:"Empty",TR:false,string:true,bool:true},notempty:{text:"Not Empty",TR:false,string:true,bool:true},end:{text:"Ends With",TR:true,string:true},notend:{text:"Does not end with",TR:true,string:true},less:{text:"Less Than",TR:true,number:true,date:true},lte:{text:"Less than or equal",TR:true,number:true,date:true},range:{TR:true,string:true,number:true,date:true},regexp:{TR:true,string:true,number:true,date:true},great:{text:"Great Than",TR:true,number:true,date:true},gte:{text:"Greater than or equal",TR:true,number:true,date:true}};return{conditions:i,getAllConditions:(function(){var j=[];for(var k in i){j.push(k)}return j})(),getConditions:function(l){var j=[];for(var k in i){if(i[k][l]){j.push(k)}}return j},getTRConditions:(function(){var j=[];for(var k in i){if(i[k].TR){j.push(k)}}return j})(),getWTRConditions:(function(){var j=[];for(var k in i){if(!i[k].TR){j.push(k)}}return j})()}}();h.paramquery.filter.rules={};h.paramquery.filter.rules.en={begin:"Begins With",between:"Between",notbegin:"Does not begin with",contain:"Contains",notcontain:"Does not contain",equal:"Equal To",notequal:"Not Equal To",empty:"Empty",notempty:"Not Empty",end:"Ends With",notend:"Does not end with",less:"Less Than",lte:"Less than or equal",great:"Great Than",gte:"Greater than or equal"};g.getQueryStringSort=function(){var n=this.iSort.sorters,o="",r=this.options,q=r.sql,l=r.stringify;if(q){for(var k=0;k<n.length;k++){var p=n[k],m=p.dataIndx,j=p.dir=="up"?"asc":"desc";o+=(k>0?", ":"")+m+" "+j}return o}else{if(n.length){if(l===false){return n}else{return JSON.stringify(n)}}else{return""}}};g.getQueryStringCRUD=function(){return""};g.getQueryStringFilter=function(){var u=this.options,w=u.sql,r=u.stringify,n=u.filterModel,i=n.mode,o=this.colModel,l=this.getFilterData({CM:o,location:"remote"}),k="";if(n&&n.on&&l){if(w){k=[];for(var p=0;p<l.length;p++){var s=l[p],m=s.condition,t=s.dataIndx,v=h.trim(s.value);if(m==="contain"){k.push(t+" like '%"+v+"%'")}else{if(m==="notcontain"){k.push(t+" not like '%"+v+"%'")}else{if(m==="begin"){k.push(t+" like '"+v+"%'")}else{if(m==="end"){k.push(t+" like '%"+v+"'")}else{if(m==="equal"){k.push(t+"='"+v+"'")}else{if(m==="notequal"){k.push(t+"!='"+v+"'")}else{if(m==="empty"){k.push("isnull("+t+",'')=''")}else{if(m==="notempty"){k.push("isnull("+t+",'')!=''")}else{if(m==="less"){k.push(t+"<'"+v+"'")}else{if(m==="great"){k.push(t+">'"+v+"'")}}}}}}}}}}}k=k.join(" "+i+" ")}else{if(l.length){var q={mode:i,data:l};if(r===false){k=q}else{k=JSON.stringify(q)}}else{k=""}}}return k};g.remoteRequest=function(i){if(this.loading){this.xhr.abort()}var r=this,o="",n="",s=this.options,k=false,w=this.colModel,t=s.dataModel,m=s.filterModel,v=s.pageModel;if(typeof t.getUrl=="function"){var u={colModel:w,dataModel:t,groupModel:s.groupModel,pageModel:v,filterModel:m};var l=t.getUrl.call(this.element,u);if(l&&l.url){o=l.url}if(l&&l.data){n=l.data}}else{if(typeof t.url=="string"){o=t.url;var q={},p={},y={};if(t.sorting=="remote"){var x=this.getQueryStringSort();if(x){q={pq_sort:x}}}if(v.type=="remote"){y={pq_curpage:v.curPage,pq_rpp:v.rPP}}var A;if(m.type!="local"){A=this.getQueryStringFilter();if(A){k=true;p={pq_filter:A}}}var j=t.postData,z=t.postDataOnce;if(j&&typeof j=="function"){j=j.call(this.element,{colModel:w,dataModel:t})}n=h.extend({pq_datatype:t.dataType},p,y,q,j,z)}}if(!o){return}this.loading=true;this.showLoading();this.xhr=h.ajax({url:o,dataType:t.dataType,async:(t.async==null)?true:t.async,cache:t.cache,contentType:t.contentType,type:t.method,data:n,beforeSend:function(C,B){if(typeof t.beforeSend=="function"){return t.beforeSend.call(r.element,C,B)}},success:function(B,E,C){if(typeof t.getData=="function"){var D=t.getData.call(r.element,B,E,C);t.data=D.data;if(v.type&&v.type=="remote"){if(D.curPage){v.curPage=D.curPage}if(D.totalRecords){v.totalRecords=D.totalRecords}}}else{t.data=B.data;if(v.type&&v.type=="remote"){if(B.curPage){v.curPage=B.curPage}if(B.totalRecords){v.totalRecords=B.totalRecords}}}r.hideLoading();r.loading=false;r._trigger("load",null,{dataModel:t,colModel:w});if(k){r._trigger("filter",null,{type:"remote",dataModel:t,colModel:w,filterModel:m})}if(i&&i.callback){i.callback()}},error:function(B,D,C){r.hideLoading();r.loading=false;if(typeof t.error=="function"){t.error.call(r.element,B,D,C)}else{if(C!="abort"){throw ("Error : "+C)}}}})};g._fixFireFoxContentEditableIssue=function(){if(window.postMessage){}};g.setFlexWHCallback=function(i){var j=this;i.call(j);if(this.options.flexHeight){this.setGridHeightFromTable()}if(this.options.flexWidth){this._setGridWidthFromTable()}};g._refreshTitle=function(){this.$title.html(this.options.title)};g._refreshDraggable=function(){if(this.options.draggable){this.$title.addClass("draggable");this.element.draggable({handle:this.$title,start:function(i,j){}})}else{this._destroyDraggable()}};g._refreshResizable=function(){var i=this;if(this.options.resizable){this.element.resizable({helper:"ui-state-highlight",delay:0,start:function(j,k){h(k.helper).css({opacity:0.5,background:"#ccc",border:"1px solid steelblue"})},resize:function(j,k){},stop:function(j,k){i.options.height=i.element.height();i.options.width=i.element.width();i._refresh();i.element.css("position","relative")}})}else{this._destroyResizable()}};g.refresh=function(i){this._refresh(i)};g._refreshDataIndices=function(){if(this.options.getDataIndicesFromColIndices==false){return}var j=this.colModel,m=j.length;for(var k=0;k<m;k++){var l=j[k];if(l.dataIndx==null){l.dataIndx=k}}};g.refreshView=function(i){if(this.$td_edit!=null){this.quitEditMode({silent:true})}this.refreshDataFromDataModel();this._refresh(i)};g._refresh=function(i){var j=this;this._refreshGridWidth();this._refreshDataIndices();this._refreshResizable();this._refreshDraggable();this._refreshColumnWidths();this._computeOuterWidths();this._setScrollHNumEles();this._bufferObj_calcInitFinalH();this._refreshHideArrHS();if(!i||i.header!==false){this._createHeader()}this._refreshHeaderSortIcons();this._setInnerGridHeight();this._setRightGridHeight();this.setFlexWHCallback(function(){j.iGenerateView.generateView();j._computeOuterWidths()});this._setScrollHLength();this._setScrollVLength();this._setScrollVNumEles(true);this._setScrollHLength();this._setScrollHVLength();this._refreshPager();this._refreshFreezeLine();this.disableSelection();this.options.dataModel.postDataOnce=undefined};g._setScrollHVLength=function(){var i=this.options;if(this.$hscroll.is(":hidden")||i.flexHeight||i.flexWidth){this.$hvscroll.css("visibility","hidden")}};g._refreshPager=function(){var l=this.options,k=l.pageModel,j=this.$footer,i=k.type?true:false,n=k.rPP,o=k.totalRecords;if(i){var m=l.pageModel;if(j.hasClass("pq-pager")==false){this._initPager()}j.pqPager("option",m);if(o>n){this.$bottom.css("display","")}}else{if(j.hasClass("pq-pager")){j.pqPager("destroy")}if(l.showBottom){this.$bottom.css("display","")}else{this.$bottom.css("display","none")}}};g._refreshViewAfterDataSort=function(){this._refresh()};g.refreshSortingDataAndView=function(){this._refreshSortingDataAndView({sorting:true})};g.getThis=function(){return{that:this}};g._addRowsData=function(p){var o=p.data,n=this.options.dataModel.data,l=p.rowIndx;if(n==null){n=[]}if(l==null){for(var k=0,j=o.length;k<j;k++){var m=o[k];n.push(m)}}else{if(l<n.length){for(var k=0,j=o.length;k<j;k++){var m=o[k];n.splice(l,0,m);l++}}else{return false}}return true};g.addRows=function(i){if(this._addRowsData(i)){this.refreshDataFromDataModel();this.refresh();return true}else{return false}};g.refreshDataAndView=function(i){var k=this.options.dataModel;this.iSort._refreshSorters();if(k.location=="remote"){var j=this;this.remoteRequest({callback:function(){j._onDataAvailable(i)}})}else{this._onDataAvailable(i)}};g.getColIndx=function(n){var l=n.dataIndx;if(l===undefined){throw ("dataIndx NA")}var k=this.colModel;for(var m=0,j=k.length;m<j;m++){if(k[m].dataIndx==l){return m}}};g.getColumn=function(o){if(o.dataIndx===undefined){throw ("dataIndx N/A")}var l=o.dataIndx;var k=this.colModel;for(var m=0,j=k.length;m<j;m++){var n=k[m];if(n.dataIndx==l){return n}}return null};g._onDataAvailable=function(){};g._computeOuterWidths=function(){var o=this.options,n=o.columnBorders,k=o.numberCell,j=this.colModel,m=this.outerWidths,q=j.length;for(var l=0;l<q;l++){var p=j[l];m[l]=parseInt(p.width)+((n)?1:0)}if(k.show){this.numberCell_outerWidth=k.width+1}return};g._setOption=function(j,k){var i=this.options;if(j=="height"){this.element.height(k);this._super.call(this,j,k)}else{if(j=="width"){this._super.call(this,j,k);this._refreshGridWidth()}else{if(j=="title"){this._super.call(this,j,k);this._refreshTitle()}else{if(j=="roundCorners"){if(k){this.element.addClass("ui-corner-all");this.$top.addClass("ui-corner-top");this.$bottom.addClass("ui-corner-bottom")}else{this.element.removeClass("ui-corner-all");this.$top.removeClass("ui-corner-top");this.$bottom.removeClass("ui-corner-bottom")}}else{if(j=="freezeCols"){if(!isNaN(k)&&k>=0&&parseInt(k)<=this.colModel.length-2){i.freezeCols=parseInt(k);this._refreshFreezeLine();this._setScrollHLength();this._super.call(this,j,k)}}else{if(j=="resizable"){this._super.call(this,j,k)}else{if(j=="scrollModel"){this._super.call(this,j,k)}else{if(j=="dataModel"){this._super.call(this,j,k)}else{if(j=="pageModel"){this._super.call(this,j,k)}else{if(j==="selectionModel"){var l=k;for(var j in l){this.options.selectionModel[j]=l[j]}}else{if(j==="colModel"){this._super.call(this,j,k);this._calcThisColModel();this._refresh()}else{if(j==="disabled"){if(k===true){this._disable()}else{this._enable()}}else{if(j==="numberCell"){this._super.call(this,j,k)}else{if(j==="customData"){this._super.call(this,j,k)}else{if(j==="strLoading"){this._super.call(this,j,k);this._refreshLoadingString()}else{if(j==="showTop"){if(k===true){this.$top.css("display","")}else{this.$top.css("display","none")}}else{if(j==="showTitle"){if(k===true){this.$title.css("display","")}else{this.$title.css("display","none")}}else{if(j==="showToolbar"){if(k===true){this.$toolbar.css("display","")}else{this.$toolbar.css("display","none")}}else{if(j=="toolbar"){this.$toolbar.remove();this._super.call(this,j,k);this._createToolbar()}else{if(j==="collapsible"){if(k===true){if(!this.$collapsible){this._createSlidingTop()}this.$collapsible.css("display","")}else{if(this.$collapsible){this.$collapsible.css("display","none")}}}else{if(j==="showBottom"){if(k===true){this.$bottom.css("display","")}else{this.$bottom.css("display","none")}}else{this._super.call(this,j,k)}}}}}}}}}}}}}}}}}}}}}};g._setOptions=function(){this._super.apply(this,arguments)};g._generateCellRowOutline=function(n){var j=n.$td,p=n.$tr,o=n.rowIndxStart,k=this.options.editModel.cellBorderWidth,r=n.colIndxStart,m=n.rowIndxEnd,w=n.colIndxEnd,q=this;if(p){var l=q._calcRightEdgeCol(q.colModel.length-1);l-=4;var t=p[0].offsetHeight-4;var u=h(p[0].offsetParent);var i=u[0].offsetParent;var v=p[0].offsetLeft+u[0].offsetLeft;var s=p[0].offsetTop+u[0].offsetTop;q._generateCellHighlighter(i,v,s,l,t)}else{if(j){var u=h(j[0].offsetParent);var i=u[0].offsetParent;var l=j[0].offsetWidth-(k?(k*2):1);var t=j[0].offsetHeight-(k?(k*2):1);var v=j[0].offsetLeft+u[0].offsetLeft+i.offsetLeft;var s=j[0].offsetTop+u[0].offsetTop-this.$cont.scrollTop();q._generateCellHighlighter(i,v,s,l,t,j)}}};g._removeCellRowOutline=function(i){if(i&&i.old&&this.$div_focus_old){var j=this.$div_focus_old.find(".pq-editor-focus");if(j[0]&&j[0]==document.activeElement){if(this.options.debug){throw ("assert failed")}}this.$div_focus_old.remove();this.$div_focus_old=null}else{if(this.$div_focus){var j=this.$div_focus.find(".pq-editor-focus");if(j[0]==document.activeElement){j.blur()}this.$div_focus.remove();this.$div_focus=null}}};g._generateCellHighlighter=function(l,m,o,j,i,p){var k=this.options.editModel.cellBorderWidth,n=this.$div_focus;if(n){this.$div_focus_old=n}this.$div_focus=h("<div class='pq-editor-border'></div>").appendTo(this.$cont_o);this.$div_focus.css({left:m,top:o,height:i,width:j,borderWidth:k})};g._onHeaderCellClick=function(p,i){var o=this,n=o.colModel[p],m=this.options,l=m.dataModel,k=n.dataIndx,j=n.dataType;if(o._trigger("headerCellClick",i,{column:n,colIndx:p,dataIndx:k})===false){return}if(!m.sortable){return}if(n.sortable==false){return}this.sort({colIndx:p,column:n,dataIndx:k})};g._selectRow=function(j,i){this.selectRow(j,i)};g._findfirstUnhiddenColIndx=function(){for(var j=0;j<this.colModel.length;j++){if(!this.colModel[j].hidden){return j}}};g.selectRow=function(k){var j=k.rowIndx,i=k.evt,l=k.offset;if(i&&(i.type=="keydown"||i.type=="keypress")){if(this.iRows.replace(k)==false){return false}}else{if(this.iRows.add(k)==false){return false}}if(i!=null){}return true};g.scrollY=function(i){this.$vscroll.pqScrollBar("option","cur_pos",i).pqScrollBar("scroll")};g._get$Tbl=function(i,j){return this.$tbl};g.scrollCell=function(i){this.scrollRow(i);this.scrollColumn(i)};g.scrollRow=function(v){var k=v.rowIndxPage,q=(this.iHierarchy?true:false),r=v.rowIndx,j=this.scrollCurPos,k=(k==null)?(r-this.rowIndxOffset):k,t=this.options,u=parseInt(t.freezeRows);if(k<u){return}var x=this._calcCurPosFromRowIndxPage(k);if(x==null){return}if(x<j){this.$vscroll.pqScrollBar("option","cur_pos",x).pqScrollBar("scroll")}var z=this._get$Tbl(k);var B=z.children("tbody").children("tr[pq-row-indx="+k+"]"),E=B.last(),p=E;if(B.length>1){p=B.first()}if(E[0]==undefined){this.$vscroll.pqScrollBar("option","cur_pos",x).pqScrollBar("scroll")}else{var s=E[0].offsetTop+E[0].offsetHeight,A=this.$cont[0].offsetHeight,l=parseInt(z.css("marginTop")),w=this._getScollBarHorizontalHeight(),m=p.prev("tr");if(m.hasClass("pq-row-hidden")||m.hasClass("pq-last-freeze-row")){return}else{if(s>A-w-l){var y=s-(A-w-l);var B=z.children().children("tr");var C=0,D=0;var n;if(u){n=B.filter("tr.pq-last-freeze-row").last().next();if(n.length==0){n=B.filter("tr.pq-row-hidden").next()}}else{n=B.filter("tr.pq-row-hidden").next()}do{C+=n[0].offsetHeight;if(n[0]==E[0]){break}else{if(!q||(n.hasClass("pq-detail-child")==false)){D++;if(C>=y){break}}else{if(C>=y){break}}}n=n.next()}while(1===1);var o=j+D;if(o>x){o=x}var i=this.$vscroll.pqScrollBar("option","num_eles");if(i<o+1){i=o+1}this.$vscroll.pqScrollBar("option",{num_eles:i,cur_pos:o}).pqScrollBar("scroll")}}}};g._bringCellToView=function(z){if(z.rowIndxPage==null||z.colIndx==null){throw"rowIndxPage/colIndx NA"}var k=z.rowIndxPage,o=z.colIndx,p=false,w=this.options.freezeCols;var m;if(this.hidearrHS[o]){this.hidearrHS[o]=false;var v=o-w-this._calcNumHiddenUnFrozens(o);this.$hscroll.pqScrollBar("option","cur_pos",v).pqScrollBar("scroll");p=true}else{var m=this.getCell(z);if(m==null||m.length==0){return false}var r=this._calcRightEdgeCol(o).width;var y=this._getScollBarVerticalWidth();if(r>this.$cont[0].offsetWidth-y){var x=d.call(this,-1,o+1)-(this.$cont[0].offsetWidth-y);var j=m.parent("tr").children("td");var q=this.colModel,u=this.outerWidths,l=q.length;var n=0,t=0;for(var s=w;s<l;s++){if(!q[s].hidden){n+=u[s]}if(s==o){t=s-w-this._calcNumHiddenUnFrozens(s);break}else{if(n>=x){t=s-w-this._calcNumHiddenUnFrozens(s)+1;break}}}this.$hscroll.pqScrollBar("option","cur_pos",t).pqScrollBar("scroll");p=true}}if(p){var m=this.getCell({rowIndxPage:k,colIndx:o});return m}else{return m}};g.scrollColumn=function(w){var l=w.colIndx,l=(l==null)?this.getColIndx({dataIndx:w.dataIndx}):l,s=this.options.freezeCols;var m=this._calcRightEdgeCol(l).width,v=this._getScollBarVerticalWidth(),u=this.$cont[0].offsetWidth;if(m>u-v){var t=d.call(this,-1,l+1)-(u-v),n=this.colModel,q=this.outerWidths,j=n.length,k=0,p=0;for(var o=s;o<j;o++){if(!n[o].hidden){k+=q[o]}if(o==l){p=o-s-this._calcNumHiddenUnFrozens(o);break}else{if(k>=t){p=o-s-this._calcNumHiddenUnFrozens(o)+1;break}}}this.$hscroll.pqScrollBar("option","cur_pos",p).pqScrollBar("scroll");return true}else{if(this.hidearrHS[l]){this.hidearrHS[l]=false;var r=l-s-this._calcNumHiddenUnFrozens(l);this.$hscroll.pqScrollBar("option","cur_pos",r).pqScrollBar("scroll");return true}}return false};g.selection=function(l){var j=l.rowIndx,k=l.colIndx,m=l.method,i=l.type;if(i=="row"){return this["iRows"][m](l)}else{if(i=="cell"){return this["iCells"][m](l)}}return};g._bringPageIntoView=function(p){var n=p.rowIndx,m=this;var j=this.options.pageModel;if(j.type=="local"&&n>=0){var l=j.curPage;var o=j.rPP;var k=(l-1)*o;var i=l*o;if(n>=k&&n<i){}else{j.curPage=Math.ceil((n+1)/o);this.refreshDataFromDataModel();this._refreshViewAfterDataSort()}}};g.goToPage=function(n){var i=this.options.pageModel;if(i.type=="local"||i.type=="remote"){var k=n.rowIndx,m=i.rPP,l=(n.page==null)?Math.ceil((k+1)/m):n.page,j=i.curPage;if(l!=j){i.curPage=l;if(i.type=="local"){this.refreshDataFromDataModel();this._refresh()}else{this.refreshDataAndView()}}}};g.setSelection=function(o){if(o==null){this.iRows.removeAll({raiseEvent:true});this.iCells.removeAll({raiseEvent:true});return false}var l=this.data,k,i;if(o.rowData){var n=this.getRowIndx(o);k=n.rowIndx}else{var p=this.rowIndxOffset,k=o.rowIndx,i=o.rowIndxPage,k=(k==null)?i+p:k}var m=(o.colIndx==null&&o.dataIndx!==undefined)?this.getColIndx({dataIndx:o.dataIndx}):o.colIndx,j=o.evt;if(k<0||m<0||m>=this.colModel.length){return false}if(l==null||l.length==0){return false}o.rowIndx=k;o.colIndx=m;this._bringPageIntoView(o);i=k-this.rowIndxOffset;o.rowIndxPage=i;this.scrollRow({rowIndxPage:i});if(m==null){return this._selectRow(o)}else{this._bringCellToView({rowIndxPage:i,colIndx:m});return this.selectCell(o)}};g.getColModel=function(){return this.colModel};g.saveEditCell=function(j){if(this.$td_edit==null){return}var n=this.$td_edit,w=j?j.evt:null,u=this.getCellIndices({$td:n}),m=this.rowIndxOffset,x=u.colIndx,i=u.rowIndxPage,p=i+m,y=this.colModel,k=y[x],t=k.dataIndx,q=this.data[i],l=this.options,s=l.dataModel,r;if(q==null){return}else{r=q[t]}u.rowIndx=p;u.column=k;u.dataIndx=t;if(i!=null){var z=this._getEditCellData(u);if(z=="<br>"){z=""}if(r==null&&z===""){z=null}var v={rowIndx:p,dataIndx:t,column:k,newVal:z,value:z,oldVal:r,rowData:q,dataModel:s};if(this._trigger("cellBeforeSave",w,v)===false){return false}if(z!=r){q[t]=z;this._trigger("cellSave",w,v);if(l.track){var q=this.getRowData({rowIndx:p});this.iUCData.update({rowData:q,dataIndx:t,oldVal:r,newVal:z})}this.refreshCell(u);this._fixTableViewPort();var o=this;if(l.flexHeight){o.setGridHeightFromTable();o._fixIEFooterIssue()}else{if(j){o.scrollRow({rowIndxPage:i})}}}return true}};g._fixTableViewPort=function(){var i=this.$cont[0];i.scrollTop=0;i.scrollLeft=0};g._fixIEFooterIssue=function(){h(".pq-grid-footer").css({position:"absolute"});h(".pq-grid-footer").css({position:"relative"})};g.refreshColumn=function(l){var o=this.options.customData,k=(l.colIndx==null)?this.getColIndx({dataIndx:l.dataIndx}):l.colIndx,n=this.getRowIndxOffset();l.colIndx=k;for(var m=this.init;m<=this["final"];m++){var i=m;l.rowIndx=i+n;l.rowIndxPage=i;var j=this.colModel[k];l.$td=this.getCell(l);l.rowData=this.data[i];l.customData=o;l.column=j;this.iGenerateView._renderCell(l)}};g.refreshCell=function(q){if(!this.data){return}var o=this.rowIndxOffset,p=q.rowIndx,i=q.rowIndxPage,p=q.rowIndx=(p==null)?i+o:p,i=q.rowIndxPage=(i==null)?p-o:i,r=q.dataIndx,k=q.colIndx,k=q.colIndx=(k==null)?this.getColIndx({dataIndx:r}):k,j=q.$td=(q.$td==null)?this.getCell(q):q.$td,m=q.column=this.colModel[k],s=this.options.treeModel,l=this.data[i];if(!l){return}var n=q;n.tree=s.labelIndx?true:false,n.rowData=l;n.customData=this.options.customData;if(j&&j.length>0){this.iGenerateView._renderCell(n)}};g.refreshRow=function(p){if(!this.data){return}var q=this.options,m=this.rowIndxOffset,o=p.rowIndx,i=p.rowIndxPage,o=(o==null)?i+m:o,i=(i==null)?o-m:i,n=(p.$tr==null)?this.getRow(p):p.$tr,k=this.colModel,j=this.data[i];if(!j){return}var l=[];this.iGenerateView._generateRow(j,i,k,l,null);var r=l.join("");n.replaceWith(r);this._trigger("refresh",null,{type:"row",dataModel:q.dataModel,colModel:k,rowData:j,rowIndx:o,rowIndxPage:i});return};g.quitEditMode=function(w){var q=this,k=false,s=false,m=false,t=this.options.selectionModel,u=undefined;if(w){k=w.old;s=w.silent;m=w.fireOnly;u=w.evt}var j=k?this.$td_edit_old:this.$td_edit;if(j){var o,i,l,n,r,v=function(){if(k){q.$td_edit_old=null}else{q.$td_edit=null}};if(!k){this.disableSelection()}var p=this.getCellIndices({$td:j});if(p&&p.rowIndx!=null){o=p.rowIndx;i=o-this.offsetRowIndx,l=p.colIndx;n=this.colModel[l];r=n.dataIndx}else{v();return}if(!k&&!m){if(t.type=="cell"){j.attr("tabindex","0").focus()}else{if(t.type=="row"){j.parent("tr.pq-grid-row").attr("tabindex","0").focus()}}}if(!s&&!k){this._trigger("quitEditMode",u,{$td:j,rowIndx:o,rowIndxPage:i,colIndx:l,column:n,dataIndx:r,rowData:this.data[i]})}if(!m){this._removeCellRowOutline(w);v()}}};g.getData=function(){return this.data};g.getViewPortRowsIndx=function(){return{beginIndx:this.init,endIndx:this["final"]}};g.getRowIndxOffset=function(){return this.rowIndxOffset};g.selectCell=function(l){var j=l.rowIndx,k=l.colIndx,i=l.evt;if(i&&(i.type=="keydown"||i.type=="keypress")){if(this.iCells.replace(l)==false){return false}}else{if(this.iCells.add(l)==false){return false}}if(i!=null){}return true};g._setGridFocus=function(){var i=this;var j=true;window.setTimeout(function(){if(i.$td_edit==null){if(j){j=false}}},0)};g.getEditCell=function(){if(this.$td_edit){return{$td:this.$td_edit,$cell:this.$div_focus}}else{return null}};g.editCell=function(i){var j=this.getCell(i);if(j!=null&&j.length>0){this._editCell(j);return j}};g.getFirstEditableColIndx=function(j){if(j.rowIndx==null){throw"rowIndx NA"}if(!this.isEditableRow(j)){return -1}var k=this.colModel;for(var l=0;l<k.length;l++){j.colIndx=l;if(!this.isEditableCell(j)){continue}else{if(k[l].hidden){continue}}return l}return -1};g.editFirstCellInRow=function(j){var n=this.rowIndxOffset,k=j.rowIndx,i=j.rowIndxPage,k=(k==null)?(i+n):k,i=(i==null)?(k-n):i,l=this.getFirstEditableColIndx({rowIndx:k});if(l!=-1){this.scrollRow({rowIndxPage:i});var m=this._bringCellToView({colIndx:l,rowIndxPage:i});if(m&&m.length>0){this._editCell(m)}}};g._editCell=function(S){var C=this;var j=C.getCellIndices({$td:S});var p=j.rowIndxPage,G=this.rowIndxOffset,u=p+G,s=j.colIndx,L=this.colModel[s],r=L.editor,q=this.options.editor,i=r?h.extend({},q,r):q,N=C.data[p],F=false,D=L.dataIndx;if(this.$td_edit){if(this.$td_edit[0]==S[0]){return false}else{this.$td_edit_old=this.$td_edit;this.quitEditMode({fireOnly:true})}}this.$td_edit=S;this._generateCellRowOutline({$td:S});var E=this.$div_focus.addClass("pq-editor-border-edit");if(L.align=="right"){E.addClass("pq-align-right")}else{if(L.align=="center"){E.addClass("pq-align-center")}else{E.addClass("pq-align-left")}}var P=E.width()-8,T=N[D],I;var H=i.type,w=i.select,y=i.cls?i.cls:"",l="pq-editor-focus "+y,k=l+" pq-cell-editor ",t=i.attr?i.attr:"",B=i.style,B=(B?B:""),m=B?("style='"+B+"'"):"",O="style='width:"+P+"px;"+B+"'",M=B?("style='"+B+"'"):"";if(typeof H=="function"){I=H.call(C.element,{$cell:E,cellData:T,rowData:N,cls:l,dataIndx:D,data:i.data,column:L})}else{if(H=="checkbox"){var Q=i.subtype;var z=T?"checked='checked'":"";I="<input "+z+" class='"+k+"' "+t+" "+M+" type=checkbox name='"+D+"' />";E.html(I);var K=E.children("input");if(Q=="triple"){K.pqval({val:T});E.click(function(U){h(this).children("input").pqval({incr:true})})}}else{if(H=="textarea"||H=="select"||H=="textbox"){if(H=="textarea"){I="<textarea class='"+k+"' "+t+" "+O+" name='"+D+"' ></textarea>"}else{if(H=="select"){var x=i.options;var x=x?x:[];if(typeof x==="function"){x=x.call(C.element,{column:L,rowData:N})}var o=[t," class='",k,"' ",O," name='",D,"'"].join("");I=h.paramquery.select({options:x,attr:o,labelIndx:i.labelIndx,valueIndx:i.valueIndx,groupIndx:i.groupIndx})}else{I="<input class='"+k+"' "+t+" "+O+" type=text name='"+D+"' />"}}E.html(I);E.children().val(T)}else{I="<div contenteditable='true' tabindx='0' "+m+" "+t+" class='pq-grid-editor-default "+l+"'></div>";E.html(I);E.children().html(T);F=true}}}var C=this;if(C.$td_edit!=null){var E=C.$div_focus,v=E.children(".pq-editor-focus");v.focus();v.bind("keydown",function(U){C.iKeyNav._bodyKeyPressDownInEdit(U)});if(C._trigger("cellEditFocus",null,{$cell:E,$editor:v,dataIndx:D,column:L,rowIndx:u,rowData:N})==false){return false}if(w){if(F){try{var R=v[0];var n=document.createRange();n.selectNodeContents(R);var A=window.getSelection();A.removeAllRanges();A.addRange(n)}catch(J){}}else{v.select()}}}if(C.$td_edit_old){C.quitEditMode({old:true})}};g.getRow=function(n){var j=n.rowIndxPage,m=n.rowIndx,o=this.rowIndxOffset,k=this.options.dataModel;var l,p=this.$tbl;if(p!=undefined){var i=p.children("tbody");if(j!=null){l=i.children("tr[pq-row-indx="+j+"]")}else{if(m!=null){l=i.children("tr[pq-row-indx="+(m-o)+"]")}}}return l};g.getCell=function(n){var j=n.rowIndxPage,m=n.rowIndx,j=(j==null)?(m-this.rowIndxOffset):j,l=n.colIndx,o=n.dataIndx,l=(l==null)?this.getColIndx({dataIndx:o}):l,i=this.$tbl,k,q=this.options,p=q.freezeCols;if(i!=undefined){if(i.length>1){if(l>=p){i=h(i[1])}else{i=h(i[0])}}var k=i.children().children("tr[pq-row-indx="+j+"]").children("td[pq-col-indx="+l+"]")}if(k.length==0||k[0].style.visibility=="hidden"){return null}return k};g.getCellHeader=function(m){var l=m.colIndx,j=m.dataIndx,l=(l==null)?this.getColIndx({dataIndx:j}):l,o=this.$tbl_header,n,i=this.options,k=i.freezeCols;if(o!=undefined){if(o.length>1){if(l>=k){o=h(o[1])}else{o=h(o[0])}}var n=o.children().children("tr:last").children("td[pq-col-indx="+l+"]")}if(n.length==0||n[0].style.visibility=="hidden"){return null}return n};g.getEditCellData=function(){if(this.$td_edit){var i=this.getCellIndices({$td:this.$td_edit});return this._getEditCellData(i)}else{return null}};g._getEditCellData=function(q){if(q.colIndx==undefined||q.rowIndxPage==undefined){throw ("colIndx, rowIndxpage N/A")}var j=q.colIndx,i=q.rowIndxPage,o=(q.rowIndx!=null)?q.rowIndx:i+this.rowIndxOffset,m=(q.column)?q.column:this.colModel[j],k=m.editor,l=this.options.editor,r=k?h.extend({},l,k):l,t=m.dataIndx,u=(q.$cell)?q.$cell:this.$div_focus,v;var p=r.getData;if(typeof p=="function"){v=r.getData.call(this.element,{$cell:u,dataIndx:t,rowIndx:o,rowIndxPage:i,column:m})}else{var w=r.type;if(w=="checkbox"){var s=u.children();if(r.subtype=="triple"){v=s.pqval()}else{v=s.is(":checked")?true:false}}else{if(w=="contenteditable"){v=u.children().html()}else{var n=u.find('*[name="'+t+'"]');if(n&&n.length){v=n.val()}else{var n=u.find(".pq-editor-focus");if(n&&n.length){v=n.val()}}}}}return v};g.getCellIndices=function(j){var m=j.$td;if(m==null||m.length==0||m.closest(".pq-grid")[0]!=this.element[0]){return{rowIndxPage:null,colIndx:null}}var k=m.parent("tr");var i=k.attr("pq-row-indx");if(i==null){return{rowIndxPage:null,colIndx:null}}i=parseInt(i);var l=m.attr("pq-col-indx");if(l==null){return{rowIndxPage:i,colIndx:null}}l=parseInt(l);return{rowIndxPage:i,rowIndx:i+this.rowIndxOffset,colIndx:l,dataIndx:this.colModel[l].dataIndx}};g.getRowsByClass=function(n){var u=this.options,v=u.dataModel,r=u.pageModel,j=r.type,p=(j=="remote")?true:false,l=this.rowIndxOffset,o=v.data,t=[];if(o==null){return t}for(var m=0,q=o.length;m<q;m++){var k=o[m];n.rowData=k;if(this.hasClass(n)){var s={rowData:k};if(p){s.rowIndx=(m+l)}else{s.rowIndx=m}t.push(s)}}return t};g.addClass=function(w){var n=w.rowIndx,r=w.dataIndx,t=w.cls,m=this.rowIndxOffset,k=this.getRowData(w);if(!k){return}if(n==null){n=this.getRowIndx({rowData:k}).rowIndx}var l=t.split(" ");for(var o=0;o<l.length;o++){var v=l[o];if(r==null&&this.hasClass({rowData:k,cls:v})===false){var s=k.pq_rowcls;if(s){k.pq_rowcls=h.trim(s)+" "+v}else{k.pq_rowcls=v}if(n!=null&&w.refresh!==false){var p=this.getRow({rowIndxPage:(n-m)});if(p){p.addClass(v)}}}else{if(this.hasClass({rowData:k,dataIndx:r,cls:v})===false){var u=k.pq_cellcls;if(u){var q=u[r];if(q){u[r]=h.trim(q)+" "+v}else{u[r]=v}}else{var u={};u[r]=v;k.pq_cellcls=u}if(n!=null&&w.refresh!==false){var j=this.getCell({rowIndxPage:(n-m),dataIndx:r});if(j){j.addClass(v)}}}}}};g.removeClass=function(r){var l=r.rowIndx,k=this.getRowData(r),p=r.dataIndx,q=r.cls,i=(p!=null&&k)?k.pq_cellcls:null,n=k?k.pq_rowcls:null;if(k==null){return}if(l==null){l=this.getRowIndx({rowData:k}).rowIndx}if(p==null){if(n){k.pq_rowcls=this._removeClass(n,q)}if(l!=null&&r.refresh!==false){var o=this.getRow({rowIndx:l});if(o){o.removeClass(q)}}}else{if(i){var m=i[p];if(m){k.pq_cellcls[p]=this._removeClass(m,q)}if(l!=null&&r.refresh!==false){var j=this.getCell({rowIndx:l,dataIndx:p});if(j){j.removeClass(q)}}}}};g.hasClass=function(n){var j=n.dataIndx,i=n.cls,m=this.getRowData(n),l=new RegExp("\\b"+i+"\\b"),o;if(m){if(j==null){o=m.pq_rowcls;if(o&&l.test(o)){return true}else{return false}}else{var k=m.pq_cellcls;if(k&&k[j]&&l.test(k[j])){return true}else{return false}}}else{return null}};g._removeClass=function(t,m){if(t){var p=t.split(" "),s=m.split(" "),r=[];for(var n=0,q=p.length;n<q;n++){var u=p[n],v=false;for(var l=0,k=s.length;l<k;l++){var o=s[l];if(u===o){v=true;break}}if(!v){r.push(u)}}if(r.length>1){return r.join(" ")}else{if(r.length===1){return r[0]}else{return null}}}};g.getRowIndx=function(r){var t=r.$tr,m=r.rowData;if(m){var w=this.options,x=w.dataModel,v=w.pageModel,k=v.type,s=(k=="remote")?true:false,q=x.data,l=false;if(q){for(var p=0,u=q.length;p<u;p++){if(q[p]==m){l=true;break}}}if(l){var o=this.rowIndxOffset,j=(s)?p:(p-o),n=(s)?(p+o):p;return{rowIndxPage:j,rowIndx:n}}else{return{}}}else{if(t==null||t.length==0){return{rowIndxPage:null}}var j=t.attr("pq-row-indx");if(j==null){return{rowIndxPage:null}}j=parseInt(j);return{rowIndxPage:j,rowIndx:j+this.rowIndxOffset}}};var b=function(k){this.options=k.options;this.that=k;var j=this;var i=k.widgetEventPrefix.toLowerCase();k.element.on(i+"celleditkeydown",function(l,m){return j.filterKeys(l,m)})};var e=b.prototype;e._incrRowIndx=function(k,n){var q=this.that,o=k,n=(n==null)?1:n,l=q.data,j=0;for(var m=k+1,r=l.length;m<r;m++){var p=l[m].pq_hidden;if(!p){j++;o=m;if(j==n){return o}}}return o};e._decrRowIndx=function(j,m){var o=this.that,l=j,q=o.data,m=(m==null)?1:m,k=0;for(var n=j-1;n>=0;n--){var p=q[n].pq_hidden;if(!p){k++;l=n;if(k==m){return l}}}return l};g.addColumn=function(m,n){var l=this.options,j=l.colModel,p=l.dataModel.data;j.push(m);this._calcThisColModel();for(var k=0;k<p.length;k++){var o=p[k];o.push("")}};g.rowNextSelect=function(){var k=this.selection({type:"row",method:"getSelection"}),j,i,l=this.rowIndxOffset;if(k&&k[0]){j=k[0].rowIndx;i=j-l;i=this.iKeyNav._incrRowIndx(i)}if(i!=null){this.setSelection(null);this._setSelection({rowIndxPage:i})}return i};g.rowPrevSelect=function(){var k=this.selection({type:"row",method:"getSelection"}),j,i,l=this.rowIndxOffset;if(k&&k[0]){j=k[0].rowIndx;i=j-l;i=this.iKeyNav._decrRowIndx(i)}if(i!=null){this.setSelection(null);this.setSelection({rowIndxPage:i})}return i};e._incrIndx=function(i,n){var l=this.that,m=l._getLastVisibleRowIndxPage(l.data),j=l.colModel,o=j.length;if(n==null){if(i==m){return null}i=this._incrRowIndx(i);return{rowIndxPage:i}}var k;do{n++;if(n>=o){if(i==m){return null}i=this._incrRowIndx(i);n=0}k=j[n]}while(k&&k.hidden);return{rowIndxPage:i,colIndx:n}};e._decrIndx=function(i,n){var m=this.that,j=m.colModel,o=j.length,k=m._getFirstVisibleRowIndxPage(m.data);if(n==null){if(i==k){return null}i=this._decrRowIndx(i);return{rowIndxPage:i}}var l;do{n--;if(n<0){if(i==k){return null}i=this._decrRowIndx(i);n=o-1}l=j[n]}while(l&&l.hidden);return{rowIndxPage:i,colIndx:n}};e._incrEditIndx=function(i,l){var r=this.that,n=r.colModel,j=n.length,m,p=r.rowIndxOffset,q=r._getLastVisibleRowIndxPage(r.data);do{l++;if(l>=j){if(i==q){return null}do{i=this._incrRowIndx(i);var o=i+p,s=r.isEditableRow({rowIndx:o});if(i==q&&s==false){return null}}while(s==false);l=0}m=n[l];var o=i+p,k=r.isEditableCell({rowIndx:o,colIndx:l,checkVisible:true})}while(m&&(m.hidden||k==false));return{rowIndxPage:i,colIndx:l}};e._decrEditIndx=function(i,l){var q=this.that,n=q.colModel,j=n.length,m,p=q.rowIndxOffset,s=q._getFirstVisibleRowIndxPage(q.data);do{l--;if(l<0){if(i==s){return null}do{i=this._decrRowIndx(i);var o=i+p,r=q.isEditableRow({rowIndx:o});if(i==s&&r==false){return null}}while(r==false);l=j-1}m=n[l];var o=i+p,k=q.isEditableCell({rowIndx:o,colIndx:l,checkVisible:true})}while(m&&(m.hidden||k==false));return{rowIndxPage:i,colIndx:l}};e._incrEditRowIndx=function(i,k){var o=this.that,l=o.rowIndxOffset,n=o._getLastVisibleRowIndxPage(o.data);if(i==n){return null}do{i=this._incrRowIndx(i);var m=i+l,p=o.isEditableRow({rowIndx:m}),j=o.isEditableCell({rowIndx:m,colIndx:k}),q=(p&&j);if(i==n&&!q){return null}}while(!q);return{rowIndxPage:i,colIndx:k}};e._decrEditRowIndx=function(i,k){var n=this.that,l=n.rowIndxOffset,p=n._getFirstVisibleRowIndxPage(n.data);if(i==p){return null}do{i=this._decrRowIndx(i);var m=i+l,o=n.isEditableRow({rowIndx:m}),j=n.isEditableCell({rowIndx:m,colIndx:k}),q=(o&&j);if(i==p&&!q){return null}}while(!q);return{rowIndxPage:i,colIndx:k}};g._onKeyPressDown=function(i){var j=h(i.target).closest(".pq-grid-header");if(j.length>0){if(this._trigger("headerKeyDown",i,{dataModel:this.options.dataModel})==false){return false}else{return true}}else{var k=this.iKeyNav._bodyKeyPressDown(i);if(k===false){return false}if(this._trigger("keyDown",i,{dataModel:this.options.dataModel})==false){return false}}};e._saveAndMove=function(p,k){var n=this.that,l=this.options,j=l.selectionModel;if(n.saveEditCell({evt:k})==false){k.preventDefault();return false}if(p==null){k.preventDefault();return false}var i=p.rowIndxPage,o=p.colIndx;if(j.type=="row"){n.setSelection(null);n.setSelection({rowIndxPage:i});n._bringCellToView({rowIndxPage:i,colIndx:o})}else{if(j.type=="cell"){n.setSelection(null);n.setSelection({rowIndxPage:i,colIndx:o})}else{n.scrollRow({rowIndxPage:i});n._bringCellToView({rowIndxPage:i,colIndx:o})}}var m=n.getCell({rowIndxPage:i,colIndx:o});if(m&&m.length>0){n._editCell(m)}k.preventDefault();return false};e._bodyKeyPressDownInEdit=function(w){var s=this.that;if(!s.$td_edit){return}var v=this.options,q=s.rowIndxOffset,t=h.ui.keyCode,o=s.colModel,i=v.editModel,k=h(s.$td_edit[0]),r=s.getCellIndices({$td:k}),j=r.rowIndxPage,p=j+q,m=r.colIndx,n=o[m],l=n.editModel,u=l?h.extend({},i,l):i;if(s._trigger("cellEditKeyDown",w,{rowData:s.data[j],$cell:s.$div_focus,rowIndx:p,rowIndxPage:j,colIndx:m,$td:k,dataIndx:n.dataIndx,column:n})==false){return false}if(w.keyCode==t.TAB){var r;if(w.shiftKey){r=this._decrEditIndx(j,m)}else{r=this._incrEditIndx(j,m)}return this._saveAndMove(r,w)}else{if(w.keyCode==u.saveKey){var r=this._incrEditIndx(j,m);return this._saveAndMove(r,w)}else{if(w.keyCode==t.ESCAPE){s.quitEditMode({evt:w});w.preventDefault();return false}else{if(w.keyCode==t.PAGE_UP||w.keyCode==t.PAGE_DOWN){w.preventDefault();return false}else{if(u.keyUpDown){if(w.keyCode==t.DOWN){var r=this._incrEditRowIndx(j,m);return this._saveAndMove(r,w)}else{if(w.keyCode==t.UP){var r=this._decrEditRowIndx(j,m);return this._saveAndMove(r,w)}}}}}}}return};e.filterKeys=function(s,o){var m=this.that,l=this.options.editModel.filterKeys;var k=o.column,q=k.dataType,j=k.editModel;if(j&&j.filterKeys!=undefined){l=j.filterKeys}if(!l){return}if(q=="float"||q=="integer"){var n=h(s.originalEvent.target),p=n[0].nodeName.toLowerCase(),u=(q=="integer")?/^[\-]?[0-9]*$/:/^[\-]?[0-9]*\.?[0-9]*$/;var t=["input","textarea","select"],i="text";if(h.inArray(p,t)!=-1){i="val"}var r=n[i]();window.setTimeout(function(){var v=n[i]();if(u.test(v)==false){n[i](r)}},0)}};e.select=function(j){var m=this.that,l=j.rowIndx,n=j.colIndx,i=m.options.selectionModel,k=j.evt;if(k.shiftKey&&i.mode!="single"){if(i.type=="row"){m.scrollRow({rowIndx:l});m.iRows.extendSelection({rowIndx:l,evt:k})}else{if(i.type=="cell"){m.scrollCell({rowIndx:l,colIndx:n});m.iCells.extendSelection({rowIndx:l,colIndx:n,evt:k})}}}else{m.setSelection({rowIndx:l,colIndx:n,evt:k,setFirst:true})}};e.createTextbox=function(){var i=h("textarea#pq-grid-excel");if(i.length==0){i=h("<textarea id='pq-grid-excel' />").appendTo(document.body)}};e._bodyKeyPressDown=function(v){var q=this.that,x=this,B,z,o=q.rowIndxOffset,s=this.options,l=q.colModel,y=s.selectionModel,r,w;var A=h.ui.keyCode;if(q.$td_edit){q.$td_edit.find(".pq-cell-focus").focus();return}else{if(y.type=="row"){if(v.ctrlKey){z=q.iRows.getFocusSelection({old:true})}else{z=q.iRows.getFocusSelection({old:false})}if(z==null){return}var r=z.rowIndx,i=r-o;if(r==null){return}if(q._trigger("rowKeyDown",v,{rowData:q.data[i],rowIndx:r,rowIndxPage:i})==false){return false}}else{if(y.type=="cell"){if(v.ctrlKey){B=q.iCells.getFocusSelection({old:true})}else{B=q.iCells.getFocusSelection({old:false})}if(B==null){return}var u=B,r=u.rowIndx,i=r-o,t=u.dataIndx,w=q.getColIndx({dataIndx:t});if(r==null||w==null){return}if(q._trigger("cellKeyDown",v,{rowData:q.data[i],rowIndx:r,rowIndxPage:i,colIndx:w,dataIndx:t,column:l[w]})==false){return false}if(v.cancelBubble){return}}else{return}}}if(v.keyCode==A.LEFT){var u=this._decrIndx(i,w);if(u){r=u.rowIndxPage+o;this.select({rowIndx:r,colIndx:u.colIndx,evt:v})}v.preventDefault();return}else{if(v.keyCode==A.RIGHT){var u=this._incrIndx(i,w);if(u){r=u.rowIndxPage+o;this.select({rowIndx:r,colIndx:u.colIndx,evt:v})}v.preventDefault();return}else{if(v.keyCode==A.UP){i=this._decrRowIndx(i);if(i!=null){r=i+o;this.select({rowIndx:r,colIndx:w,evt:v})}v.preventDefault();return}else{if(v.keyCode==A.DOWN){i=this._incrRowIndx(i);if(i!=null){r=i+o;this.select({rowIndx:r,colIndx:w,evt:v})}v.preventDefault();return}else{if(v.keyCode==A.PAGE_DOWN||v.keyCode==A.SPACE){var k=this.pageDown();if(k){i=k.rowIndxPage;if(i!=null){r=i+o;this.select({rowIndx:r,colIndx:w,evt:v})}}v.preventDefault();return}else{if(v.keyCode==A.PAGE_UP){var m=this.pageUp();if(m){i=m.rowIndxPage;if(i!=null){r=i+o;this.select({rowIndx:r,colIndx:w,evt:v})}}v.preventDefault();return}else{if(v.keyCode==A.HOME){if(y.type=="row"||v.ctrlKey){r=q._getFirstVisibleRowIndxPage(q.data)+o;this.select({rowIndx:r,colIndx:w,evt:v})}else{if(y.type=="cell"){w=q._getFirstVisibleColIndx();this.select({rowIndx:r,colIndx:w,evt:v})}}v.preventDefault();return}else{if(v.keyCode==A.END){if(y.type=="row"||v.ctrlKey){r=q._getLastVisibleRowIndxPage(q.data)+o;this.select({rowIndx:r,colIndx:w,evt:v})}else{if(y.type=="cell"){w=q._getLastVisibleColIndx();this.select({rowIndx:r,colIndx:w,evt:v})}}v.preventDefault();return}else{if(v.keyCode==A.ENTER){if(y.type=="row"){var C,n;if(z!=null){q.editFirstCellInRow({rowIndx:i+o})}}else{if(B!=null){var n=q.getCell({rowIndxPage:i,colIndx:w});if(n&&n.length>0){var r=i+o,p=q.isEditableRow({rowIndx:r}),j=q.isEditableCell({rowIndx:r,colIndx:w});if(p&&j){q._editCell(n)}}}}v.preventDefault();return}else{if(v.ctrlKey&&v.keyCode=="65"){if(y.type=="row"&&y.mode!="single"){q.iRows.selectAll({all:y.all})}else{if(y.type=="cell"&&y.mode!="single"){q.iCells.selectAll({all:y.all})}}v.preventDefault();return}else{}}}}}}}}}}};e.incrPageSize=function(){var r=this.that,j=r.$tbl,n=j.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),m=r.$cont[0].offsetHeight,l=parseInt(j.css("marginTop")),p=r._getScollBarHorizontalHeight(),o=m-p-l;for(var q=n.length-1;q>=0;q--){var s=n[q];if(s.offsetTop<o){break}}var k=r.getRowIndx({$tr:h(s)}).rowIndxPage;return{rowIndxPage:k}};e.pageDown=function(){var n=this.that,i=this.incrPageSize().rowIndxPage,l=n._calcCurPosFromRowIndxPage(i);if(l==null){return}var k=n.$vscroll.pqScrollBar("option"),j=k.cur_pos,m=k.num_eles;if(j<m-1){n.$vscroll.pqScrollBar("option","cur_pos",l).pqScrollBar("scroll")}return{rowIndxPage:i,curPos:l}};e.pageUp=function(){var n=this.that,i=this.decrPageSize().rowIndxPage,l=n._calcCurPosFromRowIndxPage(i);if(l==null){return}var k=n.$vscroll.pqScrollBar("option"),j=k.cur_pos,m=k.num_eles;if(j>0){n.$vscroll.pqScrollBar("option","cur_pos",l).pqScrollBar("scroll")}return{rowIndxPage:i,curPos:l}};e.decrPageSize=function(){var l=this.that,o=l.$tbl,j=o.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),n=l.options.freezeRows,i=0;if(j.length){var k,m;if(n){k=j.filter("tr.pq-last-freeze-row");if(k.length){k=k.next()}}else{if(j.length>=2){k=h(j[1])}}if(k&&k.length){var i=l.getRowIndx({$tr:k}).rowIndxPage;i=i-l.pageSize+4;if(i<0){i=0}}}return{rowIndxPage:i}};g._calcNumHiddenFrozens=function(){var j=0,l=this.options.freezeCols;for(var k=0;k<l;k++){if(this.colModel[k].hidden){j++}}return j};g._calcNumHiddenUnFrozens=function(n){var k=0,m=this.options.freezeCols;var j=(n!=null)?n:this.colModel.length;for(var l=m;l<j;l++){if(this.colModel[l].hidden){k++}}return k};g._setScrollHLength=function(){var k=this.options;if(!k.scrollModel.horizontal){this.$hscroll.css("visibility","hidden");this.$hvscroll.css("visibility","hidden");return}else{this.$hscroll.css("visibility","");this.$hvscroll.css("visibility","")}var l=this.$cont[0].offsetWidth;var i=this.colModel;var j=this._getScollBarVerticalWidth();if(j==0){this.$hscroll.css("right",0)}else{this.$hscroll.css("right","")}l-=j;this.$hscroll.pqScrollBar("option","length",l)};g._setScrollHNumEles=function(){var j=this.options,i=j.scrollModel,k=0;if(!j.flexWidth){if(i.lastColumn=="fullScroll"){k=this.colModel.length-j.freezeCols-this._calcNumHiddenUnFrozens()}else{k=this.calcColsOutsideCont(this.colModel)+1}}this.$hscroll.pqScrollBar("option","num_eles",k)};g.calcColsOutsideCont=function(q){var s=this.options.numberCell,o=(this.$tbl)?this.$tbl[this.$tbl.length-1]:null,k=o?o.scrollWidth:0,u=this.options.freezeCols,r=this.outerWidths,t=this.$cont[0].offsetWidth-this._getScollBarVerticalWidth();k=0;if(s.show){k+=this.numberCell_outerWidth}for(var p=0;p<q.length;p++){var m=q[p];if(!m.hidden){k+=r[p]}}var l=0,j=0;var n=k;if(n>t){j++}for(p=u;p<q.length;p++){m=q[p];if(!m.hidden){l+=r[p];n=k-l;if(n>t){j++}else{break}}}return j};g._getScollBarHorizontalHeight=function(){var j=17,i=this.$hscroll;if(i.css("visibility")=="hidden"||this.options.scrollModel.horizontal==false||i.css("display")=="none"){j=0}return j};g._getScollBarVerticalWidth=function(){var j=17,i=this.$vscroll;if(this.init==null||i.css("visibility")=="hidden"||this.options.flexHeight||i.css("display")=="none"){j=0}return j};g._setScrollVNumEles=function(n){var r=this,s=this.$vscroll,q=(this.iHierarchy?true:false),m=s.pqScrollBar("option"),l=parseInt(m.num_eles),p=parseInt(m.cur_pos),t=this.options;var u=this._getScollBarHorizontalHeight(),y=this.$cont[0].offsetHeight,j=y-u+1,v=t.groupModel,D=(v)?this.dataGM:this.data;var A=D?this.totalVisibleRows:0;var o,w,E=0;if(this.$tbl&&this.$tbl.length>0){o=this.$tbl[this.$tbl.length-1];E=o.offsetHeight;w=h(o)}if(E>0&&E>j){var B=w.children().children("tr");var C=0,x=0;for(var z=0;z<B.length;z++){var k=B[z];C+=k.offsetHeight;if(C>=j){if(q&&h(k).hasClass("pq-detail-child")){x--;x=(x>1)?(x-1):1}else{x=(x>1)?(x-1):0}break}else{if(q){if(h(k).hasClass("pq-detail-child")==false){x++}}else{x++}}}if(x==0){x=B.length-1}l=A-x+1}else{l=p+1}if(l>A){l=A}if(n){r.$vscroll.pqScrollBar("option","num_eles",l)}else{r.$vscroll.pqScrollBar("setNumEles",l)}return l};g._getFirstVisibleRowIndxPage=function(m){for(var k=0,j=m.length;k<j;k++){var l=m[k].pq_hidden;if(!l){return k}}};g._getLastVisibleRowIndxPage=function(l){for(var j=l.length-1;j>=0;j--){var k=l[j].pq_hidden;if(!k){return j}}return null};g._getFirstVisibleColIndx=function(){var j=this.colModel,m=j.length;for(var k=0;k<m;k++){var l=j[k].hidden;if(!l){return k}}return null};g._getLastVisibleColIndx=function(){var j=this.colModel,m=j.length;for(var k=m-1;k>=0;k--){var l=j[k].hidden;if(!l){return k}}return null};g.getTotalVisibleColumns=function(){var k=this.colModel,p=k.length,l=0;for(var m=0;m<p;m++){var n=k[m],o=n.hidden;if(!o){l++}}return l};g._getTotalVisibleRows=function(n,u,t,F){var y=0,q=(F)?F.length:0,B=u,x=0,l=0,j=null,m=false,r=false,p=(this.iHierarchy)?true:false,E=this.options.detailModel.offset,o=0,k=22,w=p?this.$cont[0].offsetHeight:undefined;if(F==null||q==0){return{init:j,_final:j,tvRows:y}}for(var A=0,C=((q>u)?u:q);A<C;A++){var s=F[A],z=s.pq_hidden;if(!z){j=A;y++;if(p){var v=s.pq_detail;if(v&&v.show){var D=(v.height||0);if(D>E){D=E}o+=D+k}else{o+=k}}}}this.lastFrozenRow=j;if(q<u){return{init:j,_final:j,tvRows:y}}t=t-y;for(var A=u,C=q;A<C;A++){var s=F[A],z=s.pq_hidden;if(!m){if(z){B++}else{if(l==n){m=true;x=B;l=0}else{B++;l++}}}else{if(!r){if(z){x++}else{if(l==t){r=true}else{x++;l++}}}}if(!z){y++;if(p&&m){var v=s.pq_detail;if(v&&v.show){var D=(v.height||0);if(D>E){D=E}o+=D+k}else{o+=k}if(o>w){r=true}}}}if(B>=q){B=q-1}if(x<B){x=B}return{init:B,_final:x,tvRows:y}};g._setScrollVLength=function(){var k=this.$cont.height();var j=this._getScollBarHorizontalHeight();this.$vscroll.css("bottom",j);var i=(k-j);this.$vscroll.pqScrollBar("option","length",i);return};g._setInnerGridHeight=function(){var j=this.options;if(j.flexHeight){return}var i=(this.element.height()-((j.showTop)?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight);this.$grid_inner.height(i+"px")};g._setRightGridHeight=function(){var l=this.options;var k=this.$header[0].offsetHeight;this.$header_o.height(k-2);if(l.flexHeight){return}this.$vscroll.css("visibility","");if(this.$tbl){this.$tbl.css("marginBottom",0)}var j=(this.element.height()-this.$header_o[0].offsetHeight-((l.showTop)?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight);var i=0;this.$cont.height((j-i)+"px")};g.setGridHeightFromTable=function(){var k=0;var j=this._getScollBarHorizontalHeight(),l=this.$tbl;if(l&&l.length){k=(l[0].offsetHeight-1);l.css("marginBottom",j)}else{k=22}var i=k+j;this.$cont.height("");this.element.height("");this.$grid_inner.height("");this.$vscroll.css("visibility","hidden")};g._setGridWidthFromTable=function(){var i;var j=this._getScollBarVerticalWidth();if(this.$tbl&&this.$tbl[0]&&this.$tbl[0].scrollWidth>0){i=this.$tbl[0].scrollWidth;this.element.width((i+j)+"px")}else{i=d.call(this,-1,this.colModel.length);this.element.width((i)+"px")}};g._setRightGridWidth=function(){};g._bufferObj_getInit=function(){return this.init};g._bufferObj_getFinal=function(){return this["final"]};g._bufferObj_minRowsPerGrid=function(){var i=this.$cont[0].offsetHeight;return Math.ceil(i/this.rowHeight)};g._calcCurPosFromRowIndxPage=function(k){var s=this.options,t=s.groupModel,n=t?this.dataGM:this.data,u=s.freezeRows;if(k<u){return 0}var r=0,m=u;for(var o=u,q=n.length;o<q;o++){var l=n[o];if(t&&(l.groupSummary||l.groupTitle)){}else{if(m==k){break}m++}var p=l.pq_hidden;if(!p){r++}}if(r>=q){return null}else{return r}};g._bufferObj_calcInitFinal=function(){var n=this.options,r=n.freezeRows,m=n.flexHeight,p=n.groupModel,i=(p)?true:false,j=i?this.dataGM:this.data,s=n.treeModel;if(j==null||j.length==0){var l=this._getTotalVisibleRows(k,r,o,j);this.totalVisibleRows=l.tvRows;this.init=l.init;this["final"]=l._final}else{var q=this.$vscroll.pqScrollBar("option"),k=parseInt(q.cur_pos);if(isNaN(k)||k<0){throw ("cur_pos NA");this.init=0}this.scrollCurPos=k;var o=this._bufferObj_minRowsPerGrid();this.pageSize=o;var l=this._getTotalVisibleRows(k,r,o,j);this.totalVisibleRows=l.tvRows;this.init=l.init;if(m){this["final"]=j.length-1}else{this["final"]=l._final}}};g._bufferObj_calcInitFinalH=function(){var t=parseInt(this.$hscroll.pqScrollBar("option","cur_pos")),y=this.options,u=parseInt(y.freezeCols),n=y.flexWidth,v=y.virtualX,r=u,s=0,o=this.colModel,q=this.outerWidths,k=o.length;for(var p=u;p<k;p++){if(o[p].hidden){r++}else{if(s==t){break}else{r++;s++}}}if(r>k-1){r=k-1}this.initH=r;if(n||!v){this.finalH=k-1}else{var l=d.call(this,-1,u),j=this.$cont[0].offsetWidth-this._getScollBarVerticalWidth();for(var p=r;p<k;p++){var m=o[p];if(!m.hidden){var w=q[p];if(!w){throw ("width N/A")}l+=w;if(l>j){break}}}var x=p;if(x>k-1){x=k-1}this.finalH=x}};var d=function(n,l,t){var j=0,u=this.options,p=u.columnBorders,s=u.numberCell,r=this.outerWidths,m=this.colModel;if(n==-1){if(s.show){if(t){j+=parseInt(s.width)+1}else{j+=this.numberCell_outerWidth}}n=0}if(t){for(var o=n;o<l;o++){var k=m[o],q=k.hidden;if(!q){j+=parseInt(k.width)+(p?1:0)}}}else{for(var o=n;o<l;o++){if(!m[o].hidden){j+=r[o]}}}return j};h.paramquery.pqgrid.calcWidthCols=d;g._calcHeightRows=function(m,k){var i=0;var l=m;do{if(l>=k){break}var j=this.getRow({rowIndxPage:l});if(j&&j[0]){i+=j[0].offsetHeight}l++}while(1==1);return i};g._calcRightEdgeCol=function(q){var o=0,p=0,j=this.colModel,n=this.hidearrHS,m=this.outerWidths,k=this.options.numberCell;if(k.show){o+=this.numberCell_outerWidth;p++}for(var l=0;l<=q;l++){if(!j[l].hidden&&n[l]==false){o+=m[l];p++}}return{width:o,cols:p}};g._refreshFreezeLine=function(){var k=this.options,i=k.numberCell,n=this.$cont_o,m=k.freezeCols;if(this.$freezeLine){this.$freezeLine.remove()}if(m){var l=d.call(this,-1,(m))-1;if(isNaN(l)||l==0){}else{if(l>0&&i.show&&l==i.width){}else{this.$freezeLine=h("<div class='pq-grid-vert-freezeline' ></div>").appendTo(n);var j=n[0].offsetHeight;this.$freezeLine.css({height:j,left:l})}}}};g._getDragHelper=function(j){var i=h(j.currentTarget);this.$cl=h("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);this.$clleft=h("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);var l=parseInt(i.attr("pq-grid-col-indx"));var k=this.$grid_inner.outerHeight();this.$cl.height(k);this.$clleft.height(k);var n=h("td[pq-grid-col-indx="+l+"]",this.$header)[0];var m=n.offsetLeft+((l>this.options.freezeCols)?parseInt(this.$header[1].offsetLeft):0);this.$clleft.css({left:m});m=m+n.offsetWidth;this.$cl.css({left:m})};g._setDragLimits=function(k){var l=this,p=this.options,n=p.numberCell;var o=l.$header_left;if(k>=p.freezeCols){o=l.$header_right}var m=o.find("div.pq-grid-col-resize-handle[pq-grid-col-indx="+k+"]");var j=o.find("td[pq-grid-col-indx='"+k+"']");var i=j.offset().left+p.minWidth;if(k==-1){i=j.offset().left+n.minWidth}var q=17;if(p.flexHeight||this.$vscroll.css("visibility")=="hidden"){q=0}var r=l.$cont.offset().left+l.$cont[0].offsetWidth-q+20;m.draggable("option","containment",[i,0,r,0])};g._getOrderIndx=function(j){var i=this.options.columnOrder;if(i!=null){return i[j]}else{return j}};g.nestedCols=function(t,s,u){var r=t.length;var p=[];if(s==null){s=1}var o=s,q=0,j=0,l=0;for(var n=0;n<r;n++){var k=t[n];if(u==true){k.hidden=u}if(k.colModel!=null&&k.colModel.length>0){var m=this.nestedCols(k.colModel,s+1,k.hidden);p=p.concat(m.colModel);if(m.colSpan>0){if(m.depth>o){o=m.depth}k.colSpan=m.colSpan;q+=m.colSpan}else{k.colSpan=0;k.hidden=true}k.childCount=m.childCount;l+=m.childCount}else{if(k.hidden){k.colSpan=0}else{k.colSpan=1;q++}k.childCount=0;l++;p.push(k)}}return{depth:o,colModel:p,colSpan:q,width:j,childCount:l}};g.getHeadersCells=function(){var s=this.options.colModel,A=this.colModel.length,B=this.depth;var j=[];for(var q=0;q<B;q++){j[q]=[];var y=0;var r=0,m=0;for(var p=0;p<A;p++){var u;if(q==0){u=s[y]}else{var n=j[q-1][p];var o=n.colModel;if(o==null||o.length==0){u=n}else{var x=(p-n.leftPos);var v=0,l=0;var i=0;for(var w=0;w<o.length;w++){l+=(o[w].childCount>0)?o[w].childCount:1;if(x<l){i=w;break}}u=o[i]}}var z=(u.childCount)?u.childCount:1;if(p==m){u.leftPos=p;j[q][p]=u;m+=z;if(s[y+1]){y++}}else{j[q][p]=j[q][p-1]}}}this.headerCells=j;return j};g.getDataType=function(){var i=this.colModel;if(i&&i[0]){var j=i[0].dataIndx;if(typeof j=="string"){return"JSON"}else{if(typeof j=="number"){return"ARRAY"}}}throw ("dataType unknown")};g.assignRowSpan=function(){var m=this.options.colModel,i=this.colModel.length,p=this.headerCells,k=this.depth;for(var j=0;j<i;j++){for(var r=0;r<k;r++){var o=p[r][j];if(j>0&&o==p[r][j-1]){continue}else{if(r>0&&o==p[r-1][j]){continue}}var n=1;for(var q=r+1;q<k;q++){var l=p[q][j];if(o==l){n++}}o.rowSpan=n}}return p};g._calcThisColModel=function(){var i=this.nestedCols(this.options.colModel);this.colModel=i.colModel;this.depth=i.depth;this.getHeadersCells();this.assignRowSpan();this._refreshColumnWidths();this._computeOuterWidths()};g._refreshWidthsAutoFit=function(){var q=this.options,m=this.colModel,o=this.$cont,k=m.length,u=q.minWidth;var j=d.call(this,-1,k,true);var x=o[0].offsetWidth-this._getScollBarVerticalWidth();if(j!=x){var s=j-x,n=[];for(var z=0;z<k;z++){var l=m[z],y=l.hidden;if(!y){var t=l.minWidth,t=(t?parseInt(t):u),C=parseInt(l.width)-t;if(C>0||s<0){n.push({availWd:C,colIndx:z})}}}n.sort(function(D,i){if(D.availWd>i.availWd){return 1}else{if(D.availWd<i.availWd){return -1}else{return 0}}});for(var z=0,A=n.length;z<A;z++){var r=n[z],C=r.availWd,v=r.colIndx,w=Math.round(s/(A-z)),l=m[v],B=l.width;if(C>w){var p=B-w;s=s-w;l.width=p}else{var p=B-C;s=s-C;l.width=p}}}};g._refreshColumnWidths=function(){var x=this.options,w=x.numberCell,z=x.freezeCols,m=x.flexWidth,I=x.columnBorders,o=this.colModel,C=x.scrollModel,E=C.lastColumn,p=C.autoFit,s=this.$cont,k=o.length,B=x.minWidth;if(w.show){if(w.width<w.minWidth){w.width=w.minWidth}}for(var G=0;G<k;G++){var n=o[G],F=n.hidden;if(F){continue}var J=n.width,A=n.minWidth,A=(A?parseInt(A):B);if(J!=undefined){var v=parseInt(J);if(v<A){v=A}n.width=v}else{n.width=A}}if(s&&m==false){if(p){this._refreshWidthsAutoFit()}if(E=="auto"){var D=s[0].offsetWidth-this._getScollBarVerticalWidth();var H=d.call(this,-1,z,true);var l=D-H,j=false,q=this._getLastVisibleColIndx();if(q==null){return}var u=o[q],r=parseInt(u.width),K=u.minWidth,K=(K?parseInt(K):B);for(var G=k-1;G>=z;G--){var n=o[G];if(n.hidden){continue}var t=n.width+(I?1:0);l=l-t;if(l<0){j=true;if(r+l>=K){u.width=r+l}else{var y=r+t+l;if(y>=K){u.width=y}else{}}break}}if(!j){if(r+l>=K){u.width=r+l}else{u.width=K}}}}};g._createHeader=function(){var u=this,y=this.options,A=parseInt(y.freezeCols),x=y.numberCell,E=this.colModel,w=this.outerWidths,k=E.length,N=this.depth,o=y.virtualX,p=u.initH,C=u.finalH,L=y.columnBorders,J=this.headerCells,F=[],O=this.hidearrHS,M=this.$header;if(y.showHeader===false){M.empty();this.$header_o.css("display","none");return}else{this.$header_o.css("display","")}var H=["<table class='pq-grid-header-table' cellpadding=0 cellspacing=0>"];if(N>=1){H.push("<tr>");if(x.show){H.push("<td style='width:"+(x.width+1)+"px;' ></td>")}for(var r=0;r<=C;r++){if(r<p&&r>=A&&o){r=p;if(r>C){throw ("initH>finalH")}}var l=E[r];if(l.hidden){continue}var v=w[r];H.push("<td style='width:"+v+"px;'></td>")}H.push("</tr>")}var K="pq-grid-col "+((y.hwrap===false)?" pq-wrap-text ":"");for(var s=0;s<N;s++){H.push("<tr class='pq-grid-title-row'>");if(s==0&&x.show){H.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='",N,"'>","<div class='pq-td-div'>",x.title?x.title:"&nbsp;","</div></td>"].join(""))}for(var r=0;r<=C;r++){if(r<p&&r>=A&&o){r=p;if(r>C){throw ("initH>finalH");break}}var l=J[s][r],t=l.colSpan,z=l.halign,I=l.align,Q=l.title,Q=Q?Q:"";if(s>0&&l==J[s-1][r]){continue}else{if(r>0&&l==J[s][r-1]){continue}}if(l.hidden){continue}var j=K;if(z!=null){j+=" pq-align-"+z}else{if(I!=null){j+=" pq-align-"+I}}if(r==A-1&&N==1){j+=" pq-last-freeze-col"}if(r<=A-1){j+=" pq-left-col"}else{if(r>=p){j+=" pq-right-col"}}var D="",B="";if(l.colModel==null||l.colModel.length==0){D="pq-grid-col-indx='"+r+"'"}var n="pq-row-indx="+s;var m="pq-col-indx="+r;H.push(["<td ",D," ",m," ",n," ",B," class='",j,"' rowspan=",l.rowSpan," colspan=",t,">                    <div class='pq-td-div'>",Q,"<span class='pq-col-sort-icon'>&nbsp;</span></div></td>"].join(""))}H.push("</tr>")}this.ovCreateHeader(H,K);H.push("</table>");var G=H.join("");M.empty();M.append(G);this.$tbl_header=M.children("table");var q=h(M[0]);var i=h(M[1]);var v=d.call(this,-1,A);q.css({width:v,zIndex:1});if(!o){var P=d.call(this,A,p);i.css({left:(-1*P)+"px"})}M.click(function(T){if(u.iDragColumns&&u.iDragColumns.status!="stop"){return}var R=h(T.target),S=R.closest(".pq-g-ficon");if(S.length){var U=S.attr("pq-col-indx");T.stopImmediatePropagation();return u.iHeaderIconSearch.createDOM(U,S,T)}var V=R.closest("td.pq-grid-col");if(V.length){T.stopImmediatePropagation();var U=V.attr("pq-grid-col-indx");if(U==null){return}}else{return}return u._onHeaderCellClick(U,T)});this._refreshResizeColumn(p,C,E);this._trigger("refreshHeader",null,null)};g.ovCreateHeader=function(){};g._refreshResizeColumn=function(s,x,p){var t=this,o=this.options,k=o.filterModel.ficon?true:false,u=o.numberCell,y=t.$header.height(),w=parseInt(o.freezeCols);if(u.show&&u.resizable){var l=h("<div pq-grid-col-indx='-1' class='pq-grid-col-resize-handle'>&nbsp;</div>").appendTo(t.$header_left);var D=t.$header_left.find("td.pq-grid-number-col")[0];G=parseInt(D.offsetLeft)+(D.offsetWidth-10);l.css({left:G,height:y})}for(var A=0;A<=x;A++){if(A<s&&A>=w){A=s;if(A>x){throw ("initH>finalH")}}var m=p[A];if(m.hidden){continue}var E=m.ficon,B=(E||(E==null&&k)),v,D,H,G;if((m.resizable!==false)||B){v=t.$header_left;if(A>=w){v=t.$header_right}D=v.find("td[pq-grid-col-indx="+A+"]")[0];H=parseInt(D.offsetLeft);G=H+(D.offsetWidth-5)}if(m.resizable!==false){var l=h("<div pq-grid-col-indx='"+A+"' class='pq-grid-col-resize-handle'>&nbsp;</div>").appendTo(v);l.css({left:G,height:y})}if(B){var F=m.filterModel;var C="";if(F&&F.on){C="ui-state-error"}var z=G-12;if((!m.halign&&m.align=="right")||m.halign=="right"){z=H}h("<div class='"+C+" pq-g-ficon' pq-col-indx='"+A+"' tabindex=1><div class='ui-icon ui-icon-search'></div></div>").css({left:z,height:y}).appendTo(v)}}var r,q,n;var j=t.$header.find(".pq-grid-col-resize-handle").draggable({axis:"x",helper:function(I,K){var i=h(I.target);var J=parseInt(i.attr("pq-grid-col-indx"));t._setDragLimits(J);t._getDragHelper(I,K);return i},start:function(i,I){r=I.position.left;n=parseInt(t.$cl[0].style.left)},drag:function(i,J){q=J.position.left;var I=(q-r);t.$cl[0].style.left=n+I+"px"},stop:function(i,I){return t._refreshResizeColumnStop(i,I,p,r)}})};g._refreshResizeColumnStop=function(t,q,n,u){var o=this,r=this.options,p=r.numberCell;o.$clleft.remove();o.$cl.remove();var s=q.position.left;var v=(s-u);var i=h(q.helper),j=parseInt(i.attr("pq-grid-col-indx")),k;if(j==-1){k=null;var l=parseInt(p.width);var m=l+v;p.width=m}else{k=n[j];var l=parseInt(k.width);var m=l+v;k.width=m}o._refresh();o._trigger("columnResize",t,{colIndx:j,column:k,dataIndx:(k?k.dataIndx:null),oldWidth:l,newWidth:k?k.width:p.width})};g._refreshHeaderSortIcons=function(){var k=this.options.dataModel;if(k.sortIndx==undefined){return}var j=this.$header;var n=j.find(".pq-grid-col");n.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");j.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");var o=k.sortIndx;var m=this.getColIndx({dataIndx:o});var l="ui-state-active pq-col-sort-"+(k.sortDir=="up"?"asc":"desc");var i="ui-icon ui-icon-triangle-1-"+(k.sortDir=="up"?"n":"s");j.find(".pq-grid-col[pq-grid-col-indx="+m+"]").addClass(l);j.find(".pq-grid-col[pq-grid-col-indx="+m+"] .pq-col-sort-icon").addClass(i)};g.createTable=function(i){this.iGenerateView.generateView(i)};g._refreshOtherTables=function(){return;var A=this.colModel,v=A.length,y=this.options.freezeCols,t=this.options.columBorders;for(var s=0;s<this.tables.length;s++){var r=this.tables[s];var m=r.$tbl,u=m.find("tr:first");for(var o=0;o<v;o++){var p=A[o],w=p.dataIndx;if(p.hidden){var n=u.find("td[pq-dataIndx='"+w+"']");if(n.length>1){var l=m.find("td[pq-dataIndx='"+w+"']").remove();r.$tds.add(l)}}else{if(this.hidearrHS[o]){var n=u.find("td[pq-dataIndx='"+w+"']");if(n.css("visibility")!="hidden"){}}}var j="";var z=const_cls;if(p.align=="right"){z+=" pq-align-right"}else{if(p.align=="center"){z+=" pq-align-center"}}if(o==y-1&&t){z+=" pq-last-freeze-col"}if(p.cls){z=z+" "+p.cls}if(cellSelection){z=z+" pq-cell-select"}var x="<td class='"+z+"' style='"+j+"' pq-col-indx='"+o+"'>				"+this.iGenerateView._renderCell(objRender)+"</td>";buffer.push(x)}for(var q=0;q<hidearrHS1.length;q++){var o=hidearrHS1[q];var p=A[o];objRender.column=p;objRender.colIndx=o;var j="";j+="visibility:hidden;";var z=const_cls;if(p.align=="right"){z+=" pq-align-right"}else{if(p.align=="center"){z+=" pq-align-center"}}var x="<td class='"+z+"' style='"+j+"' pq-col-indx='"+o+"'>				"+this.iGenerateView._renderCell(objRender)+"</td>";buffer.push(x)}}};h.widget("paramquery._pqGrid",g);h.measureTime=function(m,l){var j=(new Date()).getTime();m();var i=(new Date()).getTime();var k=i-j}})(jQuery);(function($){var cClass=$.paramquery.cClass;var calcWidthCols=$.paramquery.pqgrid.calcWidthCols;var fn={};function cMouseSelection(that){this.that=that;var self=this,widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"cellmousedown",function(evt,ui){if(evt.target==that.element[0]){return self._onCellMouseDown(evt,ui)}});that.element.on(widgetEventPrefix+"rowmousedown",function(evt,ui){if(evt.target==that.element[0]){return self._onRowMouseDown(evt,ui)}});that.element.on(widgetEventPrefix+"cellmousemove",function(evt,ui){if(evt.target==that.element[0]){return self._onCellMouseMoveSheet(evt,ui)}});that.element.on(widgetEventPrefix+"rowmousemove",function(evt,ui){if(evt.target==that.element[0]){return self._onRowMouseMoveSheet(evt,ui)}});that.element.on(widgetEventPrefix+"beforetableview",function(evt,ui){if(evt.target==that.element[0]){return self._beforeTableView(evt,ui)}});that.element.on(widgetEventPrefix+"refresh",function(evt,ui){if(evt.target==that.element[0]){return self._onRefresh(evt,ui)}});$(document).bind("mouseup.cMouseSelection",function(evt,ui){return self._onDocumentMouseUp(evt,ui)})}var _pMouseSelection=cMouseSelection.prototype;fn.getFocusElement=function(){var ae=document.activeElement;if(ae){var $ae=$(ae),$grid=$ae.closest(".pq-grid");if($grid.length){if($grid[0]==this.element[0]){return{$ae:$ae,$grid:$grid}}else{return{$ae:$ae,$childGrid:$grid}}}}};fn.inViewPort=function($tdr){var that=this,cont=that.$cont[0],htCont=cont.offsetHeight-that._getScollBarHorizontalHeight()+1,wdCont=cont.offsetWidth-that._getScollBarVerticalWidth()+1,tdr=$tdr[0];if(htCont>=(tdr.offsetTop+tdr.offsetHeight)){if(tdr.nodeName.toUpperCase()=="TD"){if(wdCont>=(tdr.offsetLeft+tdr.offsetWidth)){return true}}else{return true}}};_pMouseSelection._beforeTableView=function(evt,ui){var that=this.that,objFE=that.getFocusElement();this.lastFocus=null;if(objFE&&objFE.$grid){var $ae=objFE.$ae;if($ae.hasClass("pq-grid-row")){var obj=that.getRowIndx({$tr:$ae});this.lastFocus=obj}else{if($ae.hasClass("pq-grid-cell")){var obj=that.getCellIndices({$td:$ae});this.lastFocus=obj}}}};_pMouseSelection._onRefresh=function(evt,ui){var that=this.that,objLF=this.lastFocus,$tdr;if(objLF){if(objLF.dataIndx!=null){$tdr=that.getCell(objLF)}else{$tdr=that.getRow(objLF)}if($tdr&&$tdr.length){if(that.inViewPort($tdr)){$tdr.attr("tabindex","0").focus()}return}}return};_pMouseSelection._onCellMouseDown=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,colIndx=ui.colIndx,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(type!="cell"){return}if(colIndx==null){return}if(evt.shiftKey){that.iCells.extendSelection({rowIndx:rowIndx,colIndx:colIndx,mode:mode,evt:evt});evt.preventDefault()}else{if(evt.ctrlKey&&mode!="single"){if(that.iCells.isSelected({rowIndx:rowIndx,colIndx:colIndx})){that.iCells.remove({rowIndx:rowIndx,colIndx:colIndx})}else{that.setSelection({rowIndx:rowIndx,colIndx:colIndx})}}else{this.mousedown={rowIndx:rowIndx,colIndx:colIndx};that.setSelection(null);that.iCells.add({rowIndx:rowIndx,colIndx:colIndx,setFirst:true})}}return true};_pMouseSelection._onRowMouseDown=function(evt,ui){var that=this.that,rowIndx=ui.rowIndx,SM=that.options.selectionModel,mode=SM.mode,type=SM.type;if(type!="row"){return}if(rowIndx==null){return}if(evt.shiftKey){that.iRows.extendSelection({rowIndx:rowIndx,evt:evt});evt.preventDefault()}else{if(evt.ctrlKey&&mode!="single"){if(that.iRows.isSelected({rowIndx:rowIndx})){that.iRows.remove({rowIndx:rowIndx})}else{that.setSelection({rowIndx:rowIndx})}}else{this.mousedown={r1:rowIndx,y1:evt.pageY};that.setSelection(null);that.iRows.add({rowIndx:rowIndx,setFirst:true})}}return true};_pMouseSelection._onCellMouseMoveSheet=function(evt,ui){var that=this.that,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(type=="cell"&&this.mousedown){var mousedown=this.mousedown,r1=mousedown.r1,c1=mousedown.c1,r2=ui.rowIndx,c2=ui.colIndx;if(r1==r2&&c1==c2){return}else{if(mousedown.r2==r2&&mousedown.c2==c2){return}else{this.mousedown.r2=r2;this.mousedown.c2=c2}}that.iCells.extendSelection({rowIndx:r2,colIndx:c2,evt:evt})}};_pMouseSelection._onRowMouseMoveSheet=function(evt,ui){var that=this.that,SM=that.options.selectionModel,type=SM.type,mode=SM.mode;if(SM.swipe&&this.mousedown){var m=this.mousedown,vSBOptions=that.$vscroll.pqScrollBar("option"),num_eles=vSBOptions.num_eles,cur_pos=vSBOptions.cur_pos,initV=that.init,y1=m.y1,y2=evt.pageY;if(y2-y1>22&&initV>0){var rowIndxPage=that.iKeyNav._decrRowIndx(initV);var calcCurPos=that._calcCurPosFromRowIndxPage(rowIndxPage);if(calcCurPos==null){return}that.$vscroll.pqScrollBar("option","cur_pos",calcCurPos).pqScrollBar("scroll");m.y1=y2}else{if(y1-y2>22&&cur_pos<num_eles){var rowIndxPage=that.iKeyNav._incrRowIndx(that.init);var calcCurPos=that._calcCurPosFromRowIndxPage(rowIndxPage);if(calcCurPos==null){return}that.$vscroll.pqScrollBar("option","cur_pos",calcCurPos).pqScrollBar("scroll");m.y1=y2}}}else{if(type=="row"&&this.mousedown){var m=this.mousedown;var r1=this.mousedown.r1,r2=ui.rowIndx;if(r1==r2){return}else{if(this.mousedown.r2==r2){return}else{this.mousedown.r2=r2}}that.iRows.extendSelection({rowIndx:r2,evt:evt})}}};_pMouseSelection._onDocumentMouseUp=function(evt,ui){this.mousedown=null;return true};function cHierarchy(that){var self=this;this.that=that;this.type="detail";this.refreshComplete=true;this.detachView=false;var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"cellclick",function(evt,ui){if(evt.target==that.element[0]){return self.cellClick(evt,ui)}});that.element.on(widgetEventPrefix+"cellkeydown",function(evt,ui){if(evt.target==that.element[0]&&evt.keyCode==$.ui.keyCode.ENTER){return self.cellClick(evt,ui)}});that.element.on(widgetEventPrefix+"refresh",function(evt,ui){if(evt.target==that.element[0]){return self.refresh(evt,ui)}});that.element.on(widgetEventPrefix+"beforetableview",function(evt,ui){if(evt.target==that.element[0]){return self.beforeTableView(evt,ui)}});that.element.on(widgetEventPrefix+"beforerefreshdata",function(evt,ui){if(evt.target==that.element[0]){return self.beforeRefreshData(evt,ui)}})}var _pHierarchy=cHierarchy.prototype;_pHierarchy.refresh=function(evt,ui){var that=this.that,initDetail=that.options.detailModel.init,data=that.data;if(!this.refreshComplete){return}this.refreshComplete=false;var $trs=that.$tbl.children("tbody").children("tr.pq-detail-child");for(var i=0;i<$trs.length;i++){var tr=$trs[i],$tr=$(tr),rowIndxPage=$tr.attr("pq-row-indx"),rowData=data[rowIndxPage],$grid=rowData.pq_detail["child"];if(!$grid){if(typeof initDetail=="function"){$grid=initDetail.call(that.element,{rowData:rowData});rowData.pq_detail["child"]=$grid}}var $header=$grid.find(".pq-header-outer");$tr.children("td.pq-detail-child").append($grid);if($header.height()==0){try{$grid.pqGrid("refresh")}catch(ex){}}}this.refreshComplete=true;this.detachView=false};_pHierarchy.beforeTableView=function(evt,ui){if(!this.detachView){this.detachInitView(evt,ui)}};_pHierarchy.beforeRefreshData=function(evt,ui){if(!this.detachView){this.detachInitView(evt,ui)}};_pHierarchy.detachInitView=function(evt,ui){var that=this.that,data=that.data;var $trs=that.$tbl.children("tbody").children("tr.pq-grid-row");var prevRI,$temp,htTemp;for(var i=0;i<$trs.length;i++){var tr=$trs[i],$tr=$(tr),rowIndxPage=$tr.attr("pq-row-indx"),rowData=data[rowIndxPage];if(rowIndxPage==null||rowIndxPage==prevRI){continue}else{prevRI=rowIndxPage}if(rowData.pq_detail){$temp=null;htTemp=0;if(rowData.pq_detail["child"]){var $next=$tr.next();if($next.hasClass("pq-detail-child")){var $child=$next.children("td.pq-detail-child").children();if($child.length){htTemp=$child[0].offsetHeight;$temp=$child.detach()}}}if($temp&&$temp.length){rowData.pq_detail["child"]=$temp;rowData.pq_detail["height"]=htTemp}}}this.detachView=true};_pHierarchy.cellClick=function(evt,ui){var that=this.that,column=ui.column,rowData=ui.rowData,rowIndx=ui.rowIndx,type=this.type;if(column&&column.type===type){var dataIndx="pq_detail";if(rowData[dataIndx]==null){that.rowExpand({rowIndx:rowIndx,scrollRow:true})}else{if(rowData[dataIndx]["show"]===false){that.rowExpand({rowIndx:rowIndx,scrollRow:true})}else{that.rowCollapse({rowIndx:rowIndx,scrollRow:true})}}}};fn.rowExpand=function(objP){var rowData=this.getRowData(objP),detM=this.options.detailModel,dataIndx="pq_detail";if(rowData==null){return}if(rowData[dataIndx]==null){rowData[dataIndx]={show:true}}else{if(rowData[dataIndx]["show"]===false){rowData[dataIndx]["show"]=true}}if(!detM.cache){var $temp=rowData[dataIndx]["child"];if($temp){$temp.remove();rowData[dataIndx]["child"]=null;rowData[dataIndx]["height"]=0}}this.refresh();if(objP.scrollRow){var rowIndx=objP.rowIndx;this.scrollRow({rowIndx:rowIndx})}};fn.rowInvalidate=function(objP){var rowData=this.getRowData(objP),dataIndx="pq_detail";var $temp=rowData[dataIndx]["child"];$temp.remove();rowData[dataIndx]["child"]=null};fn.rowCollapse=function(objP){var rowData=this.getRowData(objP),detM=this.options.detailModel,dataIndx="pq_detail";if(rowData==null||rowData[dataIndx]==null){return}else{if(rowData[dataIndx]["show"]===true){if(!detM.cache){var $temp=rowData[dataIndx]["child"];if($temp){$temp.remove();rowData[dataIndx]["child"]=null;rowData[dataIndx]["height"]=0}}rowData[dataIndx]["show"]=false;this.refresh();if(objP.scrollRow){var rowIndx=objP.rowIndx;this.scrollRow({rowIndx:rowIndx})}}}};var cHeaderSearch=function(that){this.that=that;var self=this;this.dataHS={};var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.on(widgetEventPrefix+"headerkeydown",function(evt,ui){if(self.belongs(evt)){var $src=$(evt.originalEvent.target);if($src.hasClass("pq-search-hd-field")){return self.onKeyDown(evt,ui,$src)}else{return true}}});that.element.on(widgetEventPrefix+"createheader",function(evt,ui){if(self.belongs(evt)){return self._onCreateHeader()}});function filter(dataIndx,value,value2){that.filter({data:[{dataIndx:dataIndx,value:value,value2:value2}]})}this.changeListener={change:function(evt,ui){filter(ui.dataIndx,ui.value,ui.value2)}};this.keyupListener={keyup:function(evt,ui){filter(ui.dataIndx,ui.value,ui.value2)}};this.clickListener={click:function(evt,ui){filter(ui.dataIndx,ui.value)}}};var _pHeaderSearch=cHeaderSearch.prototype=new cClass;_pHeaderSearch.get$Ele=function(colIndx,dataIndx){var that=this.that,freezeCols=that.options.freezeCols,$tbl_left=$(that.$tbl_header[0]),$inp,selector=".pq-search-hd-field[name='"+dataIndx+"']",$tbl_right=$(that.$tbl_header[(that.$tbl_header.length==2)?1:0]);if(colIndx>=freezeCols){$inp=$tbl_right.find(selector)}else{$inp=$tbl_left.find(selector)}return $inp};_pHeaderSearch.onKeyDown=function(evt,ui,$this){var that=this.that,keyCode=evt.keyCode,keyCodes=$.ui.keyCode,selector;if(keyCode===keyCodes.TAB){var dataIndx=$this.attr("name"),colIndx=that.getColIndx({dataIndx:dataIndx}),CM=that.colModel,$inp,shiftKey=evt.shiftKey,column=CM[colIndx];if(column.filter.condition=="between"){that.scrollColumn({colIndx:colIndx});var $ele=this.get$Ele(colIndx,dataIndx);if($ele[0]==$this[0]){if(!shiftKey){$inp=$ele[1]}}else{if(shiftKey){$inp=$ele[0]}}if($inp){$inp.focus();evt.preventDefault();return false}}do{if(shiftKey){colIndx--}else{colIndx++}if(colIndx<0||colIndx>=CM.length){break}var column=CM[colIndx],cFilter=column.filter;if(column.hidden){continue}if(!cFilter){continue}that.scrollColumn({colIndx:colIndx});var $inp,dataIndx=column.dataIndx,$inp=this.get$Ele(colIndx,dataIndx);if(cFilter.condition=="between"){if(shiftKey){$inp=$($inp[1])}else{$inp=$($inp[0])}}if($inp){$inp.focus();evt.preventDefault();return false}else{break}}while(1===1)}else{return true}};_pHeaderSearch._bindFocus=function(){var that=this.that,self=this;function handleFocus(e){var $inp=$(e.target);var dataIndx=$inp.attr("name");if(that.scrollColumn({dataIndx:dataIndx})){var colIndx=that.getColIndx({dataIndx:dataIndx});var $ele=self.get$Ele(colIndx,dataIndx);$ele.focus()}}function attachEvent(ele){if(ele.addEventListener){ele.addEventListener("focus",handleFocus,true)}else{ele.onfocusin=function(){var e=window.event;e.target=e.srcElement;handleFocus(e)}}}var $eles=this.that.$header.find(".pq-grid-header-search");for(var i=0;i<$eles.length;i++){attachEvent($eles[i])}};_pHeaderSearch._onCreateHeader=function(){var self=this,that=this.that,options=that.options,columnBorders=options.columnBorders,FM=options.filterModel;if(!FM.header){return}this._bindFocus();var CM=that.colModel,initH=that.initH,finalH=that.finalH,freezeCols=options.freezeCols,virtualX=options.virtualX,$tbl_header=that.$tbl_header,$tbl_left=$($tbl_header[0]),$tbl_right=$($tbl_header[1]),selector="input,select";$tbl_left.find(selector).css("visibility","hidden");for(var i=0;i<freezeCols;i++){var column=CM[i];var dIndx=column.dataIndx;var selector="*[name='"+dIndx+"']";$tbl_left.find(selector).css("visibility","visible");$tbl_right.find(selector).css("visibility","hidden")}for(var i=0;i<=finalH;i++){if(i<initH&&i>=freezeCols&&virtualX){i=initH;if(i>finalH){throw ("initH>finalH")}}var column=CM[i];if(column.hidden){continue}var filter=column.filter;if(!filter){continue}var dataIndx=column.dataIndx,$tbl;if(i<freezeCols){$tbl=$tbl_left}else{$tbl=$tbl_right}var $ele=$tbl.find("*[name='"+dataIndx+"']");if($ele.length==0){continue}var ftype=filter.type,value=filter.value,value2=filter.value2;if(ftype=="checkbox"&&filter.subtype=="triple"){$ele.pqval({val:value})}else{if(ftype=="select"){$ele.val(value);var wd=this.getWidth(column,columnBorders);$ele.css({width:wd})}}var finit=filter.init;if(finit){finit.call($ele,{dataIndx:dataIndx,column:column})}var listeners=filter.listeners;if(listeners){for(var j=0;j<listeners.length;j++){var listener=listeners[j];if(typeof listener=="string"){listener=self[listener+"Listener"]}for(var event in listener){var handler=listener[event];(function($ele,handler,dataIndx){$ele.bind(event,function(evt){var column=that.getColumn({dataIndx:dataIndx}),filter=column.filter;if(filter.type=="checkbox"){if(filter.subtype=="triple"){value=$ele.pqval({incr:true})}else{value=$ele.is(":checked")?true:false}}else{if(filter.condition=="between"){value=$($ele[0]).val();value2=$($ele[1]).val()}else{value=$ele.val()}}return handler.call(this,evt,{column:column,dataIndx:dataIndx,value:value,value2:value2})})})($ele,handler,dataIndx)}}}}};_pHeaderSearch.getWidth=function(column,columnBorders){var wd=parseInt(column.width)+((columnBorders)?1:0),wd=wd-15;return wd};_pHeaderSearch.createDOM=function(buffer,td_const_cls){var that=this.that,self=this,initH=that.initH,finalH=that.finalH,thisOptions=that.options,freezeCols=thisOptions.freezeCols,virtualX=thisOptions.virtualX,CM=that.colModel,columnBorders=thisOptions.columnBorders,dataHS=this.dataHS,numberCell=thisOptions.numberCell;buffer.push("<tr class='pq-grid-header-search'>");if(numberCell.show){buffer.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='1'>","<div class='pq-grid-header-table-div'>&nbsp;</div></td>"].join(""))}for(var i=0;i<=finalH;i++){if(i<initH&&i>=freezeCols&&virtualX){i=initH;if(i>finalH){throw ("initH>finalH")}}var column=CM[i];if(column.hidden){continue}var td_cls=td_const_cls,align=column.halign;if(!align){align=column.align}if(align=="right"){td_cls+=" pq-align-right"}else{if(align=="center"){td_cls+=" pq-align-center"}}var filter=column.filter;if(filter){var dataIndx=column.dataIndx,type=filter.type,value=filter.value,condition=filter.condition,wd=this.getWidth(column,columnBorders),cls=filter.cls,cls="pq-search-hd-field "+(cls?cls:""),style=filter.style,style=style?style:"",attr=filter.attr,attr=attr?attr:"",strS="",wdhalf;if(condition=="between"){var value2=filter.value2,value2=(value2!=null)?value2:"",wdhalf=((wd/2)-9)}if(type==="textbox"){value=value?value:"";cls=cls+" ui-corner-all pq-search-txt";if(condition=="between"){strS=this._input(dataIndx,value,wdhalf,cls+" pq-from",style,attr);strS+="-"+this._input(dataIndx,value2,wdhalf,cls+" pq-to",style,attr)}else{strS=this._input(dataIndx,value,wd,cls,style,attr)}}else{if(type==="textarea"){value=value?value:"";cls=cls+" ui-corner-all pq-search-txt";if(condition=="between"){strS=this._textarea(dataIndx,value,wdhalf,cls,style,attr);strS+="-"+this._textarea(dataIndx,value2,wdhalf,cls,style,attr)}else{strS=this._textarea(dataIndx,value,wd,cls,style,attr)}}else{if(type==="select"){if(filter.cache){strS=filter.cache}else{var opts=filter.options;if(typeof opts==="function"){opts=opts.call(that,{column:column,value:value,dataIndx:dataIndx,cls:cls,style:style,attr:attr})}cls=cls+" ui-corner-all";var attrSelect=["name='",dataIndx,"' class='",cls,"' style='width:",wd,"px;",style,"' ",attr].join("");strS=$.paramquery.select({options:opts,attr:attrSelect,prepend:filter.prepend,valueIndx:filter.valueIndx,labelIndx:filter.labelIndx,groupIndx:filter.groupIndx});filter.cache=strS}}else{if(type=="checkbox"){var checked=(value==null||value==false)?"":"checked=checked";strS=["<input ",checked," name='",dataIndx,"' type=checkbox class='"+cls+"' style='"+style+"' "+attr+"/>"].join("")}else{if(typeof type=="string"){strS=type}else{if(typeof type=="function"){strS=type.call(that,{width:wd,value:value,value2:value2,column:column,dataIndx:dataIndx,cls:cls,attr:attr,style:style})}}}}}}buffer.push(["<td class='",td_cls,"'><div class='pq-grid-header-table-div' style='padding:0px 2px;' >","",strS,"</div></td>"].join(""))}else{buffer.push(["<td class='",td_cls,"'><div class='pq-grid-header-table-div' >","&nbsp;","</div></td>"].join(""))}}buffer.push("</tr>")};_pHeaderSearch._input=function(dataIndx,value,wd,cls,style,attr){return['<input value="',value,"\" name='",dataIndx,"' type=text style='width:",wd,"px;"+style+"' class='"+cls+"' "+attr+" />"].join("")};_pHeaderSearch._textarea=function(dataIndx,value,wd,cls,style,attr){return["<textarea name='",dataIndx,"' style='width:",wd,"px;"+style+"' class='"+cls+"' "+attr+" >",value,"</textarea>"].join("")};$.paramquery.select=function(objP){var attr=objP.attr,opts=objP.options,groupIndx=objP.groupIndx,labelIndx=objP.labelIndx,valueIndx=objP.valueIndx,prepend=objP.prepend,groupV,groupVLast;var buffer=["<select ",attr," >"];if(prepend){for(var key in prepend){buffer.push('<option value="',key,'">',prepend[key],"</option>")}}if(groupIndx){if(opts&&opts.length){for(var i=0,len=opts.length;i<len;i++){var option=opts[i],value=option[valueIndx];if(value==null||value==""){continue}groupV=option[groupIndx];if(groupVLast!=groupV){if(groupVLast!=null){buffer.push("</optgroup>")}buffer.push('<optgroup label="',groupV,'">');groupVLast=groupV}if(valueIndx!=labelIndx){var label=option[labelIndx];buffer.push('<option value="',value,'">',label,"</option>")}else{buffer.push("<option>",value,"</option>")}}buffer.push("</optgroup>")}}else{if(opts&&opts.length){for(var i=0,len=opts.length;i<len;i++){var option=opts[i];if(labelIndx!=null&&valueIndx!=null){var value=option[valueIndx];if(value==""||value==null){continue}if(labelIndx==valueIndx){buffer.push("<option>",value,"</option>")}else{var label=option[labelIndx];buffer.push('<option value="',value,'">',label,"</option>")}}else{if(typeof option=="object"){for(var key in option){buffer.push('<option value="',key,'">',option[key],"</option>")}}else{buffer.push("<option>",option,"</option>")}}}}}buffer.push("</select>");return buffer.join("")};$.fn.pqval=function(obj){if(obj){if(obj.incr){var val=this.data("pq_value");this.prop("indeterminate",false);if(val){val=false;this.removeAttr("checked")}else{if(val===false){val=null;this.prop("indeterminate",true);this.removeAttr("checked")}else{val=true;this.attr("checked","checked")}}this.data("pq_value",val);return val}else{var val=obj.val;this.data("pq_value",val);this.prop("indeterminate",false);if(val==null){this.prop("indeterminate",true);this.removeAttr("checked")}else{if(val){this.attr("checked","checked")}else{this.removeAttr("checked")}}return this}}else{return this.data("pq_value")}};var _pGenerateView={};_pGenerateView._generateTitleRow=function(GM,rowObj,buffer,lastFrozenRow){var that=this.that,thisOptions=that.options,numberCell=thisOptions.numberCell,groupTitle=rowObj.groupTitle,GMTitle=GM.title,groupLevel=rowObj.level,GMRowIndx=rowObj.GMRowIndx,GMIcon=GM.icon,GMIcon=GMIcon?GMIcon[groupLevel]:null,GMIcon=(GMIcon&&GMIcon.length&&GMIcon.length==2&&typeof GMIcon.push==="function")?GMIcon:["ui-icon-minus","ui-icon-plus"];if(GMTitle&&GMTitle[groupLevel]!=null){if(GMTitle[groupLevel]===false){return}groupTitle=GMTitle[groupLevel].replace("{0}",groupTitle);groupTitle=groupTitle.replace("{1}",rowObj.items)}else{groupTitle=groupTitle+" - "+rowObj.items+" item(s)"}buffer.push(["<tr class='pq-group-row pq-grid-row",(lastFrozenRow?" pq-last-freeze-row":""),"' title=\"",rowObj.groupTitle,"\" level='",groupLevel,"' GMRowIndx='",GMRowIndx,"'>"].join(""));if(numberCell.show){buffer.push("<td class='pq-grid-number-cell ui-state-default'><div class='pq-td-div'></div></td>")}var icon=GMIcon[0];if(rowObj.collapsed){icon=GMIcon[1]}buffer.push("<td class='pq-grid-cell' colSpan='100' >","<div class='pq-td-div' style='margin-left:",(groupLevel*16),"px;'>","<span class='ui-icon ",icon,"'></span>",groupTitle,"</div></td>");buffer.push("</tr>")};_pGenerateView._generateSummaryRow=function(rowData,thisColModel,buffer,lastFrozenRow){var row_cls="pq-summary-row pq-grid-row"+(lastFrozenRow?" pq-last-freeze-row":""),that=this.that,thisOptions=that.options,virtualX=thisOptions.virtualX,initH=that.initH,finalH=that.finalH,freezeCols=thisOptions.freezeCols,numberCell=thisOptions.numberCell,columnBorders=thisOptions.columnBorders,wrap=thisOptions.wrap,offset=this.offset;var const_cls="pq-grid-cell ";var row_str="<tr class='"+row_cls+"'>";buffer.push(row_str);if(numberCell.show){buffer.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>&nbsp;</div></td>"].join(""))}for(var col=0;col<=finalH;col++){if(col<initH&&col>=freezeCols&&virtualX){col=initH;if(col>finalH){throw ("initH>finalH")}}var column=thisColModel[col],dataIndx=column.dataIndx;if(column.hidden){continue}var strStyle="";var cls=const_cls;if(column.align=="right"){cls+=" pq-align-right"}else{if(column.align=="center"){cls+=" pq-align-center"}}if(col==freezeCols-1&&columnBorders){cls+=" pq-last-freeze-col"}if(column.cls){cls=cls+" "+column.cls}var valCell=(rowData[dataIndx]==null)?"&nbsp;":rowData[dataIndx];var str=["<td class='",cls,"' style='",strStyle,"' >","<div class='pq-td-div'>",valCell,"</div></td>"].join("");buffer.push(str)}buffer.push("</tr>");return buffer};_pGenerateView._generateDetailRow=function(rowData,rowIndx,thisColModel,buffer,objP,lastFrozenRow){var row_cls="pq-grid-row pq-detail-child";if(lastFrozenRow){row_cls+=" pq-last-freeze-row"}var that=this.that,thisOptions=that.options,numberCell=thisOptions.numberCell,CMLength=thisColModel.length,offset=this.offset;var const_cls="pq-grid-cell ";if(!thisOptions.wrap||objP){const_cls+="pq-wrap-text "}if(thisOptions.stripeRows&&(rowIndx/2==parseInt(rowIndx/2))){row_cls+=" pq-grid-oddRow"}if(rowData.pq_rowselect){row_cls+=" pq-row-select ui-state-highlight"}var pq_rowcls=rowData.pq_rowcls;if(pq_rowcls!=null){row_cls+=" "+pq_rowcls}buffer.push("<tr pq-row-indx='"+rowIndx+"' class='"+row_cls+"' >");if(numberCell.show){buffer.push(["<td class='pq-grid-number-cell ui-state-default'>","<div class='pq-td-div'>&nbsp;</div></td>"].join(""))}buffer.push("<td class='"+const_cls+" pq-detail-child' colSpan='20'></td>");buffer.push("</tr>");return buffer};var cGroupView=function(that){this.that=that};var _pGroupView=cGroupView.prototype;_pGroupView._refreshDataFromDataModel=function(){this._groupData();this.initcollapsed()};_pGroupView.bindEvents=function(){var self=this;this.that.$cont.on("click","tr.pq-group-row",function(evt){return self.onClickGroupRow(evt)})};_pGroupView.showHideRows=function(initIndx,level,hide){var arr=[],that=this.that,data=that.dataGM;for(var i=initIndx,len=data.length;i<len;i++){var rowObj=data[i],rowData=rowObj;if(rowData.groupSummary){if(rowObj.level<level){break}else{rowObj.pq_hidden=hide}}else{if(rowData.groupTitle){if(rowObj.collapsed){arr.push({indx:i,level:rowObj.level})}if(rowObj.level<=level){break}else{rowObj.pq_hidden=hide}}else{rowObj.pq_hidden=hide}}}return arr};_pGroupView.onClickGroupRow=function(evt){var $tr=$(evt.currentTarget),that=this.that;var level=parseInt($tr.attr("level")),GMRowIndx=parseInt($tr.attr("GMRowIndx")),data=that.dataGM,collapsed=true,rowObj=data[GMRowIndx];if(!rowObj.collapsed){rowObj.collapsed=true;collapsed=true}else{rowObj.collapsed=false;collapsed=false}if(collapsed){this.showHideRows(GMRowIndx+1,level,true)}else{var arr=this.showHideRows(GMRowIndx+1,level,false);for(var j=0;j<arr.length;j++){var indx=arr[j].indx;var level=arr[j].level;this.showHideRows(indx+1,level,true)}}that._refresh()};_pGroupView.initcollapsed=function(){var that=this.that,data=that.dataGM;if(!data){return}for(var i=0,len=data.length;i<len;i++){var rowData=data[i],groupTitle=rowData.groupTitle;if(groupTitle!==undefined){var level=rowData.level,collapsed=rowData.collapsed;if(collapsed){this.showHideRows(i+1,level,true)}}}};_pGroupView.max=function(arr,dataType){var ret;if(dataType=="integer"||dataType=="float"){ret=Math.max.apply(Math,arr);if(dataType==="float"){ret=ret.toFixed(2)}}else{if(dataType=="date"){arr=arr.sort(function(a,b){a=Date.parse(a);b=Date.parse(b);return(a-b)});ret=arr[arr.length-1]}else{arr=arr.sort();ret=arr[arr.length-1]}}return ret};_pGroupView.min=function(arr,dataType){var ret;if(dataType=="integer"||dataType=="float"){ret=Math.min.apply(Math,arr);if(dataType==="float"){ret=ret.toFixed(2)}}else{if(dataType=="date"){arr=arr.sort(function(a,b){a=Date.parse(a);b=Date.parse(b);return(a-b)});ret=arr[0]}else{arr=arr.sort();ret=arr[0]}}return ret};_pGroupView.count=function(arr){return arr.length};_pGroupView.sum=function(arr,dataType){var s=0,fn;if(dataType==="float"){fn=parseFloat}else{if(dataType==="integer"){fn=parseInt}else{fn=function(val){return val}}}for(var i=0,len=arr.length;i<len;i++){s+=fn(arr[i])}if(dataType==="float"){s=s.toFixed(2)}return s};_pGroupView._groupData=function(){var that=this.that,data=that.data,thisOptions=that.options,GM=thisOptions.groupModel,PM=thisOptions.pageModel,CM=that.colModel,rowOffset=(PM.type)?((PM.curPage-1)*PM.rPP):0,CMLength=CM.length,GMdataIndx=GM.dataIndx,GMLength=GMdataIndx.length,GMcollapsed=GM.collapsed,groupSummaryShow=[];for(var u=0;u<GMLength;u++){groupSummaryShow[u]=false;for(var v=0;v<CMLength;v++){var column=CM[v],summary=column.summary;if(!summary){continue}var summaryType=summary.type;if(!summaryType||typeof summaryType.push!="function"){continue}if(summaryType[u]){groupSummaryShow[u]=true;break}}}if(GM&&data&&data.length>0){var dataGM=[],titleIndx=[],groupVal=[],prevGroupVal=[],cols=[];for(var u=0;u<GMLength;u++){prevGroupVal[u]="";groupVal[u]="";cols[u]={}}for(var i=0,len=data.length;i<=len;i++){var rowData=data[i];var changeGroup=false,changeGroupIndx=null;for(var u=0;u<GMLength;u++){groupVal[u]=(i<len)?$.trim(rowData[GMdataIndx[u]]):"";if(prevGroupVal[u]!=groupVal[u]){changeGroup=true}if(changeGroup&&changeGroupIndx==null){changeGroupIndx=u}}if(changeGroup){for(var l=0;l<GMLength;l++){prevGroupVal[l]=groupVal[l]}if(i>0){for(var u=GMLength-1;u>=changeGroupIndx;u--){if(groupSummaryShow[u]){var groupRowData=[];for(var f=0;f<CMLength;f++){var column=CM[f],summary=column.summary,summaryType=(summary)?(summary.type?summary.type[u]:null):null;if(summaryType){var dataIndx=column.dataIndx,summaryCellData="",summaryTitle=summary.title?summary.title[u]:null,sText="{0}";if(typeof summaryType=="function"){summaryCellData=summaryType(cols[u][dataIndx],column.dataType)}else{sText=summaryType+": {0}";summaryCellData=this[summaryType](cols[u][dataIndx],column.dataType)}if(summaryTitle){sText=summaryTitle}groupRowData[dataIndx]=sText.replace("{0}",summaryCellData)}}dataGM.push({groupSummary:true,level:u,data:groupRowData})}}for(var m=changeGroupIndx;m<GMLength;m++){dataGM[titleIndx[m]].items=cols[m][CM[0].dataIndx].length}}if(i==len){break}for(var z=GMLength-1;z>=changeGroupIndx;z--){for(var e=0;e<CMLength;e++){var column=CM[e];cols[z][column.dataIndx]=[]}}for(var m=changeGroupIndx;m<GMLength;m++){dataGM.push({groupTitle:groupVal[m],level:m,GMRowIndx:dataGM.length,collapsed:(GMcollapsed&&(GMcollapsed[m]!=null))?GMcollapsed[m]:false});titleIndx[m]=dataGM.length-1}}rowData.rowIndx=i+rowOffset;rowData.pq_hidden=false;dataGM.push(rowData);for(var k=0;k<CMLength;k++){var column=CM[k],dataIndx=column.dataIndx;for(var u=0;u<GMLength;u++){cols[u][dataIndx].push(rowData[dataIndx])}}}that.dataGM=dataGM}};var cDragColumns=function(that){this.that=that;this.$drag_helper=null;var dragColumns=that.options.dragColumns,topIcon=dragColumns.topIcon,bottomIcon=dragColumns.bottomIcon,self=this;this.status="stop";this.$arrowTop=$("<div class='pq-arrow-down ui-icon "+topIcon+"'></div>").appendTo(that.element);this.$arrowBottom=$("<div class='pq-arrow-up ui-icon "+bottomIcon+"' ></div>").appendTo(that.element);this.hideArrows();if(dragColumns&&dragColumns.enabled){that.$header.on("touchstart mousedown","td.pq-grid-col",function(evt,ui){if($.support.touch){if(evt.type=="touchstart"){var touch=evt.originalEvent.touches[0];if(touch.pq_composed){return}evt.preventDefault();self.setDraggables(evt,ui);var evt2=document.createEvent("UIEvent");evt2.initUIEvent("touchstart",true,true);evt2.view=window;evt2.altKey=false;evt2.ctrlKey=false;evt2.shiftKey=false;evt2.metaKey=false;evt2.touches=[{pageX:evt.pageX,pageY:evt.pageY,pq_composed:true}];evt2.changedTouches=[{pageX:evt.pageX,pageY:evt.pageY,pq_composed:true}];evt.target.dispatchEvent(evt2)}}else{if(!evt.pq_composed){self.setDraggables(evt,ui);evt.pq_composed=true;var e=$.Event("mousedown",evt);$(evt.target).trigger(e)}}})}};var _pDragColumns=cDragColumns.prototype;_pDragColumns.showFeedback=function($td,leftDrop){var that=this.that;var td=$td[0];var offParent=td.offsetParent.offsetParent;var left=td.offsetLeft+offParent.offsetLeft+((!leftDrop)?td.offsetWidth:0)-8;var top=that.$grid_inner[0].offsetTop+td.offsetTop-16;var top2=that.$grid_inner[0].offsetTop+that.$header[0].offsetHeight;this.$arrowTop.css({left:left,top:top,display:""});this.$arrowBottom.css({left:left,top:top2,display:""})};_pDragColumns.showArrows=function(){this.$arrowTop.show();this.$arrowBottom.show()};_pDragColumns.hideArrows=function(){this.$arrowTop.hide();this.$arrowBottom.hide()};_pDragColumns.updateDragHelper=function(accept){var that=this.that,dragColumns=that.options.dragColumns,acceptIcon=dragColumns.acceptIcon,rejectIcon=dragColumns.rejectIcon,$drag_helper=this.$drag_helper;if(!$drag_helper){return}if(accept){$drag_helper.children("span.pq-drag-icon").addClass(acceptIcon).removeClass(rejectIcon);$drag_helper.removeClass("ui-state-error")}else{$drag_helper.children("span.pq-drag-icon").removeClass(acceptIcon).addClass(rejectIcon);$drag_helper.addClass("ui-state-error")}};_pDragColumns.setDraggables=function(evt,ui){var $td=$(evt.currentTarget),that=this.that,dragColumns=that.options.dragColumns,rejectIcon=dragColumns.rejectIcon,self=this;if($td.hasClass("ui-draggable")){return}if(!that.getHeaderColumnFromTD($td)){return}$td.draggable({distance:10,cursorAt:{top:-18,left:-10},helper:function(){var $this=$(this);self.status="helper";self._setupDroppables($this);that.$header.find(".pq-grid-col-resize-handle").hide();var colIndx=$this.attr("pq-col-indx");var rowIndx=$this.attr("pq-row-indx");$this.droppable("destroy");var column=that.headerCells[rowIndx][colIndx];var $drag_helper=$("<div class='pq-col-drag-helper ui-widget-content ui-corner-all' ><span class='pq-drag-icon ui-icon "+rejectIcon+"'></span>"+column.title+"</div>");self.$drag_helper=$drag_helper;return $drag_helper[0]},zIndex:"1000",appendTo:that.element,revert:"invalid",drag:function(evt,ui){self.status="drag";var $td=$("td.pq-drop-hover",that.$header);if($td.length>0){self.showArrows();self.updateDragHelper(true);var wd=$td.width();var lft=evt.clientX-$td.offset().left+$(document).scrollLeft();if(lft<wd/2){self.leftDrop=true;self.showFeedback($td,true)}else{self.leftDrop=false;self.showFeedback($td,false)}}else{self.hideArrows();if(that.$toolbar.hasClass("pq-drop-hover")){self.updateDragHelper(true)}else{self.updateDragHelper()}}},stop:function(evt,ui){self.status="stop";that.$header.find(".pq-grid-col-resize-handle").show();self.hideArrows()}})};_pDragColumns._columnIndexOf=function(colModel,column){for(var i=0,len=colModel.length;i<len;i++){if(colModel[i]==column){return i}}return -1};_pDragColumns.refreshSorting=function(){var that=this.that;window.setTimeout(function(){var arr=that.$toolbar.sortable("toArray",{attribute:"sorter"});that.sorters=[];for(var i=0,len=arr.length;i<len;i++){that.sorters.push(eval("("+arr[i]+")"))}that.sortLocalData(that.sorters,that.data);that.refresh()},0)};_pDragColumns._setupDroppables=function($td){var that=this.that,self=this;var objDrop={hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(evt,ui){if(that.dropPending){return}var colIndxDrag=parseInt(ui.draggable.attr("pq-col-indx"),10);var rowIndxDrag=parseInt(ui.draggable.attr("pq-row-indx"),10);var colIndxDrop=parseInt($(this).attr("pq-col-indx"),10);var rowIndxDrop=$(this).attr("pq-row-indx");var optCM=that.options.colModel;var headerCells=that.headerCells;var columnDrag=headerCells[rowIndxDrag][colIndxDrag];var colModelDrag,colModelDrop;if(rowIndxDrag==0){colModelDrag=optCM}else{colModelDrag=headerCells[rowIndxDrag-1][colIndxDrag].colModel}if(rowIndxDrop==0){colModelDrop=optCM}else{colModelDrop=headerCells[rowIndxDrop-1][colIndxDrop].colModel}var columnDrop=headerCells[rowIndxDrop][colIndxDrop];var indxDrag=self._columnIndexOf(colModelDrag,columnDrag);var column=colModelDrag.splice(indxDrag,1)[0];var indxDrop=self._columnIndexOf(colModelDrop,columnDrop);var decr=(self.leftDrop)?1:0;colModelDrop.splice(indxDrop+1-decr,0,column);that.dropPending=true;window.setTimeout(function(){that._calcThisColModel();that._refresh();that.dropPending=false},0)}};var $tds=that.$header_left.find("td.pq-left-col");var $tds2=that.$header_right.find("td.pq-right-col");$tds=$tds.add($tds2);$tds.each(function(i,td){var $td=$(td);if($td.hasClass("ui-droppable")){return}$td.droppable(objDrop)});return;var column=that.getHeaderColumnFromTD($td);var dataIndx=column.dataIndx;if(that.getIndxInSorters(dataIndx)!=-1){if(that.$toolbar.hasClass("ui-droppable")){that.$toolbar.droppable("destroy")}return}that.$toolbar.droppable({hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(evt,ui){var colIndxDrag=parseInt(ui.draggable.attr("pq-col-indx"),10);var rowIndxDrag=parseInt(ui.draggable.attr("pq-row-indx"),10);var optCM=that.options.colModel;var headerCells=that.headerCells;var columnDrag=headerCells[rowIndxDrag][colIndxDrag];var colModelDrag;if(rowIndxDrag==0){colModelDrag=optCM}else{colModelDrag=headerCells[rowIndxDrag-1][colIndxDrag].colModel}var indxDrag=self._columnIndexOf(colModelDrag,columnDrag);var column=colModelDrag[indxDrag];var dataIndx=column.dataIndx;var dataType=column.dataType;that.sorters.push({dataIndx:dataIndx,dataType:dataType,dir:"up"});$("<span class='pq-sortable' sorter=\"{dataIndx:"+dataIndx+",dataType:'"+dataType+"',dir:'up'}\">"+column.title+"</span>").appendTo(that.$toolbar).button({icons:{primary:"ui-icon-triangle-1-n",secondary:"ui-icon-close"}}).mouseover(function(evt){var $target=$(evt.target);if($target.is("span.ui-icon-close")){$target.css("outline","1px solid black")}}).mouseout(function(evt){var $target=$(evt.target);if($target.is("span.ui-icon-close")){$target.css("outline","")}}).click(function(evt){var $button=$(this);if($(evt.target).is("span.ui-icon-close")){window.setTimeout(function(){$button.button("destroy");$button.remove();self.refreshSorting()},0)}else{var sorter=eval("("+$button.attr("sorter")+")");if(sorter.dir=="up"){sorter.dir="down";$button.button({icons:{primary:"ui-icon-triangle-1-s",secondary:"ui-icon-close"}})}else{sorter.dir="up";$button.button({icons:{primary:"ui-icon-triangle-1-n",secondary:"ui-icon-close"}})}var sorterStr="{dataIndx:"+sorter.dataIndx+",dataType:'"+sorter.dataType+"',dir:'"+sorter.dir+"'}";$button.attr("sorter",sorterStr);self.refreshSorting()}});self.refreshSorting();window.setTimeout(function(){that.$toolbar.droppable("destroy")},0)}})};fn.options={detailModel:{cache:true,offset:100,expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},dragColumns:{enabled:true,acceptIcon:"ui-icon-check",rejectIcon:"ui-icon-closethick",topIcon:"ui-icon-circle-arrow-s",bottomIcon:"ui-icon-circle-arrow-n"},track:false,treeModel:{collapsed:true,indent:15,leafIcon:"ui-icon-radio-off",expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},virtualX:true,filterModel:{on:true,mode:"AND",header:false}};fn._create=function(){$.extend($.paramquery.cGenerateView.prototype,_pGenerateView);var that=this,thisOptions=this.options;this.iGroupView=new cGroupView(this);this.iHeaderSearch=new cHeaderSearch(this);this.iUCData=new $.paramquery.cUCData(this);this.pqSheet={};new cMouseSelection(this);this._super.apply(this);this.iGroupView.bindEvents();this.pqSheet={};this.iDragColumns=new cDragColumns(this);this._createToolbar();this.refreshHeader();this.refreshDataAndView({header:false});this.refresh();var widgetEventPrefix=that.widgetEventPrefix.toLowerCase();that.element.one(widgetEventPrefix+"load",function(evt,ui){that._refresh({header:false})})};fn._createToolbar=function(){var that=this,options=this.options,toolbar=options.toolbar;if(toolbar){var tb=toolbar,cls=tb.cls,cls=cls?cls:"",style=tb.style,style=style?style:"",attr=tb.attr,attr=attr?attr:"",items=tb.items;var $toolbar=$("<div class='"+cls+"' style='"+style+"' "+attr+" ></div>").appendTo($(".pq-grid-top",this.element));$toolbar.pqToolbar({items:items,gridInstance:this});if(!options.showToolbar){$toolbar.css("display","none")}this.$toolbar=$toolbar}};fn.isLeftOrRight=function(colIndx){var thisOptions=this.options,freezeCols=this.freezeCols;if(colIndx>freezeCols){return"right"}else{return"left"}};fn.ovCreateHeader=function(buffer,const_cls){if(this.options.filterModel.header){this.iHeaderSearch.createDOM(buffer,const_cls)}};fn._createHeader=function(){this._super.apply(this);if(this.options.showHeader){this._trigger("createHeader")}};fn.exportExcel=function(obj){obj.format="xml";return $.paramquery.pqgrid.exportToExcel.call(this,obj)};fn.exportCsv=function(obj){obj.format="csv";return $.paramquery.pqgrid.exportToExcel.call(this,obj)};fn.filter=function(objP){var that=this,thisOptions=this.options,apply=(objP.apply===undefined)?true:objP.apply,sort=(objP.sort===undefined)?true:objP.sort,DM=thisOptions.dataModel,FM=thisOptions.filterModel;if(objP!=undefined){var replace=(objP.oper=="replace")?true:false,rules=objP.data,CM=this.colModel,CM=(!apply)?$.extend(true,[],CM):CM,foundCount=0,CMLength=CM.length,rulesLength=rules.length;for(var i=0;i<CMLength;i++){var column=CM[i],found=false;for(var j=0;j<rulesLength;j++){if(foundCount==rulesLength){break}var obj=rules[j];if(obj.dataIndx==column.dataIndx){found=true;foundCount++;var filter=column.filter,condition=obj.condition,value=obj.value;if(!filter){filter=column.filter={on:true}}else{filter.on=true}if(condition){filter.condition=condition}condition=filter.condition;filter.value=value;if(condition=="between"){filter.value2=obj.value2}else{if(condition=="range"){var arrOpts=[];if(value){if(typeof value=="string"){var options=filter.options;var firstIndx=value.indexOf('"');var lastIndx=value.lastIndexOf('"');value=value.substr(firstIndx,lastIndx+1);value=JSON.parse("["+value+"]");if(options){for(var k=0,optLen=options.length;k<optLen;k++){var opt=options[k];if($.inArray(opt,value)!=-1){arrOpts.push(opt)}}}else{arrOpts=value.split(",s*")}}else{if(typeof value.push=="function"){arrOpts=value}}}filter.value=arrOpts}}break}}if(replace&&!found&&column.filter){column.filter.on=false}}}var obj2={header:false,apply:apply,sort:sort,CM:CM};if(DM.location=="remote"&&FM.type!="local"){this.remoteRequest({apply:apply,CM:CM,callback:function(){return that._onDataAvailable(obj2)}})}else{return that._onDataAvailable(obj2)}};fn._initTypeColumns=function(){var CM=this.colModel;for(var i=0,len=CM.length;i<len;i++){var column=CM[i];if(column.type==="checkBoxSelection"){new $.paramquery.cCheckBoxColumn(this,column.dataIndx)}else{if(column.type==="detail"){column.dataIndx="pq_detail";this.iHierarchy=new cHierarchy(this)}}}};fn.refreshHeader=function(){this._createHeader()};fn.refreshDataFromDataModel=function(){this._super.apply(this);var thisOptions=this.options,GM=thisOptions.groupModel,GMTrue=(GM)?true:false;if(GMTrue){this.iGroupView._refreshDataFromDataModel()}};var cSort=$.paramquery.cSort=function(that){this.that=that};var _pSort=cSort.prototype;_pSort._refreshSorters=function(pDataIndx){var that=this.that,thisOptions=that.options,DM=thisOptions.dataModel,DMsortIndx=DM.sortIndx,multiSort=$.isArray(DMsortIndx),GM=thisOptions.groupModel,GMdataIndx=GM?GM.dataIndx:null,GMDir=GM?GM.dir:null,foundInGMIndx=-1,sorters=[];if(GM){for(var i=0;i<GMdataIndx.length;i++){var gDataIndx=GMdataIndx[i];if(gDataIndx==pDataIndx){foundInGMIndx=i}sorters.push({dataIndx:gDataIndx,dir:(GMDir&&GMDir[i])?GMDir[i]:"up"})}}if(foundInGMIndx!==-1){var dir=sorters[foundInGMIndx].dir;var newDir=(dir==="up")?"down":"up";sorters[foundInGMIndx].dir=newDir;GMDir[foundInGMIndx]=newDir}else{if(pDataIndx!=null){if(multiSort){var indx=$.inArray(pDataIndx,DM.sortIndx);if(indx!=-1){if(DM.sortDir[indx]=="up"){DM.sortDir[indx]="down"}else{if(DMsortIndx.length==1){DM.sortDir[indx]="up"}else{DM.sortIndx.splice(indx,1);DM.sortDir.splice(indx,1)}}}else{var len=DM.sortIndx.length;DM.sortIndx[len]=pDataIndx;DM.sortDir[len]="up"}}else{if(DM.sortIndx==pDataIndx){DM.sortDir=(DM.sortDir=="up")?"down":"up"}else{DM.sortIndx=pDataIndx;DM.sortDir="up"}}}}if(DM.sortIndx!=null){if(multiSort){for(var i=0;i<DMsortIndx.length;i++){var dataIndx=DMsortIndx[i];if(this.inSorters(sorters,dataIndx)==-1){sorters.push({dataIndx:dataIndx,dir:DM.sortDir[i]})}}}else{if(this.inSorters(sorters,DM.sortIndx)==-1){sorters.push({dataIndx:DM.sortIndx,dir:DM.sortDir})}}}this.sorters=sorters};_pSort.inSorters=function(sorters,dataIndx){var found=-1;for(var i=0;i<sorters.length;i++){var sorter=sorters[i];if(sorter.dataIndx==dataIndx){found=i;break}}return found};_pSort._sortLocalData=function(data){var that=this.that,thisOptions=that.options,DM=thisOptions.dataModel,CM=that.colModel,sorters=this.sorters;for(var i=0;i<sorters.length;i++){var sorter=sorters[i],dataIndx=sorter.dataIndx,colIndx=that.getColIndx({dataIndx:dataIndx}),dataType=CM[colIndx].dataType;sorter.dataType=dataType}return this.__sortLocalData(sorters,data)};_pSort.__sortLocalData=function(sorters,data){if(data==null||data.length==0){return}if(!sorters||!sorters.length){return data}function sort_integer(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?parseInt(val1,10):0;val2=val2?parseInt(val2,10):0;return((val1-val2)*dir)}function sort_date(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?Date.parse(val1):0;val2=val2?Date.parse(val2):0;return((val1-val2)*dir)}function sort_custom(obj1,obj2,dataIndx,dir,dataType){var val1=obj1[dataIndx];var val2=obj2[dataIndx];return(dataType(val1,val2)*dir)}function sort_float(obj1,obj2,dataIndx,dir){var val1=(obj1[dataIndx]+"").replace(/,/g,"");var val2=(obj2[dataIndx]+"").replace(/,/g,"");val1=val1?parseFloat(val1):0;val2=val2?parseFloat(val2):0;return((val1-val2)*dir)}function sort_string(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?val1:"";val2=val2?val2:"";var ret=0;if(val1>val2){ret=1}else{if(val1<val2){ret=-1}}return(ret*dir)}function sort_stringi(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];val1=val1?val1.toUpperCase():"";val2=val2?val2.toUpperCase():"";var ret=0;if(val1>val2){ret=1}else{if(val1<val2){ret=-1}}return(ret*dir)}function sort_bool(obj1,obj2,dataIndx,dir){var val1=obj1[dataIndx];var val2=obj2[dataIndx];var ret=0;if((val1&&!val2)||(val1===false&&val2===null)){ret=1}else{if((val2&&!val1)||(val2===false&&val1===null)){ret=-1}}return(ret*dir)}function innerSort(){var arrFn=[],arrDataIndx=[],arrDir=[],sortersLength=sorters.length;function sort_composite(obj1,obj2){var ret=0;for(var i=0;i<sortersLength;i++){ret=arrFn[i](obj1,obj2,arrDataIndx[i],arrDir[i]);if(ret!=0){break}}return ret}for(var i=0;i<sortersLength;i++){var sorter=sorters[i],dataIndx=sorter.dataIndx,dir=(sorter.dir=="up")?1:-1,dataType=sorter.dataType;arrDataIndx[i]=dataIndx;arrDir[i]=dir;if(dataType=="integer"){arrFn[i]=sort_integer}else{if(dataType=="float"){arrFn[i]=sort_float}else{if(typeof dataType=="function"){arrFn[i]=(function(dataType){return function(obj1,obj2,dataIndx,dir){return sort_custom(obj1,obj2,dataIndx,dir,dataType)}})(dataType)}else{if(dataType=="date"){arrFn[i]=sort_date}else{if(dataType=="stringi"){arrFn[i]=sort_stringi}else{if(dataType=="bool"){arrFn[i]=sort_bool}else{arrFn[i]=sort_string}}}}}}}data=data.sort(sort_composite)}$.measureTime(innerSort,"innerSort");return data};fn._refreshHeaderSortIcons=function(){var thisOptions=this.options,DM=thisOptions.dataModel,sorters=this.iSort.sorters,thisColModel=this.colModel;var $header=this.$header;var $pQuery_cols=$header.find(".pq-grid-col");$pQuery_cols.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active");$header.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");for(var i=0;i<sorters.length;i++){var sorter=sorters[i];var dataIndx=sorter.dataIndx;var colIndx=this.getColIndx({dataIndx:dataIndx});var dir=sorter.dir;var addClass="ui-state-active pq-col-sort-"+(dir=="up"?"asc":"desc");var cls2="ui-icon ui-icon-triangle-1-"+(dir=="up"?"n":"s");$header.find(".pq-grid-col[pq-grid-col-indx="+colIndx+"]").addClass(addClass);$header.find(".pq-grid-col[pq-grid-col-indx="+colIndx+"] .pq-col-sort-icon").addClass(cls2)}};fn.getHeaderColumnFromTD=function($td){var colIndx=$td.attr("pq-grid-col-indx");if(colIndx==null){return}var column=this.colModel[colIndx];return column};fn.getIndxInSorters=function(dataIndx){var sorters=this.sorters;for(var i=0,len=sorters.length;i<len;i++){if(sorters[i].dataIndx==dataIndx){return i}}return -1};fn._simulateEvent=function(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)};fn._getTblSingle=function(rowIndxPage,colIndx){var $tbl=this.$tbl,colIndx=(colIndx!=null)?colIndx:0,thisOptions=this.options,freezeCols=thisOptions.freezeCols,freezeRows=thisOptions.freezeRows;if($tbl!=undefined){if($tbl.length==4){if(rowIndxPage>=freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[3])}else{if(rowIndxPage>=freezeRows&&colIndx<freezeCols){$tbl=$($tbl[2])}else{if(rowIndxPage<freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[1])}else{$tbl=$($tbl[0])}}}}else{if($tbl.length==2){if(rowIndxPage>=freezeRows&&colIndx>=freezeCols){$tbl=$($tbl[1])}else{$tbl=$($tbl[0])}}else{$tbl=$($tbl[0])}}}return $tbl};fn.getLargestRowCol=function(arr){var rowIndx,colIndx;for(var i=0;i<arr.length;i++){var sel=arr[i];var rowIndx2=sel.rowIndx;if(rowIndx==null){rowIndx=sel.rowIndx}else{if(rowIndx2>rowIndx){rowIndx=rowIndx2}}rowIndx=sel.rowIndx}};fn._onLoad=function(){this.options.dataModel.postData=""};fn._onRefreshSheet=function(){var data=this.$dragSeries.data();if(data){var rowIndx=data.rowIndx,colIndx=data.colIndx,left=data.left,top=data.top;this.bb(rowIndx,colIndx)}};fn.bringCellToView=function(obj){this._bringCellToView(obj)};fn._setUrl=function(queryStr){this.options.dataModel.getUrl=function(){return{url:this.url+((queryStr!=null)?queryStr:"")}}};fn.getDataPage=function(){return this.data};fn.getData=function(objP){var dataIndices=objP.dataIndx,dILen=dataIndices.length,data=objP.data,DM=this.options.dataModel,DMData=DM.data,DMDataUF=DM.dataUF,arr=[],pr=function(data){for(var i=0,len=data.length;i<len;i++){var rowData=data[i];var row={};for(var j=0;j<dILen;j++){var dataIndx=dataIndices[j];row[dataIndx]=rowData[dataIndx]}arr.push(row)}};if(data){pr(data)}else{if(DMData){pr(DMData)}if(DMDataUF){pr(DMDataUF)}}var sorters=[];for(var j=0;j<dILen;j++){var dataIndx=dataIndices[j];var column=this.getColumn({dataIndx:dataIndx});sorters.push({dataIndx:dataIndx,dir:"up",dataType:column.dataType})}arr=this.iSort.__sortLocalData(sorters,arr);var arr2=[],item2=undefined;for(var i=0;i<arr.length;i++){var rowData=arr[i];var item=JSON.stringify(rowData);if(item!==item2){arr2.push(rowData);item2=item}}return arr2};fn.getFilterData=function(objP){var CM=objP.CM;if(!CM){throw ("CM N/A")}var CMLength=CM.length,location=objP.location,FM=this.options.filterModel,FMmultiple=FM.multiple,conditions=$.paramquery.filter.getAllConditions,TRconditions=$.paramquery.filter.getTRConditions,arrS=[],isCorrect=function(condition,value,value2){if(condition=="between"){if((value==null||value==="")&&(value2==null||value2==="")){return false}else{return true}}else{if($.inArray(condition,conditions)!=-1){if((value==null||value==="")){if($.inArray(condition,TRconditions)!=-1){return false}}return true}else{return true}}},getValue=function(cd,dataType){if(location=="remote"){cd=(cd==null)?"":cd;return cd.toString()}else{return cFilterData.convert(cd,dataType)}};for(var i=0;i<CMLength;i++){var column=CM[i],dataIndx=column.dataIndx,dataType=column.dataType,dataType=(!dataType||typeof dataType=="function")?"string":dataType,filter=column.filter;if(FMmultiple){var cFM=column.filterModel;if(cFM&&cFM.on){var filters=[],cMode=cFM.mode,cFilters=cFM.filters;for(var j=0;j<cFilters.length;j++){var filter=cFilters[j],value=filter.value,condition=filter.condition;if(isCorrect(condition,value)){value=getValue(value,dataType);filters.push({value:value,condition:condition})}}arrS.push({dataIndx:dataIndx,mode:cMode,dataType:dataType,filters:filters})}}else{if(filter&&filter.on){var value=filter.value,value2=filter.value2,condition=filter.condition;if(isCorrect(condition,value,value2)){if(condition=="between"){if(value===""||value==null){condition="lte";value=getValue(value2,dataType)}else{if(value2===""||value2==null){condition="gte";value=getValue(value,dataType)}else{value=getValue(value,dataType);value2=getValue(value2,dataType)}}}else{if(condition=="regexp"){if(location=="remote"){value=value.toString()}else{if(typeof value=="string"){try{var modifiers=filter.modifiers,modifiers=modifiers?modifiers:"gi";value=new RegExp(value,modifiers)}catch(ex){value=/.*/}}}}else{if(condition=="range"){if(value==null){continue}else{if(typeof value=="string"){value=getValue(value,dataType);value=value.split(/\s*,\s*/)}else{if(value&&typeof value.push=="function"){if(value.length==0){continue}value=value.slice();for(var j=0,len=value.length;j<len;j++){value[j]=getValue(value[j],dataType)}}}}}else{value=getValue(value,dataType)}}}arrS.push({dataIndx:dataIndx,value:value,value2:value2,condition:condition,dataType:dataType,cbFn:(location=="remote")?"":cFilterData.conditions[condition]})}}}}return arrS};var cFilterData=function(that){this.that=that};var _pFilterData=cFilterData.prototype;cFilterData.conditions={equal:function(cd,value){if(cd==value){return true}},contain:function(cd,value){if(cd.indexOf(value)!=-1){return true}},notcontain:function(cd,value){if(cd.indexOf(value)==-1){return true}},empty:function(cd){if(cd.length==0){return true}},notempty:function(cd){if(cd.length>0){return true}},begin:function(cd,value){if(cd.indexOf(value)==0){return true}},notbegin:function(cd,value){if(cd.indexOf(value)!=0){return true}},end:function(cd,value){var lastIndx=cd.lastIndexOf(value);if(lastIndx!=-1&&(lastIndx+value.length==cd.length)){return true}},notend:function(cd,value){var lastIndx=cd.lastIndexOf(value);if(lastIndx!=-1&&(lastIndx+value.length==cd.length)){}else{return true}},regexp:function(cd,value){if(value.test(cd)){value.lastIndex=0;return true}},notequal:function(cd,value){if(cd!=value){return true}},great:function(cd,value){if(cd>value){return true}},gte:function(cd,value){if(cd>=value){return true}},between:function(cd,value,value2){if(cd>=value&&cd<=value2){return true}},range:function(cd,value){if($.inArray(cd,value)!=-1){return true}},less:function(cd,value){if(cd<value){return true}},lte:function(cd,value){if(cd<=value){return true}}};cFilterData.convert=function(cd,dataType){cd=(cd==null)?"":cd;if(dataType=="string"){cd=$.trim(cd).toUpperCase()}else{if(dataType=="date"){cd=Date.parse(cd)}else{if(dataType=="integer"){cd=parseInt(cd)}else{if(dataType=="float"){cd=parseFloat(cd)}else{if(dataType=="bool"){cd=String(cd).toLowerCase()}}}}}return cd};_pFilterData.isMatchCellSingle=function(s,rowData){var dataIndx=s.dataIndx,dataType=s.dataType,value=s.value,value2=s.value2,condition=s.condition,cbFn=s.cbFn,cd=rowData[dataIndx];if(condition=="regexp"){cd=(cd==null)?"":cd}else{cd=cFilterData.convert(cd,dataType)}var found=cbFn(cd,value,value2)?true:false;return found};_pFilterData.isMatchCellMultiple=function(s,rowData){var dataIndx=s.dataIndx,dataType=s.dataType,smode=s.mode,filters=s.filters,flen=filters.length;if(flen==0){return true}for(var i=0;i<flen;i++){var f=filters[i],value=f.value,condition=f.condition,cd=rowData[dataIndx],found=this.isMatchRule(cd,condition,value,dataType);if(smode=="OR"&&found){return true}if(smode=="AND"&&!found){return false}}if(flen===1){return found}else{if(smode=="AND"){return true}else{if(smode=="OR"){return false}}}};_pFilterData.isMatchRow=function(rowData,arrS,FMmode){if(arrS.length==0){return true}for(var i=0;i<arrS.length;i++){var s=arrS[i],found=this.isMatchCell(s,rowData);if(FMmode=="OR"&&found){return true}if(FMmode=="AND"&&!found){return false}}if(FMmode=="AND"){return true}else{if(FMmode=="OR"){return false}}};fn.filterLocalData=function(objP){objP=objP?objP:{};var apply=objP.apply,CM=(apply===false)?objP.CM:this.colModel,arrS=this.getFilterData({CM:CM}),options=this.options,DM=options.dataModel,data1=DM.data,data2=DM.dataUF,arr1=[],arr2=[],FM=options.filterModel,FMmultiple=FM.multiple,FMmode=FM?FM.mode:null;var iFD=new cFilterData();if(FMmultiple){iFD.isMatchCell=iFD.isMatchCellMultiple}else{iFD.isMatchCell=iFD.isMatchCellSingle}if(FM.on&&FMmode){if(data1){for(var i=0,len=data1.length;i<len;i++){var rowData=data1[i];if(iFD.isMatchRow(rowData,arrS,FMmode)){arr1.push(rowData)}else{arr2.push(rowData)}}}if(data2){for(var i=0,len=data2.length;i<len;i++){var rowData=data2[i];if(iFD.isMatchRow(rowData,arrS,FMmode)){arr1.push(rowData)}else{arr2.push(rowData)}}}}else{if(data1){for(var i=0,len=data1.length;i<len;i++){var rowData=data1[i];arr1.push(rowData)}}if(data2){for(var i=0,len=data2.length;i<len;i++){var rowData=data2[i];arr1.push(rowData)}}}if(apply){DM.data=arr1;DM.dataUF=arr2;this._trigger("filter",null,{type:"local",dataModel:DM,colModel:CM,filterModel:FM})}return{data:arr1,dataUF:arr2}};fn._onDataAvailable=function(objP){objP=objP?objP:{};var options=this.options,apply=objP.apply,sort=objP.sort,data=[],FM=options.filterModel,DM=options.dataModel,location=DM.location;if(apply!==false){this._trigger("dataAvailable",objP.evt,{dataModel:DM})}if(FM&&FM.on&&((location=="local"&&FM.type!="remote")||(location=="remote"&&FM.type=="local"))){data=this.filterLocalData(objP).data}else{data=DM.data}if(DM.sorting&&DM.sorting=="local"){if(sort!==false){data=this.iSort._sortLocalData(data)}}if(apply===false){return data}else{DM.data=data}this.refreshView(objP)};fn.sort=function(obj){var that=this,options=this.options,colIndx=obj.colIndx,dataIndx=obj.dataIndx,evt=obj.evt,DM=options.dataModel;if(colIndx==null&&dataIndx==null){dataIndx=DM.sortIndx;if(dataIndx==null){return}}colIndx=(colIndx==null)?this.getColIndx({dataIndx:dataIndx}):colIndx;var column=this.colModel[colIndx];dataIndx=(dataIndx==null)?column.dataIndx:dataIndx;if(that._trigger("beforeSort",evt,{dataModel:DM,column:column,dataIndx:dataIndx})==false){return}if(that.$td_edit!=null){that.quitEditMode()}this.iSort._refreshSorters(dataIndx);if(DM.sorting=="local"){this.iSort._sortLocalData(DM.data);this.refreshView()}else{if(DM.sorting=="remote"){this.remoteRequest({callback:function(){that._trigger("sort",evt,{dataModel:DM,column:column,dataIndx:dataIndx});that._onDataAvailable()}})}}};fn._setScrollVLength=function(data){var GM=this.options.groupModel;data=(GM)?this.dataGM:data;this._super.call(this,data)};$.widget("paramquery.pqGrid",$.paramquery._pqGrid,fn);$.paramquery.pqGrid.regional={};$.paramquery.pqGrid.regional.en=fn._regional})(jQuery);(function(a){a.paramquery=(a.paramquery==null)?{}:a.paramquery;a.paramquery.pqgrid=(a.paramquery.pqgrid==null)?{}:a.paramquery.pqgrid;a.paramquery.pqgrid.exportToExcel=function(f){var g=this,c=(f.urlPost===undefined)?f.url:f.urlPost,d=f.url,b=(f.sheetName==null)?"pqGrid":f.sheetName,j=f.format,h=function(){var q=g.colModel,l=q.length,w=g.options,x=w.dataModel,t=x.data,m=t.length,p=[];var u=[];for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){u.push('<Column ss:AutoFitWidth="1"  ss:Width="'+o.width+'" />')}}u.push("<Row>");for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){u.push('<Cell><Data ss:Type="String">'+o.title+"</Data></Cell>")}}u.push("</Row>");u=u.join("\n");for(var s=0;s<m;s++){var n=t[s];p.push("<Row>");for(var r=0;r<l;r++){var o=q[r];if(!o.hidden){var v=o.dataIndx;p.push('<Cell><Data ss:Type="String"><![CDATA['+n[v]+"]]></Data></Cell>")}}p.push("</Row>")}p=p.join("\n");var k=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:o="urn:schemas-microsoft-com:office:office"',' xmlns:x="urn:schemas-microsoft-com:office:excel"',' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:html="http://www.w3.org/TR/REC-html40">','<Worksheet ss:Name="',b,'">',"<Table>",u,p,"</Table>","</Worksheet>","</Workbook>"];return k.join("\n")},i=function(){var q=g.colModel,l=q.length,y=g.options,z=y.dataModel,t=z.data,m=t.length,k=[],u=[],p=[];for(var s=0;s<l;s++){var o=q[s];if(!o.hidden){var x=o.title.replace(/\"/g,'""');u.push('"'+x+'"')}}k.push(u.join(","));for(var s=0;s<m;s++){var n=t[s];for(var r=0;r<l;r++){var o=q[r];if(!o.hidden){var w=o.dataIndx;var v=n[w]+"";v=v.replace(/\"/g,'""');p.push('"'+v+'"')}}k.push(p.join(","));p=[]}return k.join("\n")};var e=(j=="xml")?h():i();a.ajax({url:c,type:"POST",cache:false,data:{extension:j,excel:e},success:function(k){var l=d+(((d.indexOf("?")>0)?"&":"?")+"filename="+k);a(document.body).append("<iframe height='0' width='0' frameborder='0'  src="+l+"></iframe>")}})}})(jQuery);(function(b){var d=b.paramquery.cUCData=function(e){this.that=e;this.udata=[];this.ddata=[];this.adata=[]};var c=d.prototype;c.add=function(l){var h=this.that,g=this.adata,j=l.rowData,k=h.getRecId({rowData:j});for(var f=0,e=g.length;f<e;f++){var m=g[f];if(k!=null&&m.recId==k){throw ("primary key violation")}if(m.rowData==j){throw ("same data can't be added twice.")}}var l={recId:k,rowData:j};g.push(l)};c.update=function(r){var o=this.that,h=o.getRowData(r),m=o.getRecId({rowData:h}),p=r.dataIndx,q=r.oldVal,f=r.newVal,g=this.udata,e=false;if(m==null){return}for(var l=0,n=g.length;l<n;l++){var j=g[l];if(j.rowData==h&&j.dataIndx==p){e=true;if(j.oldVal==f){g.splice(l,1);var k={rowData:h,dataIndx:p,cls:"pq-cell-dirty"};o.removeClass(k)}else{j.newVal=f}break}}if(!e){var k={rowData:h,recId:m,dataIndx:p,newVal:f,oldVal:q};g.push(k);var k={rowData:h,dataIndx:p,cls:"pq-cell-dirty"};o.addClass(k)}};c["delete"]=function(l){var o=this.that,j=l.rowIndx,e=l.rowIndxPage,h=o.rowIndxOffset,j=(j==null)?(e+h):j,e=(e==null)?(j-h):e,f=o.options.pageModel.type,m=(f=="remote")?e:j,q=this.adata,p=this.ddata,g=o.getRowData(l);for(var k=0,n=q.length;k<n;k++){if(q[k].rowData==g){q.splice(k,1);return}}p.push({indx:m,rowData:g})};c.isDirty=function(){var h=this.that,f=this.udata,g=this.adata,e=this.ddata;if(f.length||g.length||e.length){return true}else{return false}};c.getChangesValue=function(){var o=this.that,e=this.udata,u=this.adata,p=this.ddata,h={updateList:[],addList:[],deleteList:[]},k=[],s=[],n=[],j=[],r=[];for(var l=0,m=p.length;l<m;l++){var g=p[l],f=g.rowData,t={};j.push(f);for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}r.push(t)}for(var l=0;l<e.length;l++){var g=e[l],f=g.rowData;if(b.inArray(f,j)!=-1){continue}if(b.inArray(f,k)==-1){var t={};for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}k.push(f);s.push(t)}}for(var l=0;l<u.length;l++){var g=u[l],f=g.rowData,t={};for(var q in f){if(q.indexOf("pq_")!=0){t[q]=f[q]}}n.push(t)}h.updateList=s;h.addList=n;h.deleteList=r;return h};c.getChanges=function(){var m=this.that,e=this.udata,q=this.adata,n=this.ddata,h={updateList:[],addList:[],deleteList:[]},p=[],l=[],o=[];for(var j=0,k=n.length;j<k;j++){var g=n[j],f=g.rowData;o.push(f)}for(var j=0;j<e.length;j++){var g=e[j],f=g.rowData;if(b.inArray(f,o)!=-1){continue}if(b.inArray(f,p)==-1){p.push(f)}}for(var j=0;j<q.length;j++){var g=q[j],f=g.rowData;l.push(f)}h.updateList=p;h.addList=l;h.deleteList=o;return h};c.getChangesRaw=function(){var h=this.that,f=this.udata,g=this.adata,e=this.ddata,i={updateList:[],addList:[],deleteList:[]};i.updateList=f;i.addList=g;i.deleteList=e;return i};c.commitAdd=function(r,y){var l=this.that.colModel,g=l.length,z=this.adata,q=z.length,m=r.length,A=[];for(var v=0;v<m;v++){var n=r[v];for(var x=0;x<q;x++){var p=z[x].rowData,f=true;for(var u=0;u<g;u++){var h=l[u],w=h.hidden,t=h.dataIndx;if(w||(t==y)){continue}var s=p[t],s=(s==null)?"":s+"",e=n[t],e=(e==null)?"":e+"";if(s!=e){f=false;break}}if(f){p[y]=n[y];A.push(p)}}}var o=[];for(var x=0;x<q;x++){var p=z[x].rowData;if(b.inArray(p,A)==-1){o.push(z[x])}}this.adata=o};c.commitUpdate=function(q,x){var n=this.that,g=n.colModel,e=g.length,h=this.udata,p=h.length,l=q.length,y=[];for(var w=0;w<p;w++){var o=h[w].rowData;if(b.inArray(o,y)!=-1){continue}for(var u=0;u<l;u++){var m=q[u];if(o[x]==m[x]){y.push(o);for(var t=0;t<e;t++){var f=g[t],v=f.hidden,r=f.dataIndx;if(m[r]!==undefined){o[r]=m[r]}n.removeClass({rowData:o,dataIndx:r,cls:"pq-cell-dirty",refresh:false})}}}}var s=[];for(var w=0;w<p;w++){var o=h[w].rowData;if(b.inArray(o,y)==-1){s.push(h[w])}}this.udata=s};c.commitDelete=function(q,e){var m=this.ddata,f=m.length,n=q.length,o=[];for(var l=0;l<f;l++){var h=m[l].rowData;for(var k=0;k<n;k++){var p=q[k];if(h[e]==p[e]){o.push(h)}}}var g=[];for(var l=0;l<f;l++){var h=m[l].rowData;if(b.inArray(h,o)==-1){g.push(m[l])}}this.ddata=g};c.commitUpdateAll=function(){var j=this.that,h=this.udata;for(var g=0,e=h.length;g<e;g++){var l=h[g],f=l.dataIndx,k=l.rowData;j.removeClass({rowData:k,dataIndx:f,cls:"pq-cell-dirty"})}this.udata=[]};c.commitAddAll=function(){this.adata=[]};c.commitDeleteAll=function(){this.ddata=[]};c.commit=function(e){var h=this.that,f=h.options.dataModel,g=f.recIndx;if(e==null){this.commitAddAll();this.commitUpdateAll();this.commitDeleteAll()}else{var j=e.type,i=e.rows;if(j=="add"){if(i){this.commitAdd(i,g)}else{this.commitAddAll()}}else{if(j=="update"){if(i){this.commitUpdate(i,g)}else{this.commitUpdateAll()}}else{if(j=="delete"){if(i){this.commitDelete(i,g)}else{this.commitDeleteAll()}}}}}h.refreshView()};c.rollbackAdd=function(p,l){var q=this.adata,e=p.type;for(var m=0,o=q.length;m<o;m++){var h=q[m],f=h.rowData;for(var k=0,g=l.length;k<g;k++){if(l[k]==f){var n=l.splice(k,1);if(n&&n.length&&e=="remote"){p.totalRecords--}break}}}this.adata=[]};c.rollbackDelete=function(h,l){var f=this.ddata,e=h.type;for(var g=f.length-1;g>=0;g--){var m=f[g],j=m.indx,k=m.rowData;l.splice(j,0,k);if(e=="remote"){h.totalRecords++}}this.ddata=[]};c.rollbackUpdate=function(o,h){var l=this.that,e=this.udata;for(var j=0,m=e.length;j<m;j++){var g=e[j],k=g.recId,f=g.rowData,n=g.dataIndx;if(k==null){continue}f[n]=g.oldVal;l.removeClass({rowData:f,dataIndx:n,cls:"pq-cell-dirty",refresh:false})}this.udata=[]};c.rollback=function(f){var i=this.that,g=i.options.dataModel,h=i.options.pageModel,e=(f&&(f.refresh!=null))?f.refresh:true,k=(f&&(f.type!=null))?f.type:null,j=g.data;if(k==null||k=="update"){this.rollbackUpdate(h,j)}if(k==null||k=="delete"){this.rollbackDelete(h,j)}if(k==null||k=="add"){this.rollbackAdd(h,j)}if(e){i.refreshView()}};var a=b.paramquery.pqGrid.prototype;a.getChanges=function(f){this.quitEditMode();if(f){var e=f.format;if(e){if(e=="byVal"){return this.iUCData.getChangesValue()}else{if(e=="raw"){return this.iUCData.getChangesRaw()}}}}return this.iUCData.getChanges()};a.rollback=function(e){this.quitEditMode();this.iUCData.rollback(e)};a.isDirty=function(){return this.iUCData.isDirty()};a.commit=function(e){this.quitEditMode();this.iUCData.commit(e)};a._getRowIndx=function(){var j=this;var f=j.selection({type:"row",method:"getSelection"});if(f&&f.length>0){var i=f[0].rowIndx,l=j.rowIndxOffset,h=j.options.pageModel,g=h.type,e=i-l,k=h.rPP;if(g){if(e>=0&&e<k){return i}}else{return i}}else{return null}};a.updateRow=function(p){var j=this,o=j.options,f=o.track,f=(p.track!=null)?p.track:f,h=p.rowIndx,n=p.row,m=false,g=j.getRowData({rowIndx:h});var i={rowData:g};for(var k in n){var l=g[k],e=n[k];if(e!==l){m=true;if(f){i.dataIndx=k;i.oldVal=l;i.newVal=e;this.iUCData.update(i)}g[k]=e}}if(m){j.refreshRow({rowIndx:h})}};a._fillForm=function(p){var s=this,v=s.options.dataModel,u=s.options.pageModel,f=u.type,q=v.data,k=s.colModel,n=s.rowIndxOffset,e=(p.rowIndxPage==null)?p.rowIndx-n:p.rowIndxPage,m=(p.rowIndx==null)?e+n:p.rowIndx,r=(f=="remote")?e:m,j=q[r];this.rowData=j;this.$crudDialog.dialog("option","title","Edit Record ("+(m+1)+")");var l=this.$crudForm;for(var o=0;o<k.length;o++){var h=k[o],t=h.dataIndx,g=j[t];l.find("*[name='"+t+"']").val(g)}};a.getRecId=function(h){var f=this,e=f.options.dataModel;h.dataIndx=e.recIndx;var g=f.getCellData(h);return g};a.getCellData=function(g){var f=this.getRowData(g),e=g.dataIndx;return f[e]};a.getRowData=function(n){var s=n.rowData;if(s!=null){return s}var t=this.options,u=t.dataModel,r=t.pageModel,g=r.type,f=u.recIndx,p=n.recId,m=u.data;if(p!=null){for(var l=0,q=m.length;l<q;l++){var h=m[l];if(h[f]==p){return h}}}else{var k=n.rowIndx,e=n.rowIndxPage,j=this.rowIndxOffset,k=(k!=null)?k:e+j,e=(e!=null)?e:k-j,o=(g=="remote")?e:k,h=m[o];return h}};a.deleteRow=function(j){var m=this,h=j.rowIndx,o=j.effect,p=m.options,q=p.dataModel,n=p.pageModel,e=n.type;if(h!=null){var l=(e=="remote")?(h-this.rowIndxOffset):h,i=q.data,f=p.track,f=(j.track!=null)?j.track:f;if(f){this.iUCData["delete"]({rowIndx:h})}if(o){var m=this,k=this.getRow({rowIndx:h});if(k){k.effect("fade",null,350,function(){var r=j.complete;if(r&&typeof r=="function"){r.call(m)}var s=i.splice(l,1);if(s&&s.length&&e=="remote"){n.totalRecords--}m.refreshView()})}}else{var g=i.splice(l,1);if(g&&g.length&&e=="remote"){n.totalRecords--}this.refreshView()}}};a._onDialogOpen=function(){var g=this,f=this,h=this.$crudDialog.parent(".ui-dialog");b(".pq-dialog-buttonset",h).remove();if(this.crudEditMode==false){return}var e=b("<div style='' class='pq-dialog-buttonset'></div>").prependTo(b(".ui-dialog-buttonpane",h));this.prev=b("<button type='button' class='ui-corner-left'></button>").appendTo(e).button({icons:{primary:"ui-icon-circle-triangle-w"},text:false}).bind("click",function(j){var i=g.rowPrevSelect();f._fillForm({rowIndxPage:i})});this.prev.removeClass("ui-corner-all");this.next=b("<button type='button' class='ui-corner-right'></button>").appendTo(e).button({icons:{primary:"ui-icon-circle-triangle-e"},text:false}).bind("click",function(j){var i=g.rowNextSelect();f._fillForm({rowIndxPage:i})});this.next.removeClass("ui-corner-all")};a.getFormData=function(m){var k=this,l={},e=k.colModel;for(var g=0;g<e.length;g++){var h=e[g],f=h.dataIndx,j=m.find("*[name='"+f+"']");l[f]=j.val()}return l};a.addRow=function(f){var e=this;return e._addLocal(f)};a._addLocal=function(m){var o=this,i=m.rowData,k=m.rowIndx,e=m.rowIndxPage,h=o.options,q=h.dataModel,p=h.pageModel,f=p.type,g=h.track,g=(m.track!=null)?m.track:g,l=q.data;if(i==null){return null}if(l==null){q.data=[];l=q.data}if(g){this.iUCData.add({rowData:i})}if(k==null&&e==null){l.push(i)}else{var j=this.rowIndxOffset,k=(k==null)?(e+j):k,e=(e==null)?(k-j):e,n=(f=="remote")?e:k;l.splice(n,0,i)}if(f=="remote"){p.totalRecords++}if(!m.refresh!==false){this.refreshView()}if(k==null){return l.length-1}else{return k}};a._addRemote=function(g){var e=this,f=g.rowData;f.pq_oper="add";e.options.dataModel.postDataOnce=f}})(jQuery);(function(b){var a={};a.options={items:[],gridInstance:null};a._create=function(){var q=this,g=this.options,n=g.gridInstance,f=n.colModel,r=g.items,d=this.element,m=d.closest(".pq-grid");d.addClass("pq-toolbar");for(var y=0,A=r.length;y<A;y++){var C=r[y],h=C.type,B=C.icon,g=C.options,o=C.label,t=C.listeners,u=C.cls,c="ui-corner-all "+(u?u:""),p=C.style,z=p?'style="'+p+'"':"",l=C.attr,v=l?l:"",s;if(h=="textbox"){s=b("<input type='text' class='"+c+"' "+v+" "+z+">").appendTo(d)}else{if(h=="checkbox"){s=b("<input type='checkbox' class='"+c+"' "+v+" "+z+">").appendTo(d)}else{if(h=="separator"){b("<span class='pq-separator '"+c+"' "+v+" "+z+"></span>").appendTo(d)}else{if(h=="button"){s=b("<button type='button' class='"+c+"' "+v+" "+z+">"+o+"</button>").button({text:o?true:false,icons:{primary:B}}).appendTo(d)}else{if(h=="select"){var g=C.options?C.options:[];if(typeof g==="function"){g=g.call(n.element,{colModel:f})}e=b.paramquery.select({options:g,attr:" class='"+c+"' "+v+" "+z,prepend:C.prepend,groupIndx:C.groupIndx,valueIndx:C.valueIndx,labelIndx:C.labelIndx});s=b(e).appendTo(d)}else{if(typeof h=="string"){s=b(h).appendTo(d)}else{if(typeof h=="function"){var e=h.call(n,{colModel:f,cls:c});s=b(e).appendTo(d)}}}}}}}if(t){for(var x=0;x<t.length;x++){var k=t[x];for(var w in k){s.bind(w,k[w])}}}}};a._destroy=function(){this.element.empty().removeClass("pq-toolbar").enableSelection()};a._disable=function(){if(this.$disable==null){this.$disable=b("<div class='pq-grid-disable'></div>").css("opacity",0.2).appendTo(this.element)}};a._enable=function(){if(this.$disable){this.element[0].removeChild(this.$disable[0]);this.$disable=null}};a._setOption=function(c,d){if(c=="disabled"){if(d==true){this._disable()}else{this._enable()}}};b.widget("paramquery.pqToolbar",a)})(jQuery);(function(f){var g=function(){this.focusSelection=null};var d=g.prototype;d.getOldRowSel=function(){var j=this.that,i;if((i=this.focusSelection)&&this.isSelected(i)){var h=j.getRowIndx(i);h.rowData=i.rowData;return h}};d.getOldCellSel=function(){var j=this.that,i;if((i=this.focusSelection)&&this.isSelected(i)){var k=i.rowData;var h=j.getRowIndx({rowData:k});h.rowData=k;h.dataIndx=i.dataIndx;return h}};d.getNewRowSel=function(){var k=this.that,j=document.activeElement?f(document.activeElement):null;if(j&&j.hasClass("pq-grid-row")){var i=j.closest(".pq-grid");if(i[0]==k.element[0]){var h=k.getRowIndx({$tr:j});h.$tr=j;return h}}};d.getNewCellSel=function(){var k=this.that,j=document.activeElement?f(document.activeElement):null;if(j&&j.hasClass("pq-grid-cell")){var i=j.closest(".pq-grid");if(i[0]==k.element[0]){var h=k.getCellIndices({$td:j});h.$td=j;return h}}};d.getFocusSelection=function(h){if(this instanceof c){if(h&&h.old===true){return this.getOldRowSel()}else{return this.getNewRowSel()}}else{if(this instanceof a){if(h&&h.old===true){return this.getOldCellSel()}else{return this.getNewCellSel()}}}};d.getFirstSelection=function(){var h=this.firstSelection;if(h&&this.isSelected(h)){return h}else{this.refresh();var i=this.selection;if(i.length){this.firstSelection=i[0];return i[0]}}};d.getLastSelection=function(){var h=this.lastSelection;if(h){var j=this.that,k=h.rowData,i=j.getRowData({rowIndx:rowIndx});if(k==i&&this.isSelected(h)){return h}else{return false}}else{return null}};d.getLastSelectionCurPage=function(){var h=this.lastSelection;if(h&&this.isSelected(h)){var k=h.rowIndx,i=this.that.options.pageModel;if(i.type){var j=i.curPage,l=i.rPP;if(Math.ceil((k+1)/l)==j){return h}else{return null}}else{return h}}else{return null}};d.getSelection=function(){this.refresh();return this.selection};d.getSelectionCurPage=function(){var m=this.that,o=this.getSelection(),q=[],r=m.options,s=r.dataModel,p=r.pageModel;if(p.type){var n=s.curPage,l=s.rPP;for(var k=0;k<o.length;k++){var h=o[k],j=h.rowIndx;if(Math.ceil((j+1)/l)==n){q.push(h)}}return q}else{return o}};d.setDirty=function(){};var c=function(h){this.that=h;this.options=h.options;this.selection=[]};f.paramquery.cRows=c;var a=function(h){this.options=h.options;this.that=h;this.selection=[]};f.paramquery.cCells=a;var e=a.prototype=new g;var b=c.prototype=new g;b.extendSelection=function(p){var l=this.that,i=p.rowIndx,k=l.options.selectionModel.mode,o=p.evt;var n=this.getFirstSelection();if(n==null){l.setSelection({rowIndx:i});return}if(k!="single"){var h=n.rowIndx,j=h,m=i;if(h>i){j=i;m=h}this.selectRange({initRowIndx:j,finalRowIndx:m,evt:o});this.add({rowIndx:i})}};b.refresh=function(){this.selection=[];var q=this.that,s=q.options,t=s.dataModel,r=s.pageModel,j=r.type,h=(j=="remote")?true:false,m=q.rowIndxOffset,o=t.data;if(!o){return}for(var n=0,p=o.length;n<p;n++){var k=o[n];if(k.pq_rowselect){var l=(h)?(n+m):n;this.selection.push({rowIndx:l,rowData:k})}}};b.replace=function(l){var k=l.rowIndx,m=(l.offset==null)?this.that.getRowIndxOffset():l.offset,h=k-m,j=l.$tr,i=l.evt;l.offset=m;l.rowIndxPage=h;this.removeAll({raiseEvent:true});this.add(l)};b.indexOf=function(l){this.refresh();var j=l.rowIndx,k=this.selection;for(var h=0;h<k.length;h++){if(k[h].rowIndx==j){return h}}return -1};b.isSelected=function(h){var i=this.that,j=i.getRowData(h);return(j)?((j.pq_rowselect==null)?false:j.pq_rowselect):null};b._boundRow=function(k){var h=k.rowIndxPage,j=this.that,i=(k.$tr==null)?j.getRow({rowIndxPage:h}):k.$tr;if(i==null||i.length==0){return false}i.addClass("pq-row-select ui-state-highlight");return i};b.selectRange=function(s){var m=this.that,k=s.initRowIndx,n=s.finalRowIndx,p=s.evt,o=this.getSelection(),h=o.slice(0);for(var l=0;l<h.length;l++){var j=h[l],r=j.rowIndx;if(r<k||r>n){this.remove({rowIndx:r})}}if(k>n){var q=k;k=n;n=q}for(var r=k;r<=n;r++){this.add({rowIndx:r,focus:false})}};e._addToData=function(h){var i=h.dataIndx,j=this.that.getRowData(h);if(!j.pq_cellselect){j.pq_cellselect={}}j.pq_cellselect[i]=true};e.extendSelection=function(t){var q=this.that,h=this.getFirstSelection(),m=t.rowIndx,j=t.colIndx,p=q.options.selectionModel.mode,s=t.evt;if(h==null){q.setSelection({rowIndx:m,colIndx:j});return}var i=h.rowIndx,l=q.getColIndx({dataIndx:h.dataIndx}),n=i,r=m,k=l,o=j;if(i>m){n=m;r=i}if(p=="range"){if(i>m){k=j;o=l}if(m==i&&j<l){k=j;o=l}this.selectRange({initRowIndx:n,initColIndx:k,finalRowIndx:r,finalColIndx:o,evt:s});this.add({rowIndx:m,colIndx:j})}else{if(p=="block"){if(l>j){k=j;o=l}this.selectBlock({initRowIndx:n,initColIndx:k,finalRowIndx:r,finalColIndx:o,evt:s});this.add({rowIndx:m,colIndx:j})}}};e._removeFromData=function(h){var i=h.rowData;if(i&&i.pq_cellselect){delete i.pq_cellselect[h.dataIndx]}};e.removeAll=function(){this.refresh();var h=this.selection.slice(0);this.remove({cells:h});this.lastSelection=null};b.removeAll=function(u){var p=this.that,q=u?u.page:false;this.refresh();var t=this.selection.slice(0);if(q){var r=[],m=p.rowIndxOffset,j=p.data,k=j?j.length:0;for(var n=0,o=t.length;n<o;n++){var s=t[n],l=s.rowIndx,h=l-m;if(h>=0){if(h<k){r.push(s)}else{break}}}this.remove({rows:r})}else{this.remove({rows:t});this.lastSelection=null}};e.isSelected=function(h){var j=this.that,k=j.getRowData(h),i=h.dataIndx,i=(i==null)?j.colModel[h.colIndx].dataIndx:i;if(k==null){return null}if(k.pq_cellselect){if(k.pq_cellselect[i]){return true}}return false};e.refresh=function(){this.selection=[];var r=this.that,u=r.options.dataModel,t=r.options.pageModel,o=u.data,k=t.type,j=(k=="remote")?true:false,n=r.rowIndxOffset;if(!o){return}for(var p=0,q=o.length;p<q;p++){var l=o[p];var h=l.pq_cellselect;if(h){var m=(j)?(p+n):p;for(var s in h){if(h[s]){this.selection.push({rowIndx:m,rowData:l,dataIndx:s})}}}}this.isDirty=false};e.replace=function(l){var j=l.rowIndx,k=l.colIndx,n=(l.offset==null)?this.that.getRowIndxOffset():l.offset,h=j-n,m=l.$td,i=l.evt;l.rowIndxPage=h;l.offset=n;this.removeAll({raiseEvent:true});this.add(l)};e.inView=function(h,m){var j=this.that,i=this.options,k=i.freezeRows,l=i.freezeCols;return((h<k||h>=j.init&&h<=j["final"])&&(m<l||m>=j.initH&&m<=j.finalH))};e._add=function(u){var p=this.that,o=u.rowIndx,h=u.rowIndxPage,m=u.rowData,n=p.rowIndxOffset,t,o=(o==null)?(h+n):o,h=(h==null)?(o-n):h,m=(m==null)?p.getRowData(u):m,k=u.colIndx,q=u.dataIndx,k=(k==null)?p.getColIndx({dataIndx:q}):k,l=p.colModel[k],q=(q==null)?l.dataIndx:q,s=u.evt,j=this.isSelected({rowData:m,dataIndx:q});if(j==null){return false}var r=this.inView(h,k);if(j===false){if(r){var i=p.getCell({rowIndxPage:h,colIndx:k});if(i){i.addClass("pq-cell-select ui-state-highlight")}}this._addToData({rowData:m,dataIndx:q});if(u.trigger!==false){p._trigger("cellSelect",s,{rowIndx:o,rowIndxPage:h,colIndx:k,dataIndx:q,column:l,rowData:m})}t=true}this.lastSelection={rowIndx:o,dataIndx:q,rowData:m};if(u.focus!==false&&r){if(!i||!i.length){i=p.getCell({rowIndxPage:h,dataIndx:q})}if(i&&i.length){i.attr("tabindex","0");i.focus();p._fixTableViewPort();this.focusSelection={rowData:m,rowIndx:o,dataIndx:q}}}if(u.setFirst){this.firstSelection={rowIndx:o,rowData:m,dataIndx:q}}if(t){return{rowIndx:o,rowData:m,dataIndx:q,colIndx:k,column:l}}};b.inView=function(h){var j=this.that,i=this.options,k=i.freezeRows;return((h<k||h>=j.init&&h<=j["final"]))};b._add=function(s){var n=this.that,r,l=s.rowIndx,h=s.rowIndxPage,k=n.rowIndxOffset,l=(l==null)?(h+k):l,h=(h==null)?(l-k):h,j=(j==null)?n.getRowData(s):j,m=s.$tr,q=s.evt,i=this.isSelected({rowData:j});s.rowIndxPage=h;if(i==null){return false}var p=this.inView(h);if(i===false){if(p){var o=this._boundRow(s),m=o}j.pq_rowselect=true;if(s.trigger!==false){n._trigger("rowSelect",q,{rowIndx:l,rowIndxPage:h,rowData:j,$tr:m})}r=true}this.lastSelection={rowIndx:l,rowData:j};if(s.focus!==false&&p){if(!m||!m.length){m=n.getRow({rowIndxPage:h})}if(m){m=f(m[0]);m.attr("tabindex","0");m.focus();n._fixTableViewPort();this.focusSelection={rowData:j,rowIndx:l}}}if(s.setFirst){this.firstSelection={rowIndx:l,rowData:j}}if(r){return{rowIndx:l,rowData:j}}};e.add=function(q){var j=this.that,n=q.evt,p=q.cells,m=[];if(p&&typeof p.push=="function"){for(var h=0,k=p.length;h<k;h++){var o=p[h];o.trigger=false;var l=this._add(o);if(l){m.push(l)}}if(m.length){j._trigger("cellSelect",n,{cells:m})}}else{this._add(q)}};b.add=function(q){var j=this.that,n=q.evt,p=q.rows,m=[];if(p&&typeof p.push=="function"){for(var h=0,k=p.length;h<k;h++){var o=p[h];o.trigger=false;var l=this._add(o);if(l){m.push(l)}}if(m.length){j._trigger("rowSelect",n,{rows:m})}}else{this._add(q)}};e._remove=function(s){var p=this.that,o=s.rowIndx,h=s.rowIndxPage,n=p.rowIndxOffset,o=(o==null)?(h+n):o,h=(h==null)?(o-n):h,m=(m==null)?p.getRowData(s):m,k=s.colIndx,q=s.dataIndx,k=(k==null)?p.getColIndx({dataIndx:q}):k,l=p.colModel[k],q=(q==null)?l.dataIndx:q,r=s.evt,j=this.isSelected({rowData:m,dataIndx:q});if(j){if(this.inView(h,k)){var i=p.getCell({rowIndxPage:h,colIndx:k});if(i){i.removeClass("pq-cell-select ui-state-highlight");i.removeAttr("tabindex")}}this._removeFromData({rowData:m,dataIndx:q});if(s.trigger!==false){p._trigger("cellUnSelect",r,{rowIndx:o,colIndx:k,dataIndx:q,rowData:m})}return{rowIndx:o,rowData:m,dataIndx:q,colIndx:k,column:l}}};b._remove=function(p){var n=this.that,l=p.rowIndx,h=p.rowIndxPage,k=n.rowIndxOffset,l=(l==null)?(h+k):l,h=(h==null)?(l-k):h,j=(j==null)?n.getRowData(p):j,m=p.$tr,o=p.evt,i=this.isSelected({rowData:j});if(i){if(this.inView(h)){var m=n.getRow({rowIndxPage:h});if(m){m.removeClass("pq-row-select ui-state-highlight");m.removeAttr("tabindex")}}j.pq_rowselect=false;if(p.trigger!==false){n._trigger("rowUnSelect",o,{rowIndx:l,rowData:j,$tr:m})}return{rowIndx:l,rowData:j}}};e.remove=function(k){var m=k.cells;if(m&&typeof m.push=="function"){var o=[];for(var n=0,j=m.length;n<j;n++){var h=m[n];h.trigger=false;var l=this._remove(h);if(l){o.push(l)}}if(o.length){this.that._trigger("cellUnSelect",k.evt,{cells:o})}}else{this._remove(k)}};b.remove=function(j){var m=j.rows;if(m&&typeof m.push=="function"){var o=[];for(var l=0,h=m.length;l<h;l++){var n=m[l];n.trigger=false;var k=this._remove(n);if(k){o.push(k)}}if(o.length){this.that._trigger("rowUnSelect",j.evt,{rows:o})}}else{this._remove(j)}};e.indexOf=function(o){this.refresh();var n=o.rowIndx,m=this.that,j=(o.dataIndx==null)?m.colModel[o.colIndx].dataIndx:o.dataIndx;o.dataIndx=j;var h=this.selection;for(var k=0;k<h.length;k++){var l=h[k];if(l.rowIndx==n&&l.dataIndx==j){return k}}return -1};e.selectAll=function(x){var t=this.that,v=(x&&x.all)?true:false,r=v?this.options.dataModel.data:t.data,p=t.rowIndxOffset,n=t.colModel,l=n.length,w=[],u=function(B,A){for(var y=0;y<l;y++){var z=n[y];if(z.hidden){continue}var i={rowIndx:A,rowData:B,colIndx:y,dataIndx:z.dataIndx,focus:false};w.push(i)}};if(!r){return}for(var q=0,s=r.length;q<s;q++){var m=r[q]}if(v){var k=this.options.pageModel.type,j=(k=="remote")?true:false;for(var q=0,s=r.length;q<s;q++){var m=r[q],o=q;if(j){o=q+p}u(m,o)}}else{for(var q=0,s=r.length;q<s;q++){var m=r[q],h=q,o=h+p;u(m,o)}}this.add({cells:w})};b.selectAll=function(s){var p=this.that,q=(s&&s.all)?true:false,m=q?this.options.dataModel.data:p.data,r=[];if(!m){return}if(q){var j=this.options.pageModel.type,h=(j=="remote")?true:false;for(var n=0,o=m.length;n<o;n++){var l={rowData:m[n],focus:false};if(h){l.rowIndxPage=n}else{l.rowIndx=n}r.push(l)}}else{for(var n=0,o=m.length;n<o;n++){var k=m[n];r.push({rowIndxPage:n,rowData:k,focus:false})}}this.add({rows:r})};e.selectRange=function(v){var r=this.that,p=v.initRowIndx,m=v.initColIndx,t=v.finalRowIndx,q=v.finalColIndx,j=this.getSelection(),l=j.slice(0);for(var o=0;o<l.length;o++){var n=l[o],u=n.rowIndx,s=n.dataIndx,h=r.getColIndx({dataIndx:s});if(u<p||u>t){this.remove({rowIndx:u,colIndx:h,dataIndx:s})}else{if(u==p&&h<m){this.remove({rowIndx:u,colIndx:h,dataIndx:s})}else{if(u==t&&h>q){this.remove({rowIndx:u,colIndx:h,dataIndx:s})}}}}for(var h=0;h<r.colModel.length;h++){var k=r.colModel[h];if(k.hidden){continue}var s=k.dataIndx;var u=p;do{if(u==p&&h<m){}else{if(u==t&&h>q){break}else{this.add({rowIndx:u,colIndx:h,dataIndx:s,focus:false})}}u++}while(u<=t)}};e.selectBlock=function(x){var t=this.that,r=x.initRowIndx,m=x.initColIndx,v=x.finalRowIndx,s=x.finalColIndx,j=this.getSelection(),l=j.slice(0);for(var q=0;q<l.length;q++){var p=l[q],w=p.rowIndx,u=p.dataIndx,h=t.getColIndx({dataIndx:u});if(h<m||h>s){this.remove({rowIndx:w,dataIndx:u,colIndx:h})}else{if(w<r||w>v){this.remove({rowIndx:w,dataIndx:u,colIndx:h})}}}var o=[],n=t.colModel;for(var h=m;h<=s;h++){var k=n[h];var u=k.dataIndx;if(k.hidden){continue}var w=r;do{o.push({rowIndx:w,colIndx:h,dataIndx:u,focus:false});w++}while(w<=v);this.add({cells:o})}}})(jQuery);(function(c){var b=c.paramquery.cCheckBoxColumn=function(f,g){var e=this;this.that=f;this.options=f.options;this.type="checkBoxSelection";this.cbDataIndx=g;var d=f.widgetEventPrefix.toLowerCase();f.element.on(d+"dataavailable",function(h,i){if(e.belongs(h)){return e._onDataAvailable(h,i)}});f.element.on(d+"cellclick",function(h,i){if(e.belongs(h)){return e.cellClick(h,i)}});f.element.on(d+"rowselect",function(h,i){if(e.belongs(h)){return e.rowSelect(h,i)}});f.element.on(d+"rowunselect",function(h,i){if(e.belongs(h)){return e.rowUnSelect(h,i)}});f.element.on(d+"cellkeydown",function(h,i){if(e.belongs(h)){return e.cellKeyDown(h,i)}});f.element.on(d+"refreshheader",function(h,i){if(e.belongs(h)){return e.refreshHeader(h,i)}})};var a=b.prototype=new c.paramquery.cClass;a.hasHeaderChkBox=function(){var d=this.options.selectionModel;if(d.cbHeader===false){return false}else{return true}};a.setValCBox=function(){if(!this.hasHeaderChkBox()){return}var l=this.that,n=this.options,m=n.selectionModel.cbAll,g=m?n.dataModel.data:l.data,e=null,d=0,j=0;for(var h=0,k=g.length;h<k;h++){var f=g[h];if(f.pq_rowselect){d++}else{j++}}if(d==k){e=true}else{if(j==k){e=false}}this.$inp.pqval({val:e})};a.refreshHeader=function(d,h){if(!this.hasHeaderChkBox()){return}var f=this.that,g=f.data;if(!g){return}var e=this,j=f.getCellHeader({dataIndx:this.cbDataIndx});j.html("<input type='checkbox'/>");var i=this.$inp=j.find("input").click(function(k){if(c(this).is(":checked")){e.selectAllRows()}else{e.unSelectAllRows()}k.stopPropagation()});this.setValCBox()};a.selectAllRows=function(){var e=this.that,d=this.options.selectionModel.cbAll;e.iRows.selectAll({all:d})};a.unSelectAllRows=function(){var e=this.that,d=this.options.selectionModel.cbAll;if(d){e.iRows.removeAll()}else{e.iRows.removeAll({page:true})}};a._onDataAvailable=function(){var g=this.that,j=this.options.dataModel.data,e=this._findSelectionIndx();if(e!=null&&j){for(var f=0,d=j.length;f<d;f++){var h=j[f];if(h[e]){h.pq_rowselect=true}}}};a._findSelectionIndx=function(){if(this.cbDataIndx){return this.cbDataIndx}};a.cellClick=function(d,k){var i=this.that,h=k.rowIndx,j=k.rowData,g=k.column,f=this.type;if(g&&g.type===f){var e=g.dataIndx;if(!j[e]){i.iRows.add({rowIndx:h})}else{i.iRows.remove({rowIndx:h})}d.stopPropagation();return false}};a.rowSelect=function(l,k){var g=this.that,n=k.rows,d=k.rowData,j=this._findSelectionIndx();if(n){for(var f=0,h=n.length;f<h;f++){var m=n[f],e=m.rowIndx,d=m.rowData;d[j]=true;g.refreshCell({rowIndx:e,dataIndx:j})}}else{if(d){d[j]=true;e=k.rowIndx,g.refreshCell({rowIndx:e,dataIndx:j})}}this.setValCBox()};a.rowUnSelect=function(l,k){var g=this.that,n=k.rows,d=k.rowData,j=this._findSelectionIndx();if(n){for(var f=0,h=n.length;f<h;f++){var m=n[f],e=m.rowIndx,d=m.rowData;d[j]=false;g.refreshCell({rowIndx:e,dataIndx:j})}}else{if(d){d[j]=false;e=k.rowIndx,g.refreshCell({rowIndx:e,dataIndx:j})}}this.setValCBox()};a.cellKeyDown=function(d,k){var i=this.that,h=k.rowIndx,g=k.column,j=j,f=this.type;if(g&&g.type===f){var e=g.dataIndx,h=k.rowIndx;if(d.keyCode==13||d.keyCode==32){if(!j[e]){i.selection({type:"row",method:"add",rowIndx:h})}else{i.selection({type:"row",method:"remove",rowIndx:h})}d.stopPropagation();d.preventDefault();return false}}}})(jQuery);(function(c){var b=function(f,e){this.that=f;this.$ae=e};var d=b.prototype;d.createClipBoard=function(){var e=this.$ae,f=c("textarea#pq-grid-excel");if(f.length==0){f=c("<textarea id='pq-grid-excel' />").appendTo(document.body)}var i=e.offset(),h=i.left,g=i.top;f.css({position:"absolute",left:h,top:g,display:"",height:1,width:1,borderWidth:0});f.focus()};d.destroyClipBoard=function(){var f=c("textarea#pq-grid-excel");if(f.length){var e=document.activeElement;if(e==f[0]){this.$ae.focus()}f.css("display","none")}};d.clearClipBoard=function(){var e=c("textarea#pq-grid-excel");e.val("")};d.copy=function(){var t=c("textarea#pq-grid-excel");var l=this.that,g=l.colModel,e=g.length,h=l.options.selectionModel.type,x=[],s=[];x=l.iRows.getSelection();for(var v=0,w=x.length;v<w;v++){var r=x[v],n=l.getRowData(r),k=[];for(var u=0;u<e;u++){var f=g[u];if(f.hidden){continue}k.push(n[f.dataIndx])}var q=k.join("\t");s.push(q)}x=l.iCells.getSelection();var n=null,m=null,p=null,k=[];for(var v=0,w=x.length;v<w;v++){var r=x[v],m=r.rowIndx;if(m==p){continue}var n=l.getRowData(r);for(var u=0;u<e;u++){var f=g[u];if(f.hidden){continue}var o=f.dataIndx;if(l.iCells.isSelected({rowData:n,dataIndx:o})){k.push(n[o])}else{}}var q=k.join("\t");k=[];s.push(q);p=m}t.val(s.join("\n"));t.select()};var a=null;c(window).unbind(".pqExcel").bind("keydown.pqExcel",function(f){if(f.ctrlKey){var g=c(document.activeElement);if(!g.hasClass("pq-grid-row")&&!g.hasClass("pq-grid-cell")&&!g.is("textarea#pq-grid-excel")){return}var e=g.closest(".pq-grid");if(a||(g.length&&e.length)){if(!a){try{var k=e.pqGrid("getThis").that}catch(i){return true}a=new b(k,g);a.createClipBoard()}if(f.keyCode=="67"||f.keyCode=="99"){a.copy()}else{var j=c("textarea#pq-grid-excel");if(j.length){var h=document.activeElement;if(h==j[0]){a.that._onKeyPressDown(f)}}}}}}).bind("keyup.pqExcel",function(e){if(a&&!e.ctrlKey&&e.keyCode==17){a.destroyClipBoard();a=null}})})(jQuery);